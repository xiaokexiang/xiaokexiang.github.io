<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>BlockingQueue</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="BlockingQueue æ¦‚å¿µ BlockingQueueå¸¦é˜»å¡åŠŸèƒ½çš„çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—ï¼Œä½†é˜Ÿåˆ—å·²æ»¡æ—¶ä¼šé˜»å¡æ·»åŠ è€…ï¼Œå½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ä¼šé˜»å¡è·å–è€…ã€‚å®ƒæœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…·ä½“çš„åŠŸèƒ½ç”±å®ƒçš„å®ç°ç±»æ¥å®Œæˆã€‚
æ¥å£æ–¹æ³• public interface BlockingQueue&amp;lt;E&amp;gt; extends Queue&amp;lt;E&amp;gt; { // æ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—ä¸­è¿”å›booleanï¼Œé˜Ÿåˆ—æ»¡æŠ›å‡ºå¼‚å¸¸  boolean add(E e); // æ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—ä¸­ï¼Œæ— è¿”å›å€¼ï¼ŒæŠ›å‡ºä¸­æ–­å¼‚å¸¸ï¼Œé˜Ÿåˆ—æ»¡å°±é˜»å¡  void put(E e) throws InterruptedException; // æ·»åŠ å…ƒç´ è¿”å›boolea é˜Ÿåˆ—æ»¡å°±è¿”å›falseï¼Œéé˜»å¡  boolean offer(E e); // æ·»åŠ å…ƒç´ è¿”å›booleanï¼Œç­‰å¾…æŒ‡å®šæ—¶é—´ç›´åˆ°é˜Ÿåˆ—æœ‰ç©ºé—´å¯æ’å…¥  boolean offer(E e, long timeout, TimeUnit unit) throws InterruptedException; // ä»é˜Ÿé¦–è·å–å…ƒç´ å¹¶åˆ é™¤ï¼Œé˜»å¡ï¼Œæ”¯æŒç­‰å¾…æ—¶ä¸­æ–­å¼‚å¸¸  E take() throws InterruptedException; // è·å–é˜Ÿé¦–å…ƒç´ å¹¶åˆ é™¤ï¼Œè‹¥æ— å…ƒç´ ç­‰å¾…æ‰§è¡Œæ—¶é•¿ï¼Œæ—¶é—´åˆ°è¿˜æ²¡æœ‰å°±è¿”å›null  E poll(long timeout, TimeUnit unit) throws InterruptedException; // è¿”å›ç†æƒ³çŠ¶æ€ä¸‹é˜Ÿåˆ—ä¸é˜»å¡å¯åŠ å…¥çš„å…ƒç´ æ•°é‡ï¼Œå¦‚æœé˜Ÿåˆ—æ²¡æœ‰æœ€å¤§é™åˆ¶å°±è¿”å›  // Integer.max_value  int remainingCapacity(); // ç§»é™¤æŒ‡å®šå…ƒç´ ï¼ˆ1ä¸ªæˆ–å¤šä¸ªï¼‰è‹¥å®ƒå­˜åœ¨(equalsæ¯”è¾ƒ)  // è‹¥å…ƒç´ å­˜åœ¨ï¼ˆæˆ–é˜Ÿåˆ—æ”¹å˜ï¼‰è¿”å›true  boolean remove(Object o); // åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦è‡³å°‘åŒ…å«ä¸€ä¸ªæŸå…ƒç´   public boolean contains(Object o); // ç§»é™¤é˜Ÿåˆ—ä¸­å…¨éƒ¨å¯ç”¨å…ƒç´ ï¼Œæ·»åŠ åˆ°æŒ‡å®šé›†åˆä¸­ï¼Œè‹¥å…ƒç´ æ·»åŠ å¤±è´¥å¯èƒ½å¯¼è‡´å…ƒç´ ä¸åœ¨  // ç§»é™¤å‰å’Œæ·»åŠ åçš„é›†åˆä¸­  int drainTo(Collection&amp;lt;?"/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<meta name="google-site-verification" content="e1ELBPEvOV5kwQNtzaLcNt-3iZy83eiNhSZkHhQPecs" />
<meta name="baidu-site-verification" content="aNoX6MUEHW" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css">
<link rel="canonical" href="https://leejay.top/post/blockingqueue/" />

<script type="text/javascript"
        async
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
        >
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] },
    'HTML-CSS': {
        showMathMenu: false 
    }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>




<link rel="stylesheet" href="https://leejay.top/assets/style.css">




<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://leejay.top/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="https://leejay.top/img/favicon.png">



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="BlockingQueue"/>
<meta name="twitter:description" content="åŸºäºReentrantLockã€Conditionå®ç°çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ˜¯çº¿ç¨‹æ± å®ç°çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚"/>



<meta property="og:title" content="BlockingQueue" />
<meta property="og:description" content="åŸºäºReentrantLockã€Conditionå®ç°çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ˜¯çº¿ç¨‹æ± å®ç°çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://leejay.top/post/blockingqueue/" />
<meta property="article:published_time" content="2020-07-04T20:38:54+08:00" />
<meta property="article:modified_time" content="2020-07-04T20:38:54+08:00" /><meta property="og:site_name" content="Aurora" />






  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="https://leejay.top" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="https://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg></span>
    <span class="logo__text">Aurora</span>
    <span class="logo__cursor"></span>
    <span class="logo__cursor2"></span>
  
</a>
    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/categories">Categories</a></li>
        
      
        
          <li><a href="/tags">Tags</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/categories">Categories</a></li>
      
    
      
        <li><a href="/tags">Tags</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="https://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title"><a href="https://leejay.top/post/blockingqueue/">BlockingQueue</a></h1>
    <div class="post-meta">
      
        <span class="post-date">
          2020-07-04
        </span>

        
          
        
      

      
      
    </div>

    
      <span class="post-tags">
        
        ğŸ–<a href="https://leejay.top/tags/blockingqueue/">BlockingQueue </a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      
      <h3 id="blockingqueue">BlockingQueue</h3>
<h4 id="æ¦‚å¿µ">æ¦‚å¿µ</h4>
<p><code>BlockingQueue</code>å¸¦<code>é˜»å¡</code>åŠŸèƒ½çš„<code>çº¿ç¨‹å®‰å…¨</code>é˜Ÿåˆ—ï¼Œä½†é˜Ÿåˆ—å·²æ»¡æ—¶ä¼šé˜»å¡æ·»åŠ è€…ï¼Œå½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ä¼šé˜»å¡è·å–è€…ã€‚å®ƒæœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…·ä½“çš„åŠŸèƒ½ç”±å®ƒçš„å®ç°ç±»æ¥å®Œæˆã€‚</p>
<p><img src="https://image.leejay.top/image/20200707/w6jIy7hJTtxv.png?imageslim" alt=""></p>
<h4 id="æ¥å£æ–¹æ³•">æ¥å£æ–¹æ³•</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">BlockingQueue</span><span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">extends</span> Queue<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// æ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—ä¸­è¿”å›booleanï¼Œé˜Ÿåˆ—æ»¡æŠ›å‡ºå¼‚å¸¸
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>E e<span style="color:#f92672">);</span>
    <span style="color:#75715e">// æ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—ä¸­ï¼Œæ— è¿”å›å€¼ï¼ŒæŠ›å‡ºä¸­æ–­å¼‚å¸¸ï¼Œé˜Ÿåˆ—æ»¡å°±é˜»å¡
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>E e<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> InterruptedException<span style="color:#f92672">;</span>
    <span style="color:#75715e">// æ·»åŠ å…ƒç´ è¿”å›boolea é˜Ÿåˆ—æ»¡å°±è¿”å›falseï¼Œéé˜»å¡
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">offer</span><span style="color:#f92672">(</span>E e<span style="color:#f92672">);</span>
    <span style="color:#75715e">// æ·»åŠ å…ƒç´ è¿”å›booleanï¼Œç­‰å¾…æŒ‡å®šæ—¶é—´ç›´åˆ°é˜Ÿåˆ—æœ‰ç©ºé—´å¯æ’å…¥
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">offer</span><span style="color:#f92672">(</span>E e<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> timeout<span style="color:#f92672">,</span> TimeUnit unit<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">throws</span> InterruptedException<span style="color:#f92672">;</span>
	<span style="color:#75715e">// ä»é˜Ÿé¦–è·å–å…ƒç´ å¹¶åˆ é™¤ï¼Œé˜»å¡ï¼Œæ”¯æŒç­‰å¾…æ—¶ä¸­æ–­å¼‚å¸¸
</span><span style="color:#75715e"></span>    E <span style="color:#a6e22e">take</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> InterruptedException<span style="color:#f92672">;</span>
	<span style="color:#75715e">// è·å–é˜Ÿé¦–å…ƒç´ å¹¶åˆ é™¤ï¼Œè‹¥æ— å…ƒç´ ç­‰å¾…æ‰§è¡Œæ—¶é•¿ï¼Œæ—¶é—´åˆ°è¿˜æ²¡æœ‰å°±è¿”å›null
</span><span style="color:#75715e"></span>    E <span style="color:#a6e22e">poll</span><span style="color:#f92672">(</span><span style="color:#66d9ef">long</span> timeout<span style="color:#f92672">,</span> TimeUnit unit<span style="color:#f92672">)</span> 
        					<span style="color:#66d9ef">throws</span> InterruptedException<span style="color:#f92672">;</span>
    <span style="color:#75715e">// è¿”å›ç†æƒ³çŠ¶æ€ä¸‹é˜Ÿåˆ—ä¸é˜»å¡å¯åŠ å…¥çš„å…ƒç´ æ•°é‡ï¼Œå¦‚æœé˜Ÿåˆ—æ²¡æœ‰æœ€å¤§é™åˆ¶å°±è¿”å›
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Integer.max_value
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">remainingCapacity</span><span style="color:#f92672">();</span>
	<span style="color:#75715e">// ç§»é™¤æŒ‡å®šå…ƒç´ ï¼ˆ1ä¸ªæˆ–å¤šä¸ªï¼‰è‹¥å®ƒå­˜åœ¨(equalsæ¯”è¾ƒ)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// è‹¥å…ƒç´ å­˜åœ¨ï¼ˆæˆ–é˜Ÿåˆ—æ”¹å˜ï¼‰è¿”å›true
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>Object o<span style="color:#f92672">);</span>
	<span style="color:#75715e">// åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦è‡³å°‘åŒ…å«ä¸€ä¸ªæŸå…ƒç´ 
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Object o<span style="color:#f92672">);</span>
	<span style="color:#75715e">// ç§»é™¤é˜Ÿåˆ—ä¸­å…¨éƒ¨å¯ç”¨å…ƒç´ ï¼Œæ·»åŠ åˆ°æŒ‡å®šé›†åˆä¸­ï¼Œè‹¥å…ƒç´ æ·»åŠ å¤±è´¥å¯èƒ½å¯¼è‡´å…ƒç´ ä¸åœ¨
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ç§»é™¤å‰å’Œæ·»åŠ åçš„é›†åˆä¸­
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">drainTo</span><span style="color:#f92672">(</span>Collection<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">super</span> E<span style="color:#f92672">&gt;</span> c<span style="color:#f92672">);</span>
	<span style="color:#75715e">// ç§»é™¤æŒ‡å®šæ•°é‡å…ƒç´ å¹¶æ·»åŠ åˆ°é›†åˆä¸­
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">drainTo</span><span style="color:#f92672">(</span>Collection<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">super</span> E<span style="color:#f92672">&gt;</span> c<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> maxElements<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

</code></pre></div><h4 id="æ–¹æ³•å¯¹æ¯”">æ–¹æ³•å¯¹æ¯”</h4>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ä½œç”¨</th>
<th>è¿”å›å€¼</th>
<th>é˜Ÿåˆ—å·²æ»¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>add(E e)</td>
<td>æ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—</td>
<td>boolean</td>
<td>æŠ›å‡ºå¼‚å¸¸ï¼Œä¸é˜»å¡</td>
</tr>
<tr>
<td>offer(E e)</td>
<td>æ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—</td>
<td>boolean</td>
<td>è¿”å›falseï¼Œä¸é˜»å¡</td>
</tr>
<tr>
<td>put(E e)</td>
<td>æ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—</td>
<td>void</td>
<td>ä¼šé˜»å¡ç›´åˆ°é˜Ÿåˆ—ç©ºï¼Œæ”¯æŒä¸­æ–­</td>
</tr>
<tr>
<td>offer(time)</td>
<td>æŒ‡å®šæ—¶é•¿å†…æ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—</td>
<td>boolean</td>
<td>é˜»å¡ï¼Œè¶…æ—¶è¿”å›falseï¼Œæ”¯æŒä¸­æ–­</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ä½œç”¨</th>
<th>è¿”å›å€¼</th>
<th>é˜Ÿåˆ—ä¸ºç©º</th>
</tr>
</thead>
<tbody>
<tr>
<td>take()</td>
<td>è·å–å¹¶åˆ é™¤é˜Ÿé¦–å…ƒç´ </td>
<td>E</td>
<td>é˜»å¡ç­‰å¾…ç›´åˆ°æœ‰å…ƒç´ å¯ä»¥è·å–</td>
</tr>
<tr>
<td>poll()</td>
<td>è·å–å¹¶åˆ é™¤é˜Ÿé¦–å…ƒç´ </td>
<td>E/null</td>
<td>ä¸é˜»å¡ç­‰å¾…ï¼Œè¿”å›null</td>
</tr>
<tr>
<td>remove()</td>
<td>ç§»é™¤æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </td>
<td>boolean</td>
<td>ä¸é˜»å¡ç­‰å¾…</td>
</tr>
<tr>
<td>peek()</td>
<td>è·å–é˜Ÿé¦–å…ƒç´ ä½†ä¸åˆ é™¤</td>
<td>E/null</td>
<td>ä¸é˜»å¡ç­‰å¾…ï¼Œè¿”å›null</td>
</tr>
<tr>
<td>poll(time)</td>
<td>æŒ‡å®šæ—¶é•¿å†…è·å–å¹¶åˆ é™¤å…ƒç´ </td>
<td>E/null</td>
<td>é˜»å¡ç­‰å¾…ï¼Œè¶…æ—¶è¿”å›nullï¼Œä¸­æ–­</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="arrayblockingqueue">ArrayBlockingQueue</h3>
<h4 id="æ„é€ ">æ„é€ </h4>
<p><code>æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</code>ï¼Œæˆ‘ä»¬å°†ä»ç±»å˜é‡ã€æ„é€ å‡½æ•°ã€æ·»åŠ ä¸è·å–è§’åº¦æ¥è§£æ<code>ArrayBlockingQueue</code>çš„å®ç°ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ArrayBlockingQueue</span><span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">extends</span> AbstractQueue<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span>
        <span style="color:#66d9ef">implements</span> BlockingQueue<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;,</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">io</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Serializable</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// åº•å±‚ä½¿ç”¨æ•°ç»„å®ç°
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> Object<span style="color:#f92672">[]</span> items<span style="color:#f92672">;</span>
    <span style="color:#75715e">// å…ƒç´ è·å–çš„æ‰€ä»¥
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> takeIndex<span style="color:#f92672">;</span>
	<span style="color:#75715e">// å…ƒç´ æ·»åŠ çš„ç´¢å¼•
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> putIndex<span style="color:#f92672">;</span>
	<span style="color:#75715e">// é˜Ÿåˆ—ä¸­å…ƒç´ ä¸ªæ•°
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> count<span style="color:#f92672">;</span>
	<span style="color:#75715e">// é‡‡ç”¨ç‹¬å é”
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> ReentrantLock lock<span style="color:#f92672">;</span>
	<span style="color:#75715e">// ç­‰å¾…è·å–çš„æ¡ä»¶é˜Ÿåˆ—(ä¸ä¸ºç©ºå°±å¯ä»¥è·å–)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Condition notEmpty<span style="color:#f92672">;</span>
	<span style="color:#75715e">// ç­‰å¾…æ·»åŠ çš„é˜Ÿåˆ—(ä¸æ»¡å°±å¯ä»¥æ·»åŠ )
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Condition notFull<span style="color:#f92672">;</span>
    <span style="color:#75715e">// é»˜è®¤å®ç° éœ€è¦æŒ‡å®šé˜Ÿåˆ—å¤§å°ï¼Œé»˜è®¤éå…¬å¹³é”
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ArrayBlockingQueue</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> capacity<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">(</span>capacity<span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ArrayBlockingQueue</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> capacity<span style="color:#f92672">,</span> <span style="color:#66d9ef">boolean</span> fair<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// å®¹é‡å°äº0æŠ›å¼‚å¸¸
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>capacity <span style="color:#f92672">&lt;=</span> 0<span style="color:#f92672">)</span>
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalArgumentException<span style="color:#f92672">();</span>
        <span style="color:#75715e">// åˆå§‹åŒ–æ•°ç»„ï¼ˆå †ä¸­ï¼‰
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">items</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Object<span style="color:#f92672">[</span>capacity<span style="color:#f92672">];</span>
        <span style="color:#75715e">// åˆå§‹åŒ–ç‹¬å é”å’Œå®ƒçš„ä¸¤ä¸ªæ¡ä»¶é˜Ÿåˆ—
</span><span style="color:#75715e"></span>        lock <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ReentrantLock<span style="color:#f92672">(</span>fair<span style="color:#f92672">);</span>
        notEmpty <span style="color:#f92672">=</span> lock<span style="color:#f92672">.</span><span style="color:#a6e22e">newCondition</span><span style="color:#f92672">();</span>
        notFull <span style="color:#f92672">=</span>  lock<span style="color:#f92672">.</span><span style="color:#a6e22e">newCondition</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>  
</code></pre></div><blockquote>
<ol>
<li>ArrayBlockingQueueåˆ›å»ºæ—¶éœ€è¦æŒ‡å®š<code>å®¹é‡å¤§å°ï¼ˆå› ä¸ºæ˜¯intï¼Œæœ€å¤§2^31-1ï¼‰</code>ã€‚</li>
<li>ä½¿ç”¨<code>ä¸€ä¸ªç‹¬å é”å’Œå®ƒçš„ä¸¤ä¸ªConditioné˜Ÿåˆ—</code>å®ç°åŒæ­¥ï¼Œé»˜è®¤<code>éå…¬å¹³é”</code>å®ç°ã€‚</li>
<li>ArrayBlockingQueueæ˜¯<code>&quot;æœ‰åºçš„(éé€»è¾‘æœ‰åº)&quot;</code>ï¼Œéµå¾ª<code>FIFOå…ˆè¿›å…ˆå‡º</code>çš„æ‰§è¡Œé¡ºåºã€‚</li>
</ol>
</blockquote>
<hr>
<h3 id="æ·»åŠ ">æ·»åŠ </h3>
<h4 id="put">put</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>E e<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> InterruptedException <span style="color:#f92672">{</span>
    <span style="color:#75715e">// å…ƒç´ ä¸èƒ½ä¸ºnullå¦åˆ™æŠ¥NPE
</span><span style="color:#75715e"></span>    checkNotNull<span style="color:#f92672">(</span>e<span style="color:#f92672">);</span>
    <span style="color:#75715e">// è·å–ç‹¬å é”
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> ReentrantLock lock <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">// å¯ä¸­æ–­çš„è·å–é”
</span><span style="color:#75715e"></span>    lock<span style="color:#f92672">.</span><span style="color:#a6e22e">lockInterruptibly</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æ»¡äº†
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>count <span style="color:#f92672">==</span> items<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">)</span>
            <span style="color:#75715e">// è‹¥å·²æ»¡ å°†å½“å‰çº¿ç¨‹åŠ å…¥ ç­‰å¾…æ·»åŠ çš„æ¡ä»¶é˜Ÿåˆ—
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// ç­‰å¾…è¢«ä¸‹æ¬¡å”¤é†’
</span><span style="color:#75715e"></span>            notFull<span style="color:#f92672">.</span><span style="color:#a6e22e">await</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">// å°†å…ƒç´ åŠ å…¥é˜Ÿåˆ—
</span><span style="color:#75715e"></span>        enqueue<span style="color:#f92672">(</span>e<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        lock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">enqueue</span><span style="color:#f92672">(</span>E x<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// è·å–æ•°ç»„
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> Object<span style="color:#f92672">[]</span> items <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">items</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">// å°†å…ƒç´ æ·»åŠ åˆ°æŒ‡å®šindex
</span><span style="color:#75715e"></span>    items<span style="color:#f92672">[</span>putIndex<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> x<span style="color:#f92672">;</span>
    <span style="color:#75715e">// putIndex + 1çš„åŒæ—¶åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æ»¡äº†
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(++</span>putIndex <span style="color:#f92672">==</span> items<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">)</span>
        <span style="color:#75715e">// å¦‚æœæ»¡äº†å°±å°†putçš„indexç½®ä¸º0ï¼Œé˜²æ­¢æŒ‡é’ˆæº¢å‡º
</span><span style="color:#75715e"></span>        putIndex <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
    <span style="color:#75715e">// å°†é˜Ÿåˆ—çš„å¤§å°+1
</span><span style="color:#75715e"></span>    count<span style="color:#f92672">++;</span>
    <span style="color:#75715e">// å”¤é†’è·å–æ¡ä»¶é˜Ÿåˆ—çš„èŠ‚ç‚¹
</span><span style="color:#75715e"></span>    notEmpty<span style="color:#f92672">.</span><span style="color:#a6e22e">signal</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<ol>
<li>putæ–¹æ³•<code>è·å–ç‹¬å é”çš„æ—¶å€™å¯ä»¥å“åº”ä¸­æ–­</code>ã€‚</li>
<li>è·å–ç‹¬å é”åï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œä¼šå°†å½“å‰çº¿ç¨‹åŠ å…¥<code>notFullç­‰å¾…æ·»åŠ æ¡ä»¶é˜Ÿåˆ—</code>ã€‚</li>
<li>è‹¥é˜Ÿåˆ—æ²¡æœ‰æ»¡ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨<code>enqueue</code>å°†å…ƒç´ åŠ å…¥æ•°ç»„å¹¶ä¿®æ”¹ç›¸å…³å˜é‡ã€‚</li>
</ol>
</blockquote>
<h4 id="offer">offer</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">offer</span><span style="color:#f92672">(</span>E e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    checkNotNull<span style="color:#f92672">(</span>e<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">final</span> ReentrantLock lock <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">;</span>
    lock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// åŒºåˆ«åœ¨æ­¤ï¼Œé˜Ÿåˆ—æ»¡è¿”å›false
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>count <span style="color:#f92672">==</span> items<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">)</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            enqueue<span style="color:#f92672">(</span>e<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        lock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<p>offer()æ–¹æ³•åœ¨é˜Ÿåˆ—æ»¡çš„æ—¶å€™ç›´æ¥è¿”å›<code>false</code>ï¼Œè€Œputåˆ™æ˜¯è°ƒç”¨<code>awaité˜»å¡ç­‰å¾…</code>ã€‚</p>
<p>offer(time)æ–¹æ³•åŒºåˆ«åœ¨äº<code>awaitNanosé˜»å¡ä¸€å®šæ—¶é—´ï¼Œè¶…æ—¶äº†é˜Ÿåˆ—ä»æ»¡å†è¿”å›false</code>ã€‚</p>
</blockquote>
<h4 id="add">add</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>E e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>e<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
<span style="color:#75715e">// æŠ½è±¡ç±»AbstractQueue
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>E e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// æœ¬è´¨è¿˜æ˜¯è°ƒç”¨offeræ–¹æ³•ï¼Œåªæ˜¯å¦‚æœé˜Ÿåˆ—æ»¡å°±è¿”å›å¼‚å¸¸
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>offer<span style="color:#f92672">(</span>e<span style="color:#f92672">))</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">else</span>
        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalStateException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Queue full&#34;</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<p>add()åº•å±‚æ˜¯è°ƒç”¨çš„offer()ï¼Œåªæ˜¯å¤„ç†é˜Ÿåˆ—æ»¡çš„æ‰‹æ®µä¸åŒï¼Œ<code>addåœ¨é˜Ÿåˆ—æ»¡æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸</code>ã€‚</p>
</blockquote>
<hr>
<h3 id="è·å–">è·å–</h3>
<h4 id="take">take</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> E <span style="color:#a6e22e">take</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> InterruptedException <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">final</span> ReentrantLock lock <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">;</span>
    lock<span style="color:#f92672">.</span><span style="color:#a6e22e">lockInterruptibly</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// ä¸takeæ–¹æ³•ç±»ä¼¼
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// å½“é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>count <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span>
            <span style="color:#75715e">// å°†å½“å‰çº¿ç¨‹åŠ å…¥ ç­‰å¾…è·å–æ¡ä»¶é˜Ÿåˆ—
</span><span style="color:#75715e"></span>            notEmpty<span style="color:#f92672">.</span><span style="color:#a6e22e">await</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">// ä¸ä¸ºç©ºæ—¶è°ƒç”¨dequeueè·å–æ•°æ®
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> dequeue<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        lock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">private</span> E <span style="color:#a6e22e">dequeue</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">final</span> Object<span style="color:#f92672">[]</span> items <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">items</span><span style="color:#f92672">;</span>
    <span style="color:#a6e22e">@SuppressWarnings</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;unchecked&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#75715e">// è·å–æ•°ç»„ä¸­æŒ‡å®šindexæ•°æ®å¹¶æ¸…é™¤è¯¥æ•°æ®
</span><span style="color:#75715e"></span>    E x <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>E<span style="color:#f92672">)</span> items<span style="color:#f92672">[</span>takeIndex<span style="color:#f92672">];</span>
    items<span style="color:#f92672">[</span>takeIndex<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">// å¦‚æœtakeIndex+1è¶…è¿‡æ•°ç»„é•¿åº¦
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(++</span>takeIndex <span style="color:#f92672">==</span> items<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">)</span>
        <span style="color:#75715e">// å°†takeIndexé‡ç½®
</span><span style="color:#75715e"></span>        takeIndex <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
    <span style="color:#75715e">// å°†æ•°ç»„æ•°é‡å‡1
</span><span style="color:#75715e"></span>    count<span style="color:#f92672">--;</span>
    <span style="color:#75715e">// è‹¥è¿­ä»£å™¨ä¸ä¸ºnull
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>itrs <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
        <span style="color:#75715e">// éœ€è¦å¤„ç†è¿­ä»£å™¨
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// è‹¥é˜Ÿåˆ—ä¸ºç©ºå°±æ¸…ç©ºæ‰€æœ‰è¿­ä»£å™¨ï¼Œä¸ä¸ºç©ºå°±æ¸…ç©ºtakeIndexçš„è¿­ä»£å™¨
</span><span style="color:#75715e"></span>        itrs<span style="color:#f92672">.</span><span style="color:#a6e22e">elementDequeued</span><span style="color:#f92672">();</span>
    <span style="color:#75715e">// å”¤é†’ç­‰å¾…æ·»åŠ çš„æ¡ä»¶é˜Ÿåˆ—
</span><span style="color:#75715e"></span>    notFull<span style="color:#f92672">.</span><span style="color:#a6e22e">signal</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">return</span> x<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<ol>
<li>take()æ•´ä½“æµç¨‹ä¸putç±»ä¼¼ï¼Œå½“é˜Ÿåˆ—æ²¡æœ‰å…ƒç´ æ—¶ï¼Œä¼šæ·»åŠ åˆ°<code>notEmpty</code>æ¡ä»¶é˜Ÿåˆ—ã€‚</li>
<li>å¦‚æœé˜Ÿåˆ—æœ‰å…ƒç´ å°±è°ƒç”¨<code>dequeue</code>è·å–å…ƒç´ ã€å”¤é†’<code>ç­‰å¾…æ·»åŠ æ¡ä»¶é˜Ÿåˆ—</code>çš„èŠ‚ç‚¹ã€‚</li>
</ol>
</blockquote>
<h4 id="poll">poll</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> E <span style="color:#a6e22e">poll</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">final</span> ReentrantLock lock <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">;</span>
    lock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>count <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">:</span> dequeue<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        lock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<p>poll()ä¸take()åŒºåˆ«åœ¨äºé˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œ<code>å‰è€…è¿”å›null</code>ï¼Œåè€…é˜»å¡ç­‰å¾…ã€‚</p>
<p>poll(time)ä¸take()åŒºåˆ«åœ¨äº<code>awaitNanos</code>é˜»å¡ç­‰å¾…æŒ‡å®šæ—¶é•¿ï¼Œ<code>è‹¥é˜Ÿåˆ—ä»ä¸ºç©ºè¿”å›null</code>ã€‚</p>
</blockquote>
<h4 id="peek">peek</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> E <span style="color:#a6e22e">peek</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">final</span> ReentrantLock lock <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">;</span>
    lock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// ç›´æ¥è¿”å›æŒ‡å®šç´¢å¼•çš„æ•°æ®ï¼Œé˜Ÿåˆ—ä¸ºç©ºæ—¶è¿”å›null
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> itemAt<span style="color:#f92672">(</span>takeIndex<span style="color:#f92672">);</span> <span style="color:#75715e">// null when queue is empty
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        lock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">final</span> E <span style="color:#a6e22e">itemAt</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>E<span style="color:#f92672">)</span> items<span style="color:#f92672">[</span>i<span style="color:#f92672">];</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<p>peek()ä¸take()åŒºåˆ«åœ¨äº<code>è¿”å›æ•°æ®æ—¶å¹¶ä¸åˆ é™¤æ•°æ®</code>ï¼Œpeek()<code>åœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶è¿”å›null</code>ã€‚</p>
</blockquote>
<hr>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<ul>
<li><code>ArrayBlockingQueue</code>æ˜¯æœ‰ç•Œï¼ˆéœ€è¦æŒ‡å®šåˆå§‹é˜Ÿåˆ—å¤§å°ï¼‰çš„é˜»å¡é˜Ÿåˆ—ï¼Œæœ€å¤§å®¹é‡ä¸è¶…è¿‡<code>Integer.MAX_VALUE</code>ã€‚</li>
<li><code>ArrayBlockingQueue</code>éµå¾ª<code>FIFOå…ˆè¿›å…ˆå‡ºçš„é¡ºåºè§„åˆ™</code>ã€‚</li>
<li><code>ArrayBlockingQueue</code>ä¸­çš„æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ˜¯é€šè¿‡<code>ç‹¬å é”</code>å®ç°çš„ã€‚</li>
<li><code>ArrayBlockingQueue</code>å› ä¸ºåªæœ‰ä¸€æŠŠé”ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯çœŸæ­£çš„<code>åŒæ—¶æ·»åŠ å’Œè·å–</code>ã€‚</li>
</ul>
<hr>
<h3 id="linkedblockingqueue">LinkedBlockingQueue</h3>
<h4 id="æ„é€ -1">æ„é€ </h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LinkedBlockingQueue</span><span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">extends</span> AbstractQueue<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span>
        <span style="color:#66d9ef">implements</span> BlockingQueue<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;,</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">io</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Serializable</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// å†…éƒ¨ç»´æŠ¤äº†Nodeå¯¹è±¡ï¼ŒåŠ å…¥é˜Ÿåˆ—çš„å…ƒç´ è¢«å°è£…æˆnodeå¯¹è±¡é€šè¿‡é“¾è¡¨çš„å½¢å¼é“¾æ¥
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Node</span><span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// èŠ‚ç‚¹çš„data
</span><span style="color:#75715e"></span>        E item<span style="color:#f92672">;</span>
        <span style="color:#75715e">// èŠ‚ç‚¹çš„nextæŒ‡é’ˆ
</span><span style="color:#75715e"></span>        Node<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> next<span style="color:#f92672">;</span>
        Node<span style="color:#f92672">(</span>E x<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> item <span style="color:#f92672">=</span> x<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">// é˜Ÿåˆ—å®¹é‡
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> capacity<span style="color:#f92672">;</span>
	<span style="color:#75715e">// å› ä¸ºæ˜¯ä¸¤æŠŠé”ï¼Œæ‰€ä»¥å…±äº«countéœ€è¦åŒæ­¥ï¼Œä½¿ç”¨atmoicInteger
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> AtomicInteger count <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> AtomicInteger<span style="color:#f92672">();</span>
    <span style="color:#75715e">// é“¾è¡¨çš„é˜Ÿé¦–ï¼Œå®ƒçš„item = null(ä¸å˜)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">transient</span> Node<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> head<span style="color:#f92672">;</span>
	<span style="color:#75715e">// é“¾è¡¨çš„é˜Ÿå°¾ï¼Œå®ƒçš„next = null(ä¸å˜)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">transient</span> Node<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> last<span style="color:#f92672">;</span>
	<span style="color:#75715e">// takeã€pollä¹‹ç±»è·å–å…ƒç´ çš„é”ï¼ˆæ³¨æ„æ˜¯éå…¬å¹³é”ï¼‰
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> ReentrantLock takeLock <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ReentrantLock<span style="color:#f92672">();</span>
	<span style="color:#75715e">// takeLockçš„ç­‰å¾…è·å–çš„æ¡ä»¶é˜Ÿåˆ—
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Condition notEmpty <span style="color:#f92672">=</span> takeLock<span style="color:#f92672">.</span><span style="color:#a6e22e">newCondition</span><span style="color:#f92672">();</span>
	<span style="color:#75715e">// put offerä¹‹ç±»çš„è·å–å…ƒç´ çš„é”ï¼ˆæ³¨æ„æ˜¯éå…¬å¹³é”ï¼‰
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> ReentrantLock putLock <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ReentrantLock<span style="color:#f92672">();</span>
	<span style="color:#75715e">// putLockçš„ç­‰å¾…æ·»åŠ çš„æ¡ä»¶é˜Ÿåˆ—
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Condition notFull <span style="color:#f92672">=</span> putLock<span style="color:#f92672">.</span><span style="color:#a6e22e">newCondition</span><span style="color:#f92672">();</span>
    <span style="color:#75715e">// é»˜è®¤æ„é€ å‡½æ•°ï¼Œé»˜è®¤é˜Ÿåˆ—å¤§å°æ˜¯2^31-1
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">LinkedBlockingQueue</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">(</span>Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">MAX_VALUE</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">// æŒ‡å®šé˜Ÿåˆ—çš„å¤§å°
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">LinkedBlockingQueue</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> capacity<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>capacity <span style="color:#f92672">&lt;=</span> 0<span style="color:#f92672">)</span> <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalArgumentException<span style="color:#f92672">();</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">capacity</span> <span style="color:#f92672">=</span> capacity<span style="color:#f92672">;</span>
         <span style="color:#75715e">// åˆå§‹åŒ–é“¾è¡¨é˜Ÿé¦–å’Œé˜Ÿå°¾ = ç©ºçš„nodeèŠ‚ç‚¹
</span><span style="color:#75715e"></span>        last <span style="color:#f92672">=</span> head <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Node<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>  
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<p>å’ŒArrayBlockingQueueç›¸æ¯”ï¼Œ<code>LinkedBlockingQueue</code>æœ‰ä¸‰å¤„ä¸åŒï¼š</p>
<ol>
<li>åº•å±‚å®ç°ï¼šå‰è€…æ˜¯æ•°ç»„ï¼Œåè€…æ˜¯é€šè¿‡<code>é™æ€å†…éƒ¨ç±»æ„å»ºçš„èŠ‚ç‚¹ç»„æˆçš„é“¾è¡¨</code>ã€‚</li>
<li>é”å®ç°ï¼šå‰è€…æ”¯æŒå…¬å¹³/éå…¬å¹³é”ï¼Œåè€…åª<code>æ”¯æŒéå…¬å¹³é”</code>ã€‚</li>
<li>é”æ•°é‡ï¼šå‰è€…æ˜¯<code>ä¸€æŠŠé”å’Œå®ƒçš„ä¸¤ä¸ªCondition</code>ï¼Œåè€…æ˜¯<code>ä¸¤ä¸ª(ä¸€æŠŠé”å’Œä»–çš„ä¸€ä¸ªCondition)</code>ï¼Œå› ä¸ºæœ‰ä¸¤æŠŠé”ï¼Œæ‰€ä»¥é‡‡ç”¨äº†<code>AtomicIntegeræ¥è¡¨ç¤ºcountå˜é‡</code>ã€‚</li>
</ol>
</blockquote>
<hr>
<h3 id="æ·»åŠ -1">æ·»åŠ </h3>
<h4 id="put-1">put</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>E e<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> InterruptedException <span style="color:#f92672">{</span>
    <span style="color:#75715e">// åˆ¤æ–­æ˜¯å¦ä¸ºnull
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>e <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> NullPointerException<span style="color:#f92672">();</span>
    <span style="color:#75715e">// è¿™é‡Œä¸ºä»€ä¹ˆåˆ›å»ºå±€éƒ¨å˜é‡c=-1ï¼Ÿå¦‚æœæ˜¯0ï¼Œé‚£ä¹ˆæ¯æ¬¡éƒ½ä¼š
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> c <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">;</span>
    <span style="color:#75715e">// å°†å½“å‰å…ƒç´ æ„å»ºæˆnodeå¯¹è±¡
</span><span style="color:#75715e"></span>    Node<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> node <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Node<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;(</span>e<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">final</span> ReentrantLock putLock <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">putLock</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">final</span> AtomicInteger count <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">count</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">// å¯ä¸­æ–­çš„è·å–puté”
</span><span style="color:#75715e"></span>    putLock<span style="color:#f92672">.</span><span style="color:#a6e22e">lockInterruptibly</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦å·²æ»¡
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>count<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> capacity<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// å¦‚æœå·²æ»¡ï¼Œæ·»åŠ åˆ°ç­‰å¾…æ·»åŠ æ¡ä»¶é˜Ÿåˆ—
</span><span style="color:#75715e"></span>            notFull<span style="color:#f92672">.</span><span style="color:#a6e22e">await</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">// å°†nodeå…¥é˜Ÿ
</span><span style="color:#75715e"></span>        enqueue<span style="color:#f92672">(</span>node<span style="color:#f92672">);</span>
        <span style="color:#75715e">// å°†é˜Ÿåˆ—å®¹é‡count+1çš„åŒæ—¶å°†countèµ‹å€¼ç»™c
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// ç¬¬ä¸€æ¬¡putæ—¶: c = 0,count = 1
</span><span style="color:#75715e"></span>        c <span style="color:#f92672">=</span> count<span style="color:#f92672">.</span><span style="color:#a6e22e">getAndIncrement</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">// åˆ¤æ–­æ˜¯å¦è¶…è¿‡æœ€å¤§å®¹é‡
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>c <span style="color:#f92672">+</span> 1 <span style="color:#f92672">&lt;</span> capacity<span style="color:#f92672">)</span>
            <span style="color:#75715e">// æ²¡æœ‰è¶…è¿‡å°±å”¤é†’æ·»åŠ å…ƒç´ é˜Ÿåˆ—ç»§ç»­æ·»åŠ 
</span><span style="color:#75715e"></span>            notFull<span style="color:#f92672">.</span><span style="color:#a6e22e">signal</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// é‡Šæ”¾puté”
</span><span style="color:#75715e"></span>        putLock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">// å¦‚æœc = 0é‚£ä¹ˆå”¤é†’ç­‰å¾…è·å–çš„æ¡ä»¶é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// å½“é˜Ÿåˆ—ä¸­åªæœ‰ä¸€ä¸ªnodeèŠ‚ç‚¹æ—¶c=0æˆç«‹
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>c <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span>
        signalNotEmpty<span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">enqueue</span><span style="color:#f92672">(</span>Node<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> node<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// å°†nodeåŠ å…¥é˜Ÿåˆ—ï¼Œå¹¶æˆä¸ºæ–°é˜Ÿå°¾ï¼Œè€é˜Ÿå°¾çš„nextæŒ‡é’ˆæŒ‡å‘node
</span><span style="color:#75715e"></span>    last <span style="color:#f92672">=</span> last<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span> <span style="color:#f92672">=</span> node<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#75715e">// åªèƒ½ç”±put/offerè°ƒç”¨
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">signalNotEmpty</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// è·å–takeé”
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> ReentrantLock takeLock <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">takeLock</span><span style="color:#f92672">;</span>
    takeLock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// å”¤é†’ç­‰å¾…è·å–çš„æ¡ä»¶é˜Ÿåˆ—çš„èŠ‚ç‚¹
</span><span style="color:#75715e"></span>        notEmpty<span style="color:#f92672">.</span><span style="color:#a6e22e">signal</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        takeLock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<p><code>LinkedBlockingQueue</code>putçš„æµç¨‹ä¸<code>ArrayBlockingQueue</code>æœ‰äº›ä¸åŒï¼š</p>
<ol>
<li>å½“å‰çº¿ç¨‹è·å–<code>puté”</code>åï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œé‚£ä¹ˆä¼šåŠ å…¥<code>ç­‰å¾…æ·»åŠ çš„æ¡ä»¶é˜Ÿåˆ—</code>ï¼Œå¦‚æœé˜Ÿåˆ—æœªæ»¡ï¼Œé‚£ä¹ˆä¼šå°è£…nodeåŠ å…¥é˜Ÿå°¾ã€‚</li>
<li>åŠ å…¥æˆåŠŸåä¼šå°†<code>count + 1</code>ï¼Œå¦‚æœ<code>count &lt; capacity</code>ï¼Œé‚£ä¹ˆå°±å”¤é†’<code>ç­‰å¾…æ·»åŠ çš„æ¡ä»¶é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹</code>ï¼Œæœ€åé‡Šæ”¾puté”ã€‚</li>
<li>å› ä¸ºæ˜¯ä¸¤æŠŠé”ï¼Œç†è®ºä¸Š<code>æ·»åŠ å’Œè·å–çš„æ“ä½œæ˜¯å¯ä»¥åŒæ—¶è¿›è¡Œçš„</code>ï¼Œæ‰€ä»¥ä»£ç æœ€åè¿˜éœ€è¦åˆ¤æ–­ä¸‹<code>count == 0</code>ï¼Œå¦‚æœæˆç«‹è¯´æ˜æ­¤æ—¶æ°å¥½æœ‰ä¸€ä¸ªæ•°æ®ï¼Œå”¤é†’<code>ç­‰å¾…è·å–é˜Ÿåˆ—ä¸­çº¿ç¨‹</code>æ¥è·å–ã€‚</li>
</ol>
</blockquote>
<h4 id="offer-1">offer</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">offer</span><span style="color:#f92672">(</span>E e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// åˆ¤æ–­æ˜¯å¦ä¸ºnull
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>e <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> NullPointerException<span style="color:#f92672">();</span>
    <span style="color:#66d9ef">final</span> AtomicInteger count <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">count</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">// å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›false
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>count<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> capacity<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">int</span> c <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">;</span>
    <span style="color:#75715e">// æ„å»ºæ–°node
</span><span style="color:#75715e"></span>    Node<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> node <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Node<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;(</span>e<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">final</span> ReentrantLock putLock <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">putLock</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">// è·å–puté”
</span><span style="color:#75715e"></span>    putLock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// å¦‚æœcountå°äºé˜Ÿåˆ—å®¹é‡
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>count<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span> <span style="color:#f92672">&lt;</span> capacity<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// åŠ å…¥é˜Ÿåˆ—
</span><span style="color:#75715e"></span>            enqueue<span style="color:#f92672">(</span>node<span style="color:#f92672">);</span>
            <span style="color:#75715e">// c = count, count = count+1
</span><span style="color:#75715e"></span>            c <span style="color:#f92672">=</span> count<span style="color:#f92672">.</span><span style="color:#a6e22e">getAndIncrement</span><span style="color:#f92672">();</span>
            <span style="color:#75715e">// ç»§ç»­åˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜Ÿåˆ—å®¹é‡
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>c <span style="color:#f92672">+</span> 1 <span style="color:#f92672">&lt;</span> capacity<span style="color:#f92672">)</span>
                <span style="color:#75715e">// æ²¡è¶…è¿‡å°±å”¤é†’ç­‰å¾…æ·»åŠ å…ƒç´ æ¡ä»¶é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹
</span><span style="color:#75715e"></span>                notFull<span style="color:#f92672">.</span><span style="color:#a6e22e">signal</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        putLock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">// c = 0è¯´æ˜æ­¤æ—¶é˜Ÿåˆ—ä¸­æ°å¥½ä¸€ä¸ªèŠ‚ç‚¹
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>c <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span>
        <span style="color:#75715e">// å”¤é†’ ç­‰å¾…è·å–å…ƒç´ æ¡ä»¶é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹
</span><span style="color:#75715e"></span>        signalNotEmpty<span style="color:#f92672">();</span>
    <span style="color:#75715e">// å¦‚æœc&lt;0è¯´æ˜é˜Ÿåˆ—å·²æ»¡æ— æ³•æ·»åŠ äº†
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> c <span style="color:#f92672">&gt;=</span> 0<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<p>ä¸put()ä¸åŒç‚¹åœ¨äºè¿”å›å€¼ï¼Œoffer()è¿”å›booleanå€¼ï¼Œå½“<code>é˜Ÿåˆ—æ»¡çš„æ—¶å€™è¿”å›false</code>ã€‚</p>
<p>offer(time)åœ¨é˜Ÿåˆ—æ»¡çš„æ—¶å€™<code>ç­‰å¾…æŒ‡å®šæ—¶é•¿</code>ï¼Œå¦‚æœ<code>å”¤é†’åé˜Ÿåˆ—è¿˜æ²¡æœ‰ç©ºé—´å°±è¿”å›false</code>ã€‚</p>
</blockquote>
<h4 id="è·å–-1">è·å–</h4>
<ul>
<li>take</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> E <span style="color:#a6e22e">take</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> InterruptedException <span style="color:#f92672">{</span>
    E x<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">int</span> c <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">final</span> AtomicInteger count <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">count</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">// è·å–takeé”
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> ReentrantLock takeLock <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">takeLock</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">// å¯ä¸­æ–­è·å–takeé”
</span><span style="color:#75715e"></span>    takeLock<span style="color:#f92672">.</span><span style="color:#a6e22e">lockInterruptibly</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>count<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// ä¸ºç©ºå°±åŠ å…¥ ç­‰å¾…è·å–å…ƒç´ æ¡ä»¶é˜Ÿåˆ—
</span><span style="color:#75715e"></span>            notEmpty<span style="color:#f92672">.</span><span style="color:#a6e22e">await</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">// é˜Ÿåˆ—ä¸ä¸ºç©ºè·å–é“¾è¡¨ä¸­çš„å¤´èŠ‚ç‚¹ä¸­å…ƒç´ 
</span><span style="color:#75715e"></span>        x <span style="color:#f92672">=</span> dequeue<span style="color:#f92672">();</span>
        <span style="color:#75715e">// c = count, count = count - 1
</span><span style="color:#75715e"></span>        c <span style="color:#f92672">=</span> count<span style="color:#f92672">.</span><span style="color:#a6e22e">getAndDecrement</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">// å¦‚æœc &gt; 1è¯´æ˜æ­¤æ—¶æ•°æ®å †ç§¯
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>c <span style="color:#f92672">&gt;</span> 1<span style="color:#f92672">)</span>
            <span style="color:#75715e">// å”¤é†’ ç­‰å¾…è·å–å…ƒç´ æ¡ä»¶é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹
</span><span style="color:#75715e"></span>            notEmpty<span style="color:#f92672">.</span><span style="color:#a6e22e">signal</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        takeLock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">// å¦‚æœ c = capacityæ—¶ï¼Œcount è‚¯å®šæ˜¯å°äºcapacityçš„
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>c <span style="color:#f92672">==</span> capacity<span style="color:#f92672">)</span>
        <span style="color:#75715e">// å”¤é†’ ç­‰å¾…æ·»åŠ å…ƒç´ æ¡ä»¶é˜Ÿåˆ—
</span><span style="color:#75715e"></span>        signalNotFull<span style="color:#f92672">();</span>
    <span style="color:#66d9ef">return</span> x<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// è·å–é“¾è¡¨ä¸­nodeèŠ‚ç‚¹ä¸­å…ƒç´ å¹¶è¿”å›
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> E <span style="color:#a6e22e">dequeue</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// è·å–å¤´èŠ‚ç‚¹
</span><span style="color:#75715e"></span>    Node<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> h <span style="color:#f92672">=</span> head<span style="color:#f92672">;</span>
    <span style="color:#75715e">// è·å–å¤´èŠ‚ç‚¹çš„nextèŠ‚ç‚¹
</span><span style="color:#75715e"></span>    Node<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> first <span style="color:#f92672">=</span> h<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">// å°†å¤´èŠ‚ç‚¹çš„nextè®¾ä¸ºè‡ªå·±æ–¹ä¾¿gc
</span><span style="color:#75715e"></span>    h<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span> <span style="color:#f92672">=</span> h<span style="color:#f92672">;</span>
    <span style="color:#75715e">// è®¾ç½®firstä¸ºheadèŠ‚ç‚¹
</span><span style="color:#75715e"></span>    head <span style="color:#f92672">=</span> first<span style="color:#f92672">;</span>
    <span style="color:#75715e">// è¿”å›firstä¸­çš„å…ƒç´ å¹¶å°†å…¶ç½®ä¸ºnull
</span><span style="color:#75715e"></span>    E x <span style="color:#f92672">=</span> first<span style="color:#f92672">.</span><span style="color:#a6e22e">item</span><span style="color:#f92672">;</span>
    first<span style="color:#f92672">.</span><span style="color:#a6e22e">item</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">return</span> x<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<ol>
<li>å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£ä¹ˆå°±å°†å½“å‰çº¿ç¨‹åŠ å…¥<code>ç­‰å¾…è·å–å…ƒç´ æ¡ä»¶é˜Ÿåˆ—</code>ã€‚</li>
<li><code>dequeue()</code>ä¼šå°†headçš„nextèŠ‚ç‚¹è®¾ä¸ºæ–°çš„headï¼Œ<code>è¿”å›å¹¶æ¸…ç©ºæ–°headçš„itemå±æ€§</code>ã€‚</li>
<li><code>c == capacity</code>æ—¶ä¸ºä½•è¦å”¤é†’<code>ç­‰å¾…æ·»åŠ å…ƒç´ æ¡ä»¶é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹</code>ï¼Ÿå› ä¸ºæ­¤æ—¶çš„<code>c = count + 1</code>ï¼Œæ‰€ä»¥è¿˜ç¼ºä¸€ä¸ªèŠ‚ç‚¹é˜Ÿåˆ—æ‰æ»¡ï¼Œæ‰€ä»¥å”¤é†’æ·»åŠ èŠ‚ç‚¹çš„æ¡ä»¶é˜Ÿåˆ—ã€‚</li>
<li>take()å½“<code>é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™ä¼šé˜»å¡</code>ï¼Œç›´åˆ°ä¸ä¸ºç©ºè·å–å…ƒç´ ã€‚</li>
</ol>
</blockquote>
<h4 id="poll-1">poll</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> E <span style="color:#a6e22e">poll</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">final</span> AtomicInteger count <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">count</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>count<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">// èµ‹å€¼null ä¸takeä¸åŒ
</span><span style="color:#75715e"></span>    E x <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">int</span> c <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">final</span> ReentrantLock takeLock <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">takeLock</span><span style="color:#f92672">;</span>
    takeLock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// ä¸takeçš„åŒºåˆ«ä¹‹å¤„
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>count<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span> <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            x <span style="color:#f92672">=</span> dequeue<span style="color:#f92672">();</span>
            c <span style="color:#f92672">=</span> count<span style="color:#f92672">.</span><span style="color:#a6e22e">getAndDecrement</span><span style="color:#f92672">();</span>
            <span style="color:#75715e">// å¦‚æœ c &gt; 1è¯´æ˜é˜Ÿåˆ—å­˜åœ¨å¾ˆå¤šæ•°æ®éœ€è¦take
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>c <span style="color:#f92672">&gt;</span> 1<span style="color:#f92672">)</span>
                <span style="color:#75715e">// ç»§ç»­å”¤é†’çº¿ç¨‹è·å–
</span><span style="color:#75715e"></span>                notEmpty<span style="color:#f92672">.</span><span style="color:#a6e22e">signal</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        takeLock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>c <span style="color:#f92672">==</span> capacity<span style="color:#f92672">)</span>
        signalNotFull<span style="color:#f92672">();</span>
    <span style="color:#66d9ef">return</span> x<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<p>å’Œtake()æ˜æ˜¾çš„åŒºåˆ«åœ¨äºï¼š<code>poll()åœ¨é˜Ÿåˆ—æ»¡çš„æ—¶å€™è¿”å›nullï¼Œå¹¶ä¸”ä¸ä¼šé˜»å¡</code>ã€‚</p>
<p>poll(time)ï¼š<code>é˜»å¡æŒ‡å®šæ—¶é•¿ï¼Œå”¤é†’åå¦‚æœé˜Ÿåˆ—ä»ä¸ºç©ºï¼Œé‚£ä¹ˆè¿”å›null</code>ã€‚</p>
</blockquote>
<h4 id="peek-1">peek</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> E <span style="color:#a6e22e">peek</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// å¦‚æœé˜Ÿåˆ—ä¸ºç©ºè¿”å›null
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>count<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">final</span> ReentrantLock takeLock <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">takeLock</span><span style="color:#f92672">;</span>
    takeLock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// è¿”å›headçš„nextèŠ‚ç‚¹ï¼Œå¹¶ä¸ä¼šåˆ é™¤nextèŠ‚ç‚¹
</span><span style="color:#75715e"></span>        Node<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> first <span style="color:#f92672">=</span> head<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">;</span>
        <span style="color:#75715e">// å¦‚æœé˜Ÿåˆ—åˆšåˆå§‹åŒ–é‚£ä¹ˆhead = last = new Node(null)
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// head.next = null
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// æ­¤æ—¶ä¹Ÿè¿”å›null
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>first <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">else</span>
            <span style="color:#75715e">// ä¸ä¸ºnullå°±è¿”å›item
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> first<span style="color:#f92672">.</span><span style="color:#a6e22e">item</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        takeLock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<p>peek()ç›¸æ¯”take()ï¼šé™¤äº†é˜Ÿåˆ—ä¸ºç©ºæ—¶è¿”å›nullå¤–ï¼Œè¿˜ä¸ä¼šé˜»å¡ç­‰å¾…ã€‚</p>
</blockquote>
<hr>
<h3 id="æ€»ç»“-1">æ€»ç»“</h3>
<ul>
<li><code>LinkedBlockingQueue</code>æ˜¯æ— ç•Œï¼ˆå¯ä»¥ä¸ä¼ é€’åˆå§‹é˜Ÿåˆ—å¤§å°ï¼‰é˜Ÿåˆ—ï¼Œä¸æŒ‡å®šå®¹é‡æ—¶é»˜è®¤<code>Integer.MAX_VALUE</code>ã€‚</li>
<li><code>LinkedBlockingQueue</code>çš„åº•å±‚æ˜¯ç”±<code>é“¾è¡¨ç»„æˆçš„</code>ï¼Œå®ƒ<code>head.item = null, last.next  = null</code>æ˜¯æ°¸è¿œæˆç«‹çš„ã€‚å¹¶ä¸”å®ƒä¹Ÿç¬¦åˆ<code>FIFO</code>è§„åˆ™ã€‚</li>
<li><code>LinkedBlockingQueue</code>æ‹¥æœ‰ä¸¤æŠŠé”ï¼Œåˆ†åˆ«å¯¹åº”ç€putå’Œtakeï¼Œæ‰€ä»¥countå˜é‡éœ€è¦åŒæ­¥ã€‚</li>
<li><code>LinkedBlockingQueue</code>å¯ä»¥å®ç°<code>é€»è¾‘ä¸ŠçœŸæ­£çš„åŒæ—¶takeå’Œput</code>ï¼Œæ‰€ä»¥æ€§èƒ½æ›´å¼ºã€‚</li>
</ul>
<hr>
<h3 id="priorityblockingqueue">PriorityBlockingQueue</h3>
<ul>
<li>
<p><code>PriorityBlockingQueue</code>æ˜¯ä¸ç¬¦åˆ<code>FIFO</code>è§„åˆ™çš„é˜Ÿåˆ—ï¼Œå®ƒæ˜¯æŒ‰ç…§<code>å…ƒç´ çš„ä¼˜å…ˆçº§ä»å°åˆ°å¤§å‡ºé˜Ÿåˆ—çš„</code>ï¼Œæ˜¯ç”±å…ƒç´ å®ç°<code>Comparator</code>æ¥å£æ¥å®ç°çš„ã€‚</p>
</li>
<li>
<p>é˜Ÿåˆ—<code>é»˜è®¤å®¹é‡11ï¼Œæœ€å¤§å®¹é‡Integer.MAX_VALUE - 8</code>ï¼Œåº•å±‚é€šè¿‡<code>ç‹¬å é”å’ŒConditionæ¡ä»¶é˜Ÿåˆ—</code>å®ç°ï¼Œä½†åªæœ‰<code>notEmpty</code>æ¡ä»¶é˜Ÿåˆ—ã€‚</p>
</li>
<li>
<p>å½“é˜Ÿåˆ—å¤§å°ä¸å¤Ÿæ—¶ä¼šæ‰©å®¹ï¼ˆä¸è¶…è¿‡MAX_SIZEï¼‰ï¼Œæ‰©å®¹è§„åˆ™å¦‚ä¸‹</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">int</span> newCap<span style="color:#f92672">=</span>oldCap<span style="color:#f92672">+((</span>oldCap <span style="color:#f92672">&lt;</span> 64<span style="color:#f92672">)?(</span>oldCap <span style="color:#f92672">+</span> 2<span style="color:#f92672">):(</span>oldCap <span style="color:#f92672">&gt;&gt;</span> 1<span style="color:#f92672">));</span>
</code></pre></div></li>
<li>
<p>åº•å±‚æ˜¯æ•°ç»„ï¼Œä½†æ˜¯ç”¨<code>æ•°ç»„å®ç°äº†äºŒå‰å †</code>ï¼Œæ’åœ¨<code>å †é¡¶</code>çš„å°±æ˜¯è¦å‡ºé˜Ÿçš„å…ƒç´ ã€‚</p>
</li>
</ul>
<h3 id="delayqueue">DelayQueue</h3>
<ul>
<li><code>å»¶è¿Ÿé˜Ÿåˆ—</code>ï¼Œä¸€ä¸ªæŒ‰ç…§<code>å»¶è¿Ÿæ—¶é—´ä»å°åˆ°å¤§å‡ºé˜Ÿçš„PriorityBlockingQueue</code>ã€‚</li>
<li>DelayQueueä¸­çš„å…ƒç´ å¿…é¡»è¦å®ç°<code>Delayed</code>æ¥å£ï¼Œå¤å†™<code>getDelayå’ŒcompareTo</code>æ–¹æ³•ã€‚</li>
<li><code>æœªæ¥æ—¶é—´ - å½“å‰æ—¶é—´ </code>ï¼Œå€¼è¶Šå°å°±è¶Šå…ˆå‡ºé˜Ÿï¼Œä½†å‰ææ˜¯<code>æ—¶é—´å·® &lt;= 0</code>ã€‚</li>
</ul>
<h3 id="synchronousqueue">SynchronousQueue</h3>
<ul>
<li><code>SynchronousQueue</code>é˜Ÿåˆ—æœ¬èº«å¹¶æ²¡æœ‰å®¹é‡çš„æ¦‚å¿µï¼Œ<code>å…ˆè°ƒç”¨putçš„çº¿ç¨‹ä¼šé˜»å¡ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†take</code>ã€‚å¦‚æœè°ƒç”¨å¤šæ¬¡putï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦è°ƒç”¨åŒæ ·æ¬¡æ•°çš„takeï¼Œæ‰èƒ½å…¨éƒ¨è§£é”ã€‚</li>
<li><code>SynchronousQueue</code>æ”¯æŒå…¬å¹³å’Œéå…¬å¹³å®ç°ï¼Œå‡è®¾è°ƒç”¨ä¸‰æ¬¡putï¼Œå…¬å¹³é”çš„æƒ…å†µä¸‹ï¼Œ<code>ç¬¬ä¸€ä¸ªtakeçš„çº¿ç¨‹å¯¹åº”ç€ç¬¬ä¸€ä¸ªputçš„çº¿ç¨‹</code>ï¼Œéå…¬å¹³é”æƒ…å†µä¸‹ï¼Œ<code>ç¬¬ä¸€ä¸ªtakeçš„çº¿ç¨‹å¯¹åº”ç€ç¬¬ä¸‰ä¸ªputçš„çº¿ç¨‹</code>ã€‚</li>
</ul>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">å…¶ä»–æ–‡ç« </span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://leejay.top/post/blockingdeque/">
                  <span class="button__icon">â†</span>
                  <span class="button__text">BlockingDeque</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://leejay.top/post/stampedlock/">
                  <span class="button__text">StampedLock</span>
                  <span class="button__icon">â†’</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">è‹ICPå¤‡18050258å·-1</div>
    
  </div>
</footer>

<script src="https://leejay.top/assets/main.js"></script>
<script src="https://leejay.top/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
