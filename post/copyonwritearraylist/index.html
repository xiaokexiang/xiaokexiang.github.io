<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>CopyOnWriteArrayList</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="CopyOnWriteArrayList  CopyOnWriteæ€æƒ³æ˜¯è®¡ç®—æœºç¨‹åºè®¾è®¡é¢†åŸŸçš„ä¸€ç§ä¼˜åŒ–ç­–ç•¥ã€‚è‹¥æœ‰å¤šä¸ªè°ƒç”¨è€…åŒæ—¶è¦æ±‚ç›¸åŒçš„èµ„æºï¼Œä»–ä»¬ä¼šè·å¾—å…±åŒçš„æŒ‡é’ˆæŒ‡å‘ç›¸åŒçš„èµ„æºï¼Œç›´åˆ°æŸä¸ªè°ƒç”¨è€…è¯•å›¾ä¿®æ”¹èµ„æºçš„æ—¶å€™ï¼Œæ‰ä¼šå¤åˆ¶ä¸€ä»½å‰¯æœ¬ç»™è¯¥è°ƒç”¨è€…ï¼Œä½†å…¶ä»–è°ƒç”¨è€…è§åˆ°çš„æœ€åˆèµ„æºä¸æ”¹å˜ï¼Œæ­¤è¿‡ç¨‹å¯¹å…¶ä»–è°ƒç”¨è€…é€æ˜ã€‚
CopyOnWriteArrayListæ˜¯ArrayListçš„çº¿ç¨‹å®‰å…¨å˜ä½“ï¼Œé€šè¿‡ç”Ÿæˆæ–°çš„å‰¯æœ¬æ¥å®ç°ã€‚
 æ„é€  public class CopyOnWriteArrayList&amp;lt;E&amp;gt; implements List&amp;lt;E&amp;gt;, RandomAccess, Cloneable, java.io.Serializable { // å†…éƒ¨ç‹¬å é”  final transient ReentrantLock lock = new ReentrantLock(); // volatile ä¿®é¥°çš„æ•°ç»„ï¼Œåªèƒ½getArrayå’ŒsetArrayæ“ä½œ  private transient volatile Object[] array; // è¿”å›å½“å‰æ•°ç»„  final Object[] getArray() { return array; } // è®¾ç½®æ•°ç»„  final void setArray(Object[] a) { array = a; } // æ„é€ å‡½æ•° åˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„  public CopyOnWriteArrayList() { setArray(new Object[0]); } }  åº•å±‚æ˜¯é€šè¿‡æ•°ç»„å®ç°ï¼Œæ•°ç»„ä½¿ç”¨volatileä¿®é¥°ä¿è¯äº†å¤šçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ã€‚
  add public boolean add(E e) { // è·å–ç‹¬å é”  final ReentrantLock lock = this."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://leejay.top/post/copyonwritearraylist/" />





<link rel="stylesheet" href="https://leejay.top/assets/style.css">


<link rel="stylesheet" href="https://leejay.top/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://leejay.top/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="https://leejay.top/img/favicon.png">



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CopyOnWriteArrayList"/>
<meta name="twitter:description" content="`CopyOnWriteArrayList`æ˜¯ArrayListçš„çº¿ç¨‹å®‰å…¨å˜ä½“ï¼Œæ˜¯é€šè¿‡`ç”Ÿæˆæ–°çš„å‰¯æœ¬`æ¥å®ç°çº¿ç¨‹å®‰å…¨ã€‚"/>



<meta property="og:title" content="CopyOnWriteArrayList" />
<meta property="og:description" content="`CopyOnWriteArrayList`æ˜¯ArrayListçš„çº¿ç¨‹å®‰å…¨å˜ä½“ï¼Œæ˜¯é€šè¿‡`ç”Ÿæˆæ–°çš„å‰¯æœ¬`æ¥å®ç°çº¿ç¨‹å®‰å…¨ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://leejay.top/post/copyonwritearraylist/" />
<meta property="article:published_time" content="2020-07-08T11:50:04+08:00" />
<meta property="article:modified_time" content="2020-07-08T11:50:04+08:00" /><meta property="og:site_name" content="Aurora" />






  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="https://leejay.top" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="https://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg></span>
    <span class="logo__text">Aurora</span>
    <span class="logo__cursor"></span>
    <span class="logo__cursor2"></span>
  
</a>
    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/categories">Categories</a></li>
        
      
        
          <li><a href="/tags">Tags</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/categories">Categories</a></li>
      
    
      
        <li><a href="/tags">Tags</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="https://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title"><a href="https://leejay.top/post/copyonwritearraylist/">CopyOnWriteArrayList</a></h1>
    <div class="post-meta">
      
        <span class="post-date">
          2020-07-08
        </span>

        
          
        
      

      
      
    </div>

    
      <span class="post-tags">
        
        ğŸ–<a href="https://leejay.top/tags/copyonwritearraylist/">CopyOnWriteArrayList </a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      
      <h3 id="copyonwritearraylist">CopyOnWriteArrayList</h3>
<blockquote>
<p><code>CopyOnWrite</code>æ€æƒ³æ˜¯è®¡ç®—æœºç¨‹åºè®¾è®¡é¢†åŸŸçš„ä¸€ç§ä¼˜åŒ–ç­–ç•¥ã€‚è‹¥æœ‰å¤šä¸ªè°ƒç”¨è€…åŒæ—¶è¦æ±‚ç›¸åŒçš„èµ„æºï¼Œä»–ä»¬ä¼šè·å¾—<code>å…±åŒçš„æŒ‡é’ˆ</code>æŒ‡å‘ç›¸åŒçš„èµ„æºï¼Œç›´åˆ°æŸä¸ªè°ƒç”¨è€…è¯•å›¾ä¿®æ”¹èµ„æºçš„æ—¶å€™ï¼Œæ‰ä¼š<code>å¤åˆ¶ä¸€ä»½å‰¯æœ¬</code>ç»™è¯¥è°ƒç”¨è€…ï¼Œä½†<code>å…¶ä»–è°ƒç”¨è€…è§åˆ°çš„æœ€åˆèµ„æºä¸æ”¹å˜</code>ï¼Œæ­¤è¿‡ç¨‹<code>å¯¹å…¶ä»–è°ƒç”¨è€…é€æ˜</code>ã€‚</p>
<p><code>CopyOnWriteArrayList</code>æ˜¯ArrayListçš„çº¿ç¨‹å®‰å…¨å˜ä½“ï¼Œé€šè¿‡<code>ç”Ÿæˆæ–°çš„å‰¯æœ¬</code>æ¥å®ç°ã€‚</p>
</blockquote>
<h4 id="æ„é€ ">æ„é€ </h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CopyOnWriteArrayList</span><span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span>
    <span style="color:#66d9ef">implements</span> List<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;,</span> RandomAccess<span style="color:#f92672">,</span> Cloneable<span style="color:#f92672">,</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">io</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Serializable</span> <span style="color:#f92672">{</span>
    
  	<span style="color:#75715e">// å†…éƒ¨ç‹¬å é”
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">transient</span> ReentrantLock lock <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ReentrantLock<span style="color:#f92672">();</span>
	<span style="color:#75715e">// volatile ä¿®é¥°çš„æ•°ç»„ï¼Œåªèƒ½getArrayå’ŒsetArrayæ“ä½œ
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">transient</span> <span style="color:#66d9ef">volatile</span> Object<span style="color:#f92672">[]</span> array<span style="color:#f92672">;</span>
	<span style="color:#75715e">// è¿”å›å½“å‰æ•°ç»„
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> Object<span style="color:#f92672">[]</span> <span style="color:#a6e22e">getArray</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> array<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
	<span style="color:#75715e">// è®¾ç½®æ•°ç»„
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setArray</span><span style="color:#f92672">(</span>Object<span style="color:#f92672">[]</span> a<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        array <span style="color:#f92672">=</span> a<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
	<span style="color:#75715e">// æ„é€ å‡½æ•° åˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">CopyOnWriteArrayList</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        setArray<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Object<span style="color:#f92672">[</span>0<span style="color:#f92672">]);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<p>åº•å±‚æ˜¯é€šè¿‡æ•°ç»„å®ç°ï¼Œæ•°ç»„ä½¿ç”¨<code>volatile</code>ä¿®é¥°ä¿è¯äº†å¤šçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ã€‚</p>
</blockquote>
<hr>
<h3 id="add">add</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>E e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// è·å–ç‹¬å é”
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> ReentrantLock lock <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">;</span>
    lock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// è·å–å½“å‰çš„æ•°ç»„ï¼Œæ­¤æ—¶ä¸ä¼šå­˜åœ¨å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†æ•°ç»„
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// åªæ˜¯addæœŸé—´è‹¥æœ‰å…¶ä»–çº¿ç¨‹æŸ¥è¯¢ï¼Œé‚£ä¹ˆæŸ¥åˆ°çš„æ˜¯æ—§çš„æ•°æ®
</span><span style="color:#75715e"></span>        Object<span style="color:#f92672">[]</span> elements <span style="color:#f92672">=</span> getArray<span style="color:#f92672">();</span>
        <span style="color:#75715e">// è·å–æ•°ç»„é•¿åº¦
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> len <span style="color:#f92672">=</span> elements<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span>
        <span style="color:#75715e">// copyæ•°ç»„å¹¶å°†æ•°ç»„æ‰©å¤§1
</span><span style="color:#75715e"></span>        Object<span style="color:#f92672">[]</span> newElements <span style="color:#f92672">=</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">copyOf</span><span style="color:#f92672">(</span>elements<span style="color:#f92672">,</span> len <span style="color:#f92672">+</span> 1<span style="color:#f92672">);</span>
        <span style="color:#75715e">// å°†å…ƒç´ æ’å…¥æ•°ç»„çš„æœ€å
</span><span style="color:#75715e"></span>        newElements<span style="color:#f92672">[</span>len<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> e<span style="color:#f92672">;</span>
        <span style="color:#75715e">// è®¾ç½®æ•°ç»„åˆ°æˆå‘˜å˜é‡arrayä¸­
</span><span style="color:#75715e"></span>        setArray<span style="color:#f92672">(</span>newElements<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        lock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<p>addæ“ä½œéœ€è¦è·å–ç‹¬å é”ï¼Œåœ¨æ‰§è¡Œaddæ“ä½œæœŸé—´ï¼Œè‹¥æœ‰å…¶ä»–çº¿ç¨‹æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œé‚£ä¹ˆå®ƒè·å¾—å°†ä¼šæ˜¯æ—§çš„æ•°æ®ã€‚åœ¨addæ“ä½œä¹‹åæŸ¥è¯¢ï¼Œè·å¾—ä¼šæ˜¯æœ€æ–°çš„æ•°æ®ã€‚</p>
<p>åº•å±‚è°ƒç”¨çš„æ—¶<code>System.arraycopy</code>å®ç°æ•°ç»„çš„æ‹·è´ï¼Œéœ€è¦æ³¨æ„ï¼š</p>
<ol>
<li>æ­¤æ–¹æ³•å±äº<code>æµ…æ‹·è´ï¼ˆå¤åˆ¶çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼‰</code>ï¼Œå¦‚æœæ˜¯æ•°ç»„ç±»å‹æ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆ<code>æ‹·è´åçš„æ•°ç»„æŒæœ‰çš„æ˜¯åŸæ•°ç»„çš„å¼•ç”¨</code>ã€‚æ‰€ä»¥<code>æ‹·è´åçš„æ•°ç»„ä¿®æ”¹ä¼šå½±å“åŸæ•°ç»„</code>ã€‚</li>
<li>å¦‚æœæ•°ç»„ç±»å‹æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå€¼ä½äºå¸¸é‡æ± ï¼‰ï¼Œé‚£ä¹ˆ<code>æ‹·è´åªæ˜¯ä¿®æ”¹æ•°ç»„ä¸­å…ƒç´ çš„æŒ‡å‘</code>ï¼Œå¹¶ä¸æ˜¯åœ¨å¸¸é‡æ± ä¸­åˆå¤åˆ¶äº†ä¸€ä»½ã€‚</li>
</ol>
<p><img src="https://image.leejay.top/image/20200709/BlpbAEFkBDBa.png?imageslim" alt=""></p>
</blockquote>
<hr>
<h3 id="remove">remove</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// ç§»é™¤æŒ‡å®šindexå…ƒç´ 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> E <span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> index<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">final</span> ReentrantLock lock <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">// è·å–ç‹¬å é”
</span><span style="color:#75715e"></span>    lock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// è·å–æ•°ç»„
</span><span style="color:#75715e"></span>        Object<span style="color:#f92672">[]</span> elements <span style="color:#f92672">=</span> getArray<span style="color:#f92672">();</span>
        <span style="color:#75715e">// è·å–æ•°ç»„length
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> len <span style="color:#f92672">=</span> elements<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span>
        <span style="color:#75715e">// è·å–oldæ•°ç»„[index]æ•°æ®
</span><span style="color:#75715e"></span>        E oldValue <span style="color:#f92672">=</span> get<span style="color:#f92672">(</span>elements<span style="color:#f92672">,</span> index<span style="color:#f92672">);</span>
        <span style="color:#75715e">// index + 1 = length 
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> numMoved <span style="color:#f92672">=</span> len <span style="color:#f92672">-</span> index <span style="color:#f92672">-</span> 1<span style="color:#f92672">;</span>
		<span style="color:#75715e">// numMoved = 0è¯´æ˜ç§»é™¤çš„æ˜¯æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ 
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>numMoved <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span>
            <span style="color:#75715e">// ç›´æ¥å°†é•¿åº¦å‡1ç›´æ¥copyå³å¯ã€‚
</span><span style="color:#75715e"></span>            setArray<span style="color:#f92672">(</span>Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">copyOf</span><span style="color:#f92672">(</span>elements<span style="color:#f92672">,</span> len <span style="color:#f92672">-</span> 1<span style="color:#f92672">));</span>
        <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// å¦åˆ™è¯´æ˜ç§»é™¤çš„æ˜¯ä¸­é—´çš„å…ƒç´ 
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// åˆ›å»ºå°1çš„æ•°ç»„
</span><span style="color:#75715e"></span>            Object<span style="color:#f92672">[]</span> newElements <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Object<span style="color:#f92672">[</span>len <span style="color:#f92672">-</span> 1<span style="color:#f92672">];</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">arraycopy</span><span style="color:#f92672">(</span>elements<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> newElements<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> index<span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">arraycopy</span><span style="color:#f92672">(</span>elements<span style="color:#f92672">,</span> index <span style="color:#f92672">+</span> 1<span style="color:#f92672">,</span> newElements<span style="color:#f92672">,</span> index<span style="color:#f92672">,</span> numMoved<span style="color:#f92672">);</span>
            <span style="color:#75715e">// è®¾ç½®æ‹·è´åçš„æ–°æ•°ç»„
</span><span style="color:#75715e"></span>            setArray<span style="color:#f92672">(</span>newElements<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">// è¿”å›è¢«åˆ é™¤çš„æ—§å€¼
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> oldValue<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        lock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<p>removeæ–¹æ³•çš„éš¾åº¦åœ¨äº<code>å¦‚ä½•ç§»é™¤oldValueå¹¶å°†åŸæœ‰çš„æ•°æ®å¹³ç§»åˆ°æ–°çš„æ•°ç»„ä¸­</code>ã€‚</p>
<p>æˆ‘ä»¬å‡è®¾<code>Object[] objs = [2, 3, 5, 7, 9];length = 5,index&lt;=length-1</code>ï¼š</p>
<ol>
<li>å¦‚æœæˆ‘ä»¬ç§»é™¤çš„æ˜¯<code>index = 4</code>çš„å…ƒç´ ï¼ˆå³æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œé‚£ä¹ˆç›´æ¥åˆ›å»º<code>length = 4</code>çš„æ•°ç»„ï¼Œå°†æ•°æ®ç›´æ¥æ‹·è´è¿‡å»å°±è¡Œï¼Œå˜æˆ<code>[2,3,5,7]</code>ã€‚</li>
<li>å¦‚æœæˆ‘ä»¬ç§»é™¤æ˜¯ç¬¬ä¸‰ä¸ªå…ƒç´ (index = 2)ï¼Œé‚£ä¹ˆæŒ‰ç…§æºç ä¸­çš„æ–¹æ³•ï¼šç¬¬ä¸€æ¬¡æ‹·è´åï¼Œ<code>newElements = [2,3]</code>ï¼Œæ­¤æ—¶<code>numMoved = 2</code>ï¼Œé‚£ä¹ˆæ‰§è¡Œç¬¬äºŒä¸ªæ‹·è´ä¹‹åï¼Œ<code>newElements = [2,3,7,9]</code>ã€‚</li>
</ol>
</blockquote>
<hr>
<h3 id="set">set</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// å°†æ•°ç»„çš„æŒ‡å®šindexæ”¹æˆæŒ‡å®šå€¼
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> E <span style="color:#a6e22e">set</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> index<span style="color:#f92672">,</span> E element<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">final</span> ReentrantLock lock <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">// è·å–ç‹¬å é”
</span><span style="color:#75715e"></span>    lock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// è·å–æ•°ç»„
</span><span style="color:#75715e"></span>        Object<span style="color:#f92672">[]</span> elements <span style="color:#f92672">=</span> getArray<span style="color:#f92672">();</span>
        <span style="color:#75715e">// è·å–æŒ‡å®šindexçš„å€¼
</span><span style="color:#75715e"></span>        E oldValue <span style="color:#f92672">=</span> get<span style="color:#f92672">(</span>elements<span style="color:#f92672">,</span> index<span style="color:#f92672">);</span>
		<span style="color:#75715e">// åˆ¤æ–­æ–°æ—§å€¼æ˜¯å¦ç›¸åŒï¼Œç›¸åŒå°±ä¸éœ€è¦æ›´æ”¹
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>oldValue <span style="color:#f92672">!=</span> element<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// è®¡ç®—æ•°ç»„é•¿åº¦
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">int</span> len <span style="color:#f92672">=</span> elements<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span>
            <span style="color:#75715e">// åˆ›å»ºæ–°æ•°ç»„
</span><span style="color:#75715e"></span>            Object<span style="color:#f92672">[]</span> newElements <span style="color:#f92672">=</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">copyOf</span><span style="color:#f92672">(</span>elements<span style="color:#f92672">,</span> len<span style="color:#f92672">);</span>
            <span style="color:#75715e">// å°†æ•°ç»„çš„æŒ‡å®šindexiuè¯¥
</span><span style="color:#75715e"></span>            newElements<span style="color:#f92672">[</span>index<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> element<span style="color:#f92672">;</span>
            <span style="color:#75715e">// è®¾ç½®æ–°æ•°ç»„
</span><span style="color:#75715e"></span>            setArray<span style="color:#f92672">(</span>newElements<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// å¹¶éå®Œå…¨ç¦æ­¢æ“ä½œï¼›ç¡®ä¿å¯å˜çš„å†™è¯­ä¹‰
</span><span style="color:#75715e"></span>            setArray<span style="color:#f92672">(</span>elements<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> oldValue<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        lock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<p>åŸºäº<code>CopyOnWrite</code>åŸç†ï¼Œsetæ–¹æ³•ä¹Ÿéœ€è¦é‡æ–°copyä¸€ä»½æ•°ç»„ã€‚</p>
</blockquote>
<hr>
<h3 id="get">get</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// è·å–æŸä¸ªindexå…ƒç´ 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> E <span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> index<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// getçš„æ•°æ®æœ‰å¯èƒ½ä¸æ˜¯æœ€æ–°çš„ï¼Œå› ä¸ºè¯»å†™ä¸äº’æ–¥
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// æ­¤æ—¶ä¸€ä¸ªçº¿ç¨‹å·²ç»å¤åˆ¶äº†æ•°æ®ï¼Œè¿˜æ²¡æœ‰setArrayï¼Œgetåˆ°çš„å°±ä¸æ˜¯æœ€æ–°çš„
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> get<span style="color:#f92672">(</span>getArray<span style="color:#f92672">(),</span> index<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
<span style="color:#75715e">// å°±æ˜¯è¿”å›æ•°ç»„çš„indexçš„æ•°æ®
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> E <span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>Object<span style="color:#f92672">[]</span> a<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> index<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>E<span style="color:#f92672">)</span> a<span style="color:#f92672">[</span>index<span style="color:#f92672">];</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<p>getæ–¹æ³•èƒ½å¤Ÿä¿è¯æ¯æ¬¡è·å–åˆ°çš„æ•°æ®éƒ½æ˜¯<code>å½“æ—¶æœ€æ–°</code>çš„æ•°æ®ï¼ˆåŸºäºvolatileï¼‰ã€‚</p>
</blockquote>
<hr>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<ul>
<li>
<p><code>CopyOnWriteArrayList</code>é€‚ç”¨äº<code>è¯»å¤šå†™å°‘</code>çš„å¹¶å‘åœºæ™¯ï¼Œå®ƒå…è®¸<code>nullä¸”å¯ä»¥é‡å¤</code>ã€‚</p>
</li>
<li>
<p><code>CopyOnWriteArrayList</code>æ·»åŠ å…ƒç´ æ—¶å»ºè®®ä½¿ç”¨<code>æ‰¹é‡æ·»åŠ </code>ï¼Œå› ä¸ºæ¯æ¬¡æ·»åŠ éƒ½è¦å¤åˆ¶ã€‚</p>
</li>
<li>
<p><code>CopyOnWriteArrayList</code>çš„æ˜¯é€šè¿‡<code>å†™æ—¶æ•°ç»„copy</code>æ¥å®ç°ï¼Œåœ¨å†™æ“ä½œçš„æ—¶å€™ï¼Œå†…å­˜ä¸­ä¼šåŒæ—¶å…·æœ‰ä¸¤ä¸ªå¯¹è±¡çš„å†…å­˜ï¼Œå¦‚æœè¿™ä¸ªæ•°ç»„å¯¹è±¡è¿‡å¤§ï¼Œä¼šå¯¼è‡´<code>å†…å­˜å ç”¨</code>é—®é¢˜ã€‚</p>
</li>
<li>
<p><code>CopyOnWriteArrayList</code>åªèƒ½ä¿è¯<code>æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§</code>ï¼Œä¸ä¿è¯æ•°æ®å®æ—¶ä¸€è‡´æ€§ï¼ˆè¯»å†™ä¸äº’æ–¥ï¼Œæœ‰çº¿ç¨‹ä¿®æ”¹æ•°æ®å·²ç»å¤åˆ¶äº†å‰¯æœ¬ï¼Œè¿˜æœªæ‰§è¡ŒsetArrayæ—¶ï¼Œä½ è¯»åˆ°çš„å°±æ˜¯æ—§æ•°æ®ï¼‰ã€‚</p>
</li>
</ul>
<blockquote>
<p>å¦‚æœéœ€è¦ä½¿ç”¨ä¸é‡å¤çš„<code>CopyOnWrite</code>æ¡†æ¶ï¼Œæ¨è<code>CopyOnWriteArraySet</code>ã€‚å®ƒèƒ½å¤Ÿå®ç°ä¸é‡å¤ï¼Œæ ¸å¿ƒåŸç†å°±æ˜¯æ·»åŠ çš„æ—¶å€™é€šè¿‡<code>addIfAbsent</code>åˆ¤æ–­å…ƒç´ æ˜¯å¦å·²å­˜åœ¨ã€‚</p>
</blockquote>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">å…¶ä»–æ–‡ç« </span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://leejay.top/post/concurrentlinkedqueue/">
                  <span class="button__icon">â†</span>
                  <span class="button__text">ConcurrentLinkedQueue</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://leejay.top/post/blockingdeque/">
                  <span class="button__text">BlockingDeque</span>
                  <span class="button__icon">â†’</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">è‹ICPå¤‡18050258å·-1</div>
    
  </div>
</footer>

<script src="https://leejay.top/assets/main.js"></script>
<script src="https://leejay.top/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
