<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Go语言实战 :: Keep Improving</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="1.1 名称 函数、变量、常量、类型、语句标签和包都遵循: 字母或下划线开头，后面跟随任意数量的字符，数字和下划线，并且区分大小写。 若实体在函数中声明，那么实体只在函数局部有效。如果声明在函数外，将对包内所有源文件可见。 实体的第一个字母的大小写决定其可见性是否跨包，大写表示对包外是可见和可访问的。 1.2 声明 package main import &amp;#34;fmt&amp;#34; const commonConstant = &amp;#34;common&amp;#34; func main() { var a = commonConstant var b string // 会默认初始化为&amp;#34;&amp;#34; var c string = &amp;#34;c&amp;#34; var d = &amp;#34;d&amp;#34; e := &amp;#34;e&amp;#34; // 短变量声明 x, y := true, 2.3 // 一次定义多个变量 fmt.Println(a) // common fmt.Println(b) // &amp;#34;&amp;#34; fmt.Println(c) // c fmt.Println(d) // d fmt.Println(e) // e fmt.Println(x) fmt.Println(y) } 定义变量时如果不指定初始值，那么默认初始化为零值（int为0，string为&amp;quot;&amp;quot;&amp;hellip;） 1.3 变量 1." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://leejay.top/post/go/" />




<link rel="stylesheet" href="https://leejay.top/assets/style.css">






<link rel="apple-touch-icon" href="https://leejay.top/img/favicon.png">

  <link rel="shortcut icon" href="https://leejay.top/img/favicon.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Go语言实战">
<meta property="og:description" content="Go语言（Golang）是一种由Google开发的开源编程语言，它注重简洁、高效、并发编程。它具有强大的并发支持、垃圾回收、静态类型和编译型等特点，旨在提供高性能的系统编程和大规模分布式系统开发的语言。" />
<meta property="og:url" content="https://leejay.top/post/go/" />
<meta property="og:site_name" content="Keep Improving" />

  
    <meta property="og:image" content="https://leejay.top/img/favicon.png">
  

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

  <meta property="article:section" content="go" />


  <meta property="article:published_time" content="2023-11-03 20:51:29 &#43;0800 &#43;0800" />










<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Code">

</head>
<body class="orange">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="https://leejay.top">
  <div class="logo">
    HelloWorld
  </div>
</a>

    </div>
    
  </div>
  
  
  
  <script async src="https://cdn.bootcdn.net/ajax/libs/mermaid/9.1.1/mermaid.min.js"></script>
  
  <script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>

</header>


  <div class="content">
    
<div class="post">
  
  
    









<div class="toc" id="toc_id">

    <div class="page-header"><strong> ↓ 目录 ↓ </strong></div>

    <div id="page-scrollspy" class="toc-nav">

        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#11-%e5%90%8d%e7%a7%b0">
                    1.1 名称
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#12-%e5%a3%b0%e6%98%8e">
                    1.2 声明
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#13-%e5%8f%98%e9%87%8f">
                    1.3 变量
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#131-%e6%8c%87%e9%92%88">
                    1.3.1 指针
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#132-new">
                    1.3.2 new
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#133-%e5%8f%98%e9%87%8f%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f">
                    1.3.3 变量的生命周期
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#14-%e8%b5%8b%e5%80%bc">
                    1.4 赋值
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#15-%e5%8c%85%e5%92%8c%e6%96%87%e4%bb%b6">
                    1.5 包和文件
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#21-%e5%9f%ba%e7%a1%80%e7%b1%bb%e5%9e%8b">
                    2.1 基础类型
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#211-%e6%95%b4%e6%95%b0">
                    2.1.1 整数
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#212-%e6%b5%ae%e7%82%b9%e6%95%b0">
                    2.1.2 浮点数
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#213-%e5%b8%83%e5%b0%94%e5%80%bc">
                    2.1.3 布尔值
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#214-%e5%ad%97%e7%ac%a6%e4%b8%b2">
                    2.1.4 字符串
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#215-%e5%b8%b8%e9%87%8f">
                    2.1.5 常量
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#221-%e6%95%b0%e7%bb%84">
                    2.2.1 数组
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#222-slice">
                    2.2.2 slice
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#223-map">
                    2.2.3 map
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#224-%e7%bb%93%e6%9e%84%e4%bd%93">
                    2.2.4 结构体
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#225-json">
                    2.2.5 JSON
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#226-%e6%96%87%e4%bb%b6%e4%b8%8ehtml">
                    2.2.6 文件与html
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#3-%e5%87%bd%e6%95%b0">
                    3. 函数
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#31-%e5%87%bd%e6%95%b0%e5%a3%b0%e6%98%8e">
                    3.1 函数声明
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#32-%e5%bc%82%e5%b8%b8%e6%9e%84%e5%bb%ba">
                    3.2 异常构建
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#33-%e5%8c%bf%e5%90%8d%e5%87%bd%e6%95%b0">
                    3.3 匿名函数
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#331-%e8%bf%ad%e4%bb%a3%e5%8f%98%e9%87%8f%e6%8d%95%e8%8e%b7">
                    3.3.1 迭代变量捕获
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#334-%e5%8f%98%e9%95%bf%e5%87%bd%e6%95%b0">
                    3.3.4 变长函数
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#335-%e5%bb%b6%e8%bf%9f%e5%87%bd%e6%95%b0">
                    3.3.5 延迟函数
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#336-%e5%ae%95%e6%9c%ba%e4%b8%8e%e6%81%a2%e5%a4%8d">
                    3.3.6 宕机与恢复
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#4-%e6%96%b9%e6%b3%95">
                    4. 方法
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#41-%e5%ae%9a%e4%b9%89">
                    4.1 定义
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#42-%e7%bb%93%e6%9e%84%e4%bd%93%e5%86%85%e5%b5%8c%e7%9a%84%e7%b1%bb%e5%9e%8b">
                    4.2 结构体内嵌的类型
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#42-%e6%96%b9%e6%b3%95%e5%8f%98%e9%87%8f%e5%92%8c%e6%96%b9%e6%b3%95%e8%a1%a8%e8%be%be%e5%bc%8f">
                    4.2 方法变量和方法表达式
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#43-%e5%b0%81%e8%a3%85">
                    4.3 封装
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#5-%e6%8e%a5%e5%8f%a3">
                    5. 接口
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#51-%e6%8e%a5%e5%8f%a3%e6%96%ad%e8%a8%80">
                    5.1 接口断言
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#6-goroutine%e5%92%8cchannel">
                    6. goroutine和channel
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#61-goroutine">
                    6.1 goroutine
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#62-channel">
                    6.2 channel
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#621-%e5%8d%95%e5%90%91%e9%80%9a%e9%81%93%e7%b1%bb%e5%9e%8b">
                    6.2.1 单向通道类型
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#63-waitgroup">
                    6.3 WaitGroup
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#64-select%e5%a4%9a%e8%b7%af%e5%a4%8d%e7%94%a8">
                    6.4 select多路复用
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#641-%e5%b9%b6%e5%8f%91%e7%9b%ae%e5%bd%95%e9%81%8d%e5%8e%86">
                    6.4.1 并发目录遍历
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#7-%e5%b9%b6%e5%8f%91%e5%92%8c%e5%85%b1%e4%ba%ab%e5%8f%98%e9%87%8f">
                    7. 并发和共享变量
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#71-syncmutex">
                    7.1 sync.Mutex
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#72-syncrwmutex">
                    7.2 sync.RWMutex
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#73-%e5%86%85%e5%ad%98%e5%90%8c%e6%ad%a5">
                    7.3 内存同步
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#74-synconce">
                    7.4 sync.Once
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#75-goroutine%e4%b8%8e%e7%ba%bf%e7%a8%8b">
                    7.5 goroutine与线程
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#751-%e6%a0%88">
                    7.5.1 栈
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#752-%e8%b0%83%e5%ba%a6">
                    7.5.2 调度
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#753-gomaxprocs">
                    7.5.3 GOMAXPROCS
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#754-goroutine%e6%a0%87%e8%af%86">
                    7.5.4 goroutine标识
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#8-%e5%8f%8d%e5%b0%84">
                    8. 反射
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#81-type">
                    8.1 Type
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#811-%e8%8e%b7%e5%8f%96%e5%8f%98%e9%87%8f%e7%9a%84%e7%b1%bb%e5%9e%8b">
                    8.1.1 获取变量的类型
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#812-%e8%8e%b7%e5%8f%96%e7%bb%93%e6%9e%84%e4%bd%93%e6%88%90%e5%91%98%e5%8f%98%e9%87%8f">
                    8.1.2 获取结构体成员变量
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#813-%e8%8e%b7%e5%8f%96%e7%bb%93%e6%9e%84%e4%bd%93%e7%9a%84%e6%88%90%e5%91%98%e6%96%b9%e6%b3%95">
                    8.1.3 获取结构体的成员方法
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#814-%e8%8e%b7%e5%8f%96%e5%87%bd%e6%95%b0%e4%bf%a1%e6%81%af">
                    8.1.4 获取函数信息
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#815-%e5%88%a4%e6%96%ad%e6%98%af%e5%90%a6%e5%ae%9e%e7%8e%b0%e6%8e%a5%e5%8f%a3">
                    8.1.5 判断是否实现接口
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#82-value">
                    8.2 Value
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#821-%e5%9f%ba%e6%9c%ac%e6%93%8d%e4%bd%9c">
                    8.2.1 基本操作
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#822-%e4%bf%ae%e6%94%b9%e5%8f%98%e9%87%8f">
                    8.2.2 修改变量
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#823-%e8%b0%83%e7%94%a8%e5%87%bd%e6%95%b0">
                    8.2.3 调用函数
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#824-%e8%b0%83%e7%94%a8%e6%88%90%e5%91%98%e6%96%b9%e6%b3%95">
                    8.2.4 调用成员方法
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        

    </div>

</div>



  
  <h1 class="post-title">
    <a href="https://leejay.top/post/go/">Go语言实战</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2023-11-03 
      </span>
    
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://leejay.top/tags/go-/">go </a>&nbsp;
    
  </span>
  

  

  

  <div class="post-content"><div>
        <h3 id="11-名称">1.1 名称<a href="#11-名称" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<ul>
<li>函数、变量、常量、类型、语句标签和包都遵循: <code>字母或下划线开头，后面跟随任意数量的字符，数字和下划线，并且区分大小写</code>。</li>
<li>若实体在函数中声明，那么实体只在函数局部有效。如果声明在函数外，将对包内所有源文件可见。</li>
<li>实体的第一个字母的<code>大小写</code>决定其可见性是否跨包，大写表示对包外是可见和可访问的。</li>
</ul>
<h3 id="12-声明">1.2 声明<a href="#12-声明" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">commonConstant</span> = <span style="color:#e6db74">&#34;common&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> = <span style="color:#a6e22e">commonConstant</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">b</span> <span style="color:#66d9ef">string</span> <span style="color:#75715e">// 会默认初始化为&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">c</span> <span style="color:#66d9ef">string</span> = <span style="color:#e6db74">&#34;c&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">d</span> = <span style="color:#e6db74">&#34;d&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">e</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;e&#34;</span>                  <span style="color:#75715e">// 短变量声明
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">true</span>, <span style="color:#ae81ff">2.3</span> <span style="color:#75715e">// 一次定义多个变量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">a</span>)            <span style="color:#75715e">// common
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">b</span>)            <span style="color:#75715e">// &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">c</span>)            <span style="color:#75715e">// c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">d</span>)            <span style="color:#75715e">// d
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">e</span>)            <span style="color:#75715e">// e
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>定义变量时如果不指定初始值，那么默认初始化为零值（int为0，string为&quot;&quot;&hellip;）</li>
</ol>
</blockquote>
<h3 id="13-变量">1.3 变量<a href="#13-变量" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<h4 id="131-指针">1.3.1 指针<a href="#131-指针" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>指针的值是一个<code>变量的地址</code>。使用指针可以在无须知道变量名称的情况下，简洁读取或更新变量的值。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">pointer</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">a</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">a</span>         <span style="color:#75715e">// &amp;z表示获取一个指向整型变量的指针,类型是整型指针(*int)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">p</span>) <span style="color:#75715e">// *p表示p指向的变量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">*</span><span style="color:#a6e22e">p</span> = <span style="color:#e6db74">&#34;2&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">a</span>) <span style="color:#75715e">// 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">x</span> <span style="color:#f92672">==</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">x</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">x</span> <span style="color:#f92672">==</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">y</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">x</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>) <span style="color:#75715e">// true false false
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">q</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">incr</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">q</span>)       <span style="color:#75715e">// &amp;q所指向的值加1，不依赖返回值就能实现更新
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">q</span>) <span style="color:#75715e">// 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">q</span>) <span style="color:#75715e">// 指针地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">incr</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">q</span>)) <span style="color:#75715e">// 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">incr</span>(<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span><span style="color:#a6e22e">p</span><span style="color:#f92672">++</span> <span style="color:#75715e">// 递增p所指向的值,p本身不变(p是一个指针地址)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">return</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">p</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">flagTest</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">str</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">StringVar</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">str</span>, <span style="color:#e6db74">&#34;s&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;将空格替换为指定分隔符&#34;</span>) <span style="color:#75715e">// 传入变量的指针,不需要返回值就能改变str的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Parse</span>() <span style="color:#75715e">// 解析用户传入的命令行参数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">str</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Join</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Args</span>(), <span style="color:#a6e22e">str</span>)) <span style="color:#75715e">// 参数是 ./main -s / a bc 输出 a/bc
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Args</span>())
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>
<p>&amp;z表示获取一个指向整型变量z的指针,类型是整型指针(*int)</p>
</li>
<li>
<p><code>*p</code>表示指针p指向的变量，<code>*p</code>代表一个变量。而p则代表指针，是一个0x开头的地址。</p>
</li>
<li>
<p>为什么使用指针？
&gt;
&gt;    a. 相比java中都是<code>值传递（对形参的修改不会影响实参）</code>，通过传递指针而不是复制整个数据结构，可以节省时间和内存。
&gt;
&gt;    b. 将变量的指针传递给函数，可以<code>在函数内部直接修改变量的值</code>，而不需要返回值。</p>
</li>
</ol>
</blockquote>
<h4 id="132-new">1.3.2 new<a href="#132-new" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>通过<code>new(type)</code>方式创建变量的指针，常用于<code>初始化复杂类型的指针</code>，便于在堆上分配内存。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> new(<span style="color:#66d9ef">int</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> new(<span style="color:#66d9ef">int</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">p</span>)      <span style="color:#75715e">// 指针的地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">p</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">x</span>) <span style="color:#75715e">// 每new一次每次的地址都不同
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">p</span>)     <span style="color:#75715e">// 初始为0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">Person</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">Age</span>) <span style="color:#75715e">// 会被初始化为零值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Person</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Age</span>  <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>new创建的变量是被初始化为<code>零值</code>的，Person中的Name和Age分别被初始化为&quot;&ldquo;和0。</p>
</blockquote>
<h4 id="133-变量的生命周期">1.3.3 变量的生命周期<a href="#133-变量的生命周期" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<blockquote>
<p>生命周期：程序执行过程中变量存在的时间段。</p>
<p><code>包级别</code>的变量生命周期伴随着<code>整个程序</code>的执行时间。</p>
<p><code>局部变量</code>的生命周期，每次执行声明语句时创建一个新的实体，一直存在到<code>不可访问</code>。</p>
<p>通过可达性算法来判断变量是否能够回收。与<code>JVM从根对象</code>出发判断类似，将<code>包级别的变量</code>、<code>当前执行函数的局部变量</code>作为源头，通过<code>指针或其他方式</code>的引用可以找到的变量则被视为可达。</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">global</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">f</span>() {
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">x</span> = <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">global</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">g</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">y</span> <span style="color:#f92672">:=</span> new(<span style="color:#66d9ef">int</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span><span style="color:#a6e22e">y</span> = <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>针对f()函数，尽管在其返回后还能通过global访问，这种情况成为<code>x从f中逃逸</code>。</li>
<li>当g()函数返回时，*y变得不可访问，可以被回收。这种情况被<code>*y无法从g中逃逸</code>。</li>
</ol>
</blockquote>
<h3 id="14-赋值">1.4 赋值<a href="#14-赋值" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">assign</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">x</span> = <span style="color:#ae81ff">1</span> <span style="color:#75715e">// 有名称的变量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;x: %d\n&#34;</span>, <span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">y</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span><span style="color:#a6e22e">y</span> = <span style="color:#ae81ff">2</span> <span style="color:#75715e">// 通过指针间接赋值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;*y: %d\n&#34;</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">Person</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">Name</span> = <span style="color:#e6db74">&#34;lucy&#34;</span> <span style="color:#75715e">// 结构体成员
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;name: %s\n&#34;</span>, <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>} <span style="color:#75715e">// 数组或slice或map的元素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;slice: %d\n&#34;</span>, <span style="color:#a6e22e">s</span>[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span><span style="color:#f92672">--</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;c: %d\n&#34;</span>, <span style="color:#a6e22e">c</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">a</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">b</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">c</span> = <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">a</span><span style="color:#f92672">+</span><span style="color:#a6e22e">b</span> <span style="color:#75715e">// 多重赋值,即一次性赋值多个变量,并且变量支持右侧表达式推演
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;a: %d, b: %d, c: %d\n&#34;</span>, <span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">c</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>有名称的变量赋值</li>
<li>通过指针间接赋值</li>
<li>结构体成员赋值</li>
<li>数组或slice或map元素赋值</li>
<li>多重赋值，一次赋值多个变量（左侧的变量个数需要和函数的返回值一样多，不需要的值赋值给<code>空标识符_</code>）</li>
</ol>
</blockquote>
<h3 id="15-包和文件">1.5 包和文件<a href="#15-包和文件" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>在go语言中包的作用和其他语言的库或模块作用类似，用于支持<code>模块化、封装、编译隔离和重用</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">go</span> <span style="color:#a6e22e">init</span> <span style="color:#a6e22e">mod</span> &lt;<span style="color:#a6e22e">module</span> <span style="color:#a6e22e">name</span>&gt; <span style="color:#75715e">// 初始化module
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">go</span> <span style="color:#a6e22e">mod</span> <span style="color:#a6e22e">tidy</span> <span style="color:#75715e">// 整理依赖
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── README.md
</span></span><span style="display:flex;"><span>├── src
</span></span><span style="display:flex;"><span>│   └── source.go
</span></span><span style="display:flex;"><span>├── go.mod
</span></span><span style="display:flex;"><span>├── main.go
</span></span><span style="display:flex;"><span>└── chapter1
</span></span><span style="display:flex;"><span>    ├── README.md
</span></span><span style="display:flex;"><span>    └── chapter1.go
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;go-in-action/chapter1&#34;</span> <span style="color:#75715e">// &lt;moduleName&gt;/&lt;folderName&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">chapter1</span>.<span style="color:#a6e22e">Main</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>大写开头的func才能够被其他go文件引用</li>
<li>import引入的路径只需要包含文件夹，不需要包含文件名称</li>
</ol>
</blockquote>
<hr>
<h3 id="21-基础类型">2.1 基础类型<a href="#21-基础类型" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="mermaid">
    
graph TD;
    A[数据类型]-->B[基础类型];
    A[数据类型]-->C[聚合类型];
    A[数据类型]-->D[引用类型];
    A[数据类型]-->E[接口类型];
    B[基础类型]-->F[数值];
    B[基础类型]-->G[字符串];
    B[基础类型]-->H[布尔值];

</div>
<blockquote>
<p>go的基础类型主要包含<code>整数、浮点数、复数、布尔值和字符串</code>。</p>
</blockquote>
<h4 id="211-整数">2.1.1 整数<a href="#211-整数" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>有符号分为int8、int16、int32、int64，无符号分为uint8、uint16、uint32、uint64。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">bit</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 1&lt;&lt;1: 00000001 -&gt; 00000010
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 1&lt;&lt;5: 00000001 -&gt; 00100000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 或运算：有1为1否则为0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			  00000010
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			| 00100000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			————————————
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		      00100010
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span> <span style="color:#66d9ef">uint8</span> = <span style="color:#ae81ff">1</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">1</span> | <span style="color:#ae81ff">1</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%08b\n&#34;</span>, <span style="color:#a6e22e">x</span>) <span style="color:#75715e">// 00100010
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%d\n&#34;</span>, <span style="color:#a6e22e">x</span>)   <span style="color:#75715e">// 34
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>有符号和无符号的区别在于<code>最高位是否是符号位</code>，n位数字的取值范围是<code>-2^n-1 ~ 2^(n-1) -1</code>，无符号的取值范围是<code>0 ~ 2^n -1</code></li>
<li>int默认是32位，但是<code>int32不等于int</code>，需要显示转换。</li>
<li>int32可以用<code>rune</code>表示，int8可以用<code>byte</code>表示。</li>
</ol>
</blockquote>
<h4 id="212-浮点数">2.1.2 浮点数<a href="#212-浮点数" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>go具有两种大小的浮点数：<code>float32和float64</code>，最大值分别是<code>math.MaxFloat32、math.MaxFloat64</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> float() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">f32</span> <span style="color:#66d9ef">float32</span> = <span style="color:#a6e22e">math</span>.<span style="color:#a6e22e">MaxFloat32</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">f64</span> <span style="color:#66d9ef">float64</span> = <span style="color:#a6e22e">math</span>.<span style="color:#a6e22e">MaxFloat64</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;f32: %8.1f\n&#34;</span>, <span style="color:#a6e22e">f32</span>) <span style="color:#75715e">// 8表示输出的值不足8个字符，则会用空格填充 1表示保留小数点后1位
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">f64</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="213-布尔值">2.1.3 布尔值<a href="#213-布尔值" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>go中的bool值只有两种可能：true或false。布尔值取反前面加<code>!</code>。</p>
<h4 id="214-字符串">2.1.4 字符串<a href="#214-字符串" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>字符串是<code>不可变</code>的字节序列，他可以包含任意数据，包括0值字节。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">str</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;你好世界&#34;</span>     <span style="color:#75715e">// 默认按照utf8进行编码
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(len(<span style="color:#a6e22e">s</span>)) <span style="color:#75715e">// 输出字符数量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 获取utf8下字符的编码值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; len(<span style="color:#a6e22e">s</span>); {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">r</span>, <span style="color:#a6e22e">size</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">DecodeRuneInString</span>(<span style="color:#a6e22e">s</span>[<span style="color:#a6e22e">i</span>:])
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Character: %c, Code: %d\n&#34;</span>, <span style="color:#a6e22e">r</span>, <span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">i</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">size</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		获取utf8下字符的编码值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		Character: 你, Code: [228 189 160]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		Character: 好, Code: [229 165 189]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		Character: 世, Code: [228 184 150]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		Character: 界, Code: [231 149 140]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		如果只包含ascii字符，那么直接通过s[i]来获取
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">char</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">s</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Character: %c, bytes: %v\n&#34;</span>, <span style="color:#a6e22e">char</span>, []byte(string(<span style="color:#a6e22e">char</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">s</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">s</span>[<span style="color:#ae81ff">7</span>])     <span style="color:#75715e">// 通过下标访问，返回的是uint8类型的字节编码，即228和184
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">s</span>[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">6</span>])         <span style="color:#75715e">// 默认会输出字符
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>([]byte(<span style="color:#a6e22e">s</span>[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">5</span>])) <span style="color:#75715e">// 输出rune字节数组
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 字符串的不可变性，a和b共用了底层字节数组
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">a</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;a&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">b</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">a</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">a</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;b&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">a</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">b</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// []byte和string互转
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;abc&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">y</span> <span style="color:#f92672">:=</span> []byte(<span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">z</span> <span style="color:#f92672">:=</span> string(<span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;x: %s, y: %v, z: %s&#34;</span>, <span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span>, <span style="color:#a6e22e">z</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>go中基于unicode（每个字符都有一个码点值，可用整数表示）设计出<code>rune</code>类型，底层是<code>int32（4个字节）</code>，用来容纳任意的unicode字符。</li>
<li>在ASCII编码下，可以通过<code>[索引地址]</code>的方式获取字符，若是UTF8的编码下，因为其是<code>多个字节</code>组成的，此方法获取的是某个字符中的某个字节。</li>
<li>可以通过<code>utf8.DecodeRuneInString</code>获取中文字符中的第一个字符。</li>
<li>字符串是<code>不可变</code>的，类似java的字符串常量池，go的底层使用了字节数组。两个字符串可以安全的共用同一段底层内存。</li>
</ol>
<img src="https://image.leejay.top/typora/Snipaste_2023-05-30_14-39-12.png" alt="Image" style="float: left; margin-right: 10px;">
</blockquote>
<h4 id="215-常量">2.1.5 常量<a href="#215-常量" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>常量是一种表达式，可以保证在编译阶段就计算出表达式的值，并不需要等到运行时，从而是编译器得以知晓其值。常量本质上都属于基本类型，布尔型、字符串或者数字。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">constant</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hello</span> <span style="color:#66d9ef">string</span> = <span style="color:#e6db74">&#34;hello&#34;</span> <span style="color:#75715e">// 定义string类型的常量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">const</span> (
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">a</span> <span style="color:#66d9ef">int</span> = <span style="color:#66d9ef">iota</span> <span style="color:#75715e">// 从0依次曾增加1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">b</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">c</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">d</span>
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">d</span>) <span style="color:#75715e">// 0 1 2 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">t</span> = <span style="color:#ae81ff">10</span>                                <span style="color:#75715e">// 无类型常量，会根据上下文确认转为不同的类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type: %T, v: %d\n&#34;</span>, <span style="color:#a6e22e">t</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">t</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)   <span style="color:#75715e">// 此时t是int类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type: %T, v: %f&#34;</span>, <span style="color:#a6e22e">t</span><span style="color:#f92672">+</span><span style="color:#ae81ff">0.1</span>, <span style="color:#a6e22e">t</span><span style="color:#f92672">+</span><span style="color:#ae81ff">0.1</span>) <span style="color:#75715e">// 此时t是float64类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>不定义类型的常量，在使用时会根据上下文根据判断会转为不同的类型。</li>
<li>可以一次定义多个常量，基于iota实现自动增长。</li>
</ol>
</blockquote>
<hr>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TD;
C[复合数据类型]--&gt;G[数组];
C[复合数据类型]--&gt;H[slice];
C[复合数据类型]--&gt;I[map];
C[复合数据类型]--&gt;J[struct];
C[复合数据类型]--&gt;K[json];
C[复合数据类型]--&gt;L[html];
</code></pre><h4 id="221-数组">2.2.1 数组<a href="#221-数组" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>数组是具有<code>固定长度</code>且拥有n个(n&gt;=0)<code>相同数据类型</code>元素的序列。数组中的元素都是通过索引来访问的。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">array</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">arr</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>} <span style="color:#75715e">// 初始化数组
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">arr</span>[<span style="color:#ae81ff">2</span>] = <span style="color:#ae81ff">4</span>            <span style="color:#75715e">// 修改index为2的值为4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">a</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">arr</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;index: %d, value: %d\n&#34;</span>, <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">a</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">arr2</span> [<span style="color:#ae81ff">3</span>]<span style="color:#66d9ef">int</span>                   <span style="color:#75715e">// 定义3个整数的数组，默认初始化为零值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">arr2</span> = [<span style="color:#f92672">...</span>]<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>}          <span style="color:#75715e">// 数组的字面量是...时 表示其值由初始化数组的个数决定
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">arr2</span> = [<span style="color:#f92672">...</span>]<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">0</span>: <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>: <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>: <span style="color:#ae81ff">3</span>} <span style="color:#75715e">// 分别指定index为0的值为1，以此类推
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">arr2</span> = [<span style="color:#f92672">...</span>]<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">2</span>: <span style="color:#ae81ff">3</span>}             <span style="color:#75715e">// 指定index为2的值为3，此时数组是三个元素，其他都是零值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">a</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">arr2</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;index: %d, value: %d\n&#34;</span>, <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">a</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type: %T\n&#34;</span>, <span style="color:#a6e22e">arr2</span>) <span style="color:#75715e">// [3]int
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">arr3</span> <span style="color:#f92672">:=</span> [<span style="color:#f92672">...</span>]<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;arr2 type: %T, arr3 type: %T, equals?: %t\n&#34;</span>, <span style="color:#a6e22e">arr2</span>, <span style="color:#a6e22e">arr3</span>, <span style="color:#a6e22e">arr2</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">arr3</span>) <span style="color:#75715e">// false
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">证明函数参数是值传递方式
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">transfer</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">arr</span> <span style="color:#f92672">:=</span> [<span style="color:#f92672">...</span>]<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;before arr value: %d, type: %T, location: %p\n&#34;</span>, <span style="color:#a6e22e">arr</span>, <span style="color:#a6e22e">arr</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">arr</span>) <span style="color:#75715e">// 打印arr的地址和值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">modifyValue</span>(<span style="color:#a6e22e">arr</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;after arr value: %d, type: %T, location: %p\n&#34;</span>, <span style="color:#a6e22e">arr</span>, <span style="color:#a6e22e">arr</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">arr</span>) 
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">modifyValue3</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">arr</span>) <span style="color:#75715e">// 传递指针会修改源数据的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;after arr value: %d, type: %T, location: %p\n&#34;</span>, <span style="color:#a6e22e">arr</span>, <span style="color:#a6e22e">arr</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">arr</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">修改传递的数组里面的元素值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">modifyValue</span>(<span style="color:#a6e22e">array</span> [<span style="color:#ae81ff">3</span>]<span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;modify arr value: %d, type: %T, location: %p\n&#34;</span>, <span style="color:#a6e22e">array</span>, <span style="color:#a6e22e">array</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">array</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">array</span>[<span style="color:#ae81ff">0</span>] = <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">使用指针作为参数，会修改源数组
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">modifyValue3</span>(<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span>[<span style="color:#ae81ff">3</span>]<span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;modify2 arr value: %d, type: %T, location: %p\n&#34;</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">p</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">p</span>, <span style="color:#a6e22e">p</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p</span>[<span style="color:#ae81ff">0</span>] = <span style="color:#ae81ff">101</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>数组初始化时不指定初始化值会默认设置为<code>零值</code>，使用<code>...</code>替代数组字面量值，大小默认由<code>数组初始化值数量</code>决定。</li>
<li>数组字面量是数组类型的一部分，<code>[3]int != [4]int</code>。</li>
<li>数组作为函数的形参时，是基于<code>值传递</code>实现传参（即将数组复制一份作为函数的参数），所以对形参的修改不会影响实参。</li>
<li>若将<code>数组的指针</code>作为参数的形参，那么对其进行修改时，会影响到原始数组。</li>
</ol>
</blockquote>
<h4 id="222-slice">2.2.2 slice<a href="#222-slice" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>slice表示一个拥有相同类型元素的<code>可变长度</code>的序列（参考java的List、python的切片）。用来访问数组的部分或者全部的元素。这个数组被成为slice的<code>底层数组</code>，slice是具备三个属性：<code>指针</code>、<code>长度</code>和<code>容量</code>的轻量级数据结构。</p>
<p><img src="https://image.leejay.top/typora/Snipaste_2023-06-01_10-02-26.png" alt="Snipaste_2023-06-01_10-02-26"></p>
<blockquote>
<ol>
<li>
<p>指针指向数组的第一个可以从slice中访问的元素（并不一定是数组的第一个元素）。</p>
</li>
<li>
<p>长度是指slice中的元素个数，不能超过slice的容量（cap）。</p>
</li>
<li>
<p>容量的大小默认由<code>slice的起始元素到底层数组的最后一个元素</code>间元素的个数。</p>
</li>
<li>
<p>slice可以理解成数组的别名，<code>slice并不存储数据</code>，其作为形参传递时，对slice的修改<code>会影响到底层数组</code>。</p>
</li>
</ol>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">sliceTest</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">months</span> <span style="color:#f92672">:=</span> [<span style="color:#f92672">...</span>]<span style="color:#66d9ef">string</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">1</span>: <span style="color:#e6db74">&#34;January&#34;</span>, <span style="color:#e6db74">&#34;February&#34;</span>, <span style="color:#e6db74">&#34;March&#34;</span>, <span style="color:#e6db74">&#34;April&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;May&#34;</span>, <span style="color:#e6db74">&#34;June&#34;</span>, <span style="color:#e6db74">&#34;July&#34;</span>, <span style="color:#e6db74">&#34;August&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;September&#34;</span>, <span style="color:#e6db74">&#34;October&#34;</span>, <span style="color:#e6db74">&#34;November&#34;</span>, <span style="color:#ae81ff">12</span>: <span style="color:#e6db74">&#34;December&#34;</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type: %T, len: %d\n&#34;</span>, <span style="color:#a6e22e">months</span>, len(<span style="color:#a6e22e">months</span>)) <span style="color:#75715e">// [13]string 表示数组
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">m1</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">months</span>[<span style="color:#ae81ff">1</span>:<span style="color:#ae81ff">3</span>]                                                <span style="color:#75715e">// 1,2不包含3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type: %T, len: %d, cap: %d\n&#34;</span>, <span style="color:#a6e22e">m1</span>, len(<span style="color:#a6e22e">m1</span>), cap(<span style="color:#a6e22e">m1</span>)) <span style="color:#75715e">// []string 表示slice cap表示slice的容量 len=2 cap=12
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">m1</span>[<span style="color:#ae81ff">0</span>] = <span style="color:#e6db74">&#34;temp&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type: %T, m1[0]: %s， month[0]: %s\n&#34;</span>, <span style="color:#a6e22e">m1</span>, <span style="color:#a6e22e">m1</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">months</span>[<span style="color:#ae81ff">0</span>]) <span style="color:#75715e">// slice包含指向底层数组的指针，无论是slice改变或者底层数组改变都会互相影响
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s1</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">3</span>) <span style="color:#75715e">// 使用make创建slice，如果不指定cap，默认等于len，底层数组长度为3，且默认设置元素为零值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">s1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s2</span> <span style="color:#f92672">:=</span> []int(<span style="color:#66d9ef">nil</span>) <span style="color:#75715e">// 将nil作为slice的元素，没有对应的底层数组，且长度和容量都为0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">s3</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{}    <span style="color:#75715e">// 初始化空slice，不为nil
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">s4</span> []<span style="color:#66d9ef">int</span> = <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;s2 == nil: %t, len(s2): %d\n&#34;</span>, <span style="color:#a6e22e">s2</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>, len(<span style="color:#a6e22e">s2</span>)) <span style="color:#75715e">// true 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;s3 == nil: %t, len(s3): %d\n&#34;</span>, <span style="color:#a6e22e">s3</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>, len(<span style="color:#a6e22e">s3</span>)) <span style="color:#75715e">// false 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;s4 == nil: %t, len(s4): %d\n&#34;</span>, <span style="color:#a6e22e">s4</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>, len(<span style="color:#a6e22e">s4</span>)) <span style="color:#75715e">// true 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">appendInt</span>([]<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>}, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>)) <span style="color:#75715e">// 添加4,5,6到slice末尾
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">将y追加到[]int后
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">需要考虑到cap 扩容问题
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">其功能等同于 append()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">appendInt</span>(<span style="color:#a6e22e">x</span> []<span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">y</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">int</span>) []<span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">z</span> []<span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">zlen</span> <span style="color:#f92672">:=</span> len(<span style="color:#a6e22e">x</span>) <span style="color:#f92672">+</span> len(<span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">zlen</span> <span style="color:#f92672">&lt;=</span> cap(<span style="color:#a6e22e">x</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">z</span> = <span style="color:#a6e22e">x</span>[:<span style="color:#a6e22e">zlen</span>] <span style="color:#75715e">// 扩容len(y)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">zcap</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">zlen</span> <span style="color:#75715e">// zlen &gt; zcap 说明底层数组容量不够需要扩容了
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">zcap</span> &lt; <span style="color:#a6e22e">zlen</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">1</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">zcap</span> = <span style="color:#a6e22e">zlen</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e">// 扩容2倍
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">z</span> = make([]<span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">zlen</span>, <span style="color:#a6e22e">zcap</span>)
</span></span><span style="display:flex;"><span>		copy(<span style="color:#a6e22e">z</span>, <span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	copy(<span style="color:#a6e22e">z</span>[len(<span style="color:#a6e22e">x</span>):], <span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">z</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="2221-测验">2.2.2.1 测验<a href="#2221-测验" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<ul>
<li>重写reverse，使用数组指针作为参数而不是slice</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">sliceTest1</span>(<span style="color:#a6e22e">x</span> <span style="color:#f92672">*</span>[<span style="color:#ae81ff">3</span>]<span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">j</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>, len(<span style="color:#f92672">*</span><span style="color:#a6e22e">x</span>)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">j</span>; <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">j</span> = <span style="color:#a6e22e">i</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">j</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">x</span>[<span style="color:#a6e22e">i</span>], <span style="color:#a6e22e">x</span>[<span style="color:#a6e22e">j</span>] = <span style="color:#a6e22e">x</span>[<span style="color:#a6e22e">j</span>], <span style="color:#a6e22e">x</span>[<span style="color:#a6e22e">i</span>]
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>重写一个函数rotate，实现一次遍历就可以完成元素旋转</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">rotate</span>(<span style="color:#a6e22e">x</span> []<span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; len(<span style="color:#a6e22e">x</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">temp</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">x</span>[len(<span style="color:#a6e22e">x</span>)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">i</span>]
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">x</span>[len(<span style="color:#a6e22e">x</span>)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">i</span>] = <span style="color:#a6e22e">x</span>[<span style="color:#a6e22e">i</span>]
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">x</span>[<span style="color:#a6e22e">i</span>] = <span style="color:#a6e22e">temp</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>编写一个就地处理函数，用于去除[]string slice中相邻的重复字符串元素</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">duplicate</span>(<span style="color:#a6e22e">x</span> []<span style="color:#66d9ef">string</span>) []<span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">count</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">l</span> <span style="color:#f92672">:=</span> len(<span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">l</span><span style="color:#f92672">-</span><span style="color:#a6e22e">count</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">x</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">==</span> <span style="color:#a6e22e">x</span>[<span style="color:#a6e22e">i</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">count</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>			copy(<span style="color:#a6e22e">x</span>[<span style="color:#a6e22e">i</span>:], <span style="color:#a6e22e">x</span>[<span style="color:#a6e22e">i</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>:])
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">i</span><span style="color:#f92672">--</span> <span style="color:#75715e">// 指针回退
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;i: %d, count: %d, x: %v\n&#34;</span>, <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">x</span>[:len(<span style="color:#a6e22e">x</span>)<span style="color:#f92672">-</span><span style="color:#a6e22e">count</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#75715e">// slice 左闭右开
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><blockquote>
<p>无论是数组还是slice，作为形参都是值传递（副本，除非是指针作为形参）。</p>
</blockquote>
<h4 id="223-map">2.2.3 map<a href="#223-map" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>map是一个拥有键值对的<code>无序</code>集合，键是唯一的，值的类型没有任何限制，时间复杂度为O(n)。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">mapTest</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">m1</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">int</span>) <span style="color:#75715e">// 初始化map
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">m2</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">int</span>{ <span style="color:#75715e">// 初始化map包含字面量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#e6db74">&#34;a&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;c&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;d&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;b&#34;</span>: <span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">m3</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">int</span>{}            <span style="color:#75715e">// 初始化空map
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">m4</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">int</span>             <span style="color:#75715e">// 尚未初始化的map，零值为nil
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">m5</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">int</span>{} <span style="color:#75715e">// 定义key为string，value为map[string]int的map
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;m1: %v, nil: %t\n&#34;</span>, <span style="color:#a6e22e">m1</span>, <span style="color:#a6e22e">m1</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>) <span style="color:#75715e">// false
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;m2: %v, nil: %t\n&#34;</span>, <span style="color:#a6e22e">m2</span>, <span style="color:#a6e22e">m2</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>) <span style="color:#75715e">// false
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;m3: %v, nil: %t\n&#34;</span>, <span style="color:#a6e22e">m3</span>, <span style="color:#a6e22e">m3</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>) <span style="color:#75715e">// false
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;m4: %v, nil: %t\n&#34;</span>, <span style="color:#a6e22e">m4</span>, <span style="color:#a6e22e">m4</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>) <span style="color:#75715e">// true
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;m5: %v, nil: %t\n&#34;</span>, <span style="color:#a6e22e">m5</span>, <span style="color:#a6e22e">m5</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>) <span style="color:#75715e">// false
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">m4</span> = make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">int</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">m4</span>[<span style="color:#e6db74">&#34;a&#34;</span>] = <span style="color:#ae81ff">1</span>      <span style="color:#75715e">// 向零值的map设置元素会报错，必须先初始化
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">m4</span>[<span style="color:#e6db74">&#34;a&#34;</span>] = <span style="color:#ae81ff">2</span>      <span style="color:#75715e">// 更新map中对应的key值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">v</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m4</span>[<span style="color:#e6db74">&#34;b&#34;</span>] <span style="color:#75715e">// 获取value的同时判断值是否在map中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;m4[\&#34;b\&#34;]: %d, in m4? %t\n&#34;</span>, <span style="color:#a6e22e">v</span>, <span style="color:#a6e22e">ok</span>)
</span></span><span style="display:flex;"><span>	delete(<span style="color:#a6e22e">m4</span>, <span style="color:#e6db74">&#34;a&#34;</span>) <span style="color:#75715e">// 删除map中key为a的元素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 根据map的key排序，间接实现map的有序输出
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">keys</span> []<span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">m2</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">keys</span> = append(<span style="color:#a6e22e">keys</span>, <span style="color:#a6e22e">key</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">sort</span>.<span style="color:#a6e22e">Strings</span>(<span style="color:#a6e22e">keys</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">k</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">keys</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;key: %s, value: %d\n&#34;</span>, <span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">m2</span>[<span style="color:#a6e22e">k</span>])
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="224-结构体">2.2.4 结构体<a href="#224-结构体" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>结构体是将<code>n个任意类型(n&gt;=0)的命名变量</code>组合在一起的聚合数据类型。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">structTest</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">person</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">Person</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">person</span>.<span style="color:#a6e22e">id</span> = <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">person</span>.<span style="color:#a6e22e">name</span> = <span style="color:#e6db74">&#34;lucy&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">person</span>.<span style="color:#a6e22e">age</span> = <span style="color:#ae81ff">18</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">person</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>((<span style="color:#f92672">*</span><span style="color:#a6e22e">p</span>).<span style="color:#a6e22e">name</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">person</span>.<span style="color:#a6e22e">name</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 基于结构体字面量创建，变量必须可以访问
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">p2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Person</span>{<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;jack&#34;</span>, <span style="color:#ae81ff">32</span>} <span style="color:#75715e">// 基于顺序创建
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">p2</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p3</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Person</span>{<span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;lucy&#34;</span>, <span style="color:#a6e22e">age</span>: <span style="color:#ae81ff">20</span>, <span style="color:#a6e22e">id</span>: <span style="color:#ae81ff">2</span>} <span style="color:#75715e">// 通过kv形式创建
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">p3</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 通常struct通过指针访问，避免值传递带来的复制的性能
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">p4</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Person</span>{<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;harden&#34;</span>, <span style="color:#ae81ff">33</span>}          <span style="color:#75715e">// 等价于 p4 := new(Person) *p4 = Person{3,&#34;harden&#34;,33}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;p4: %#v\n&#34;</span>, <span style="color:#a6e22e">p4</span>)             <span style="color:#75715e">// 按照go的格式输出结构体
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;p3 == p4 ? %t\n&#34;</span>, <span style="color:#a6e22e">p2</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">p3</span>) <span style="color:#75715e">// == 会依次比较结构体中变量的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Person 变量首字母大小，表示可被其他包访问和使用，首字母小鞋只能在定义它的包内使用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Person</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">id</span>   <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">age</span>  <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>成员变量<code>首字母大写</code>表示可以跨包访问，首字母小写，只能被当前包域访问。</li>
<li>结构体初始化支持按照<code>变量顺序或按照key-value</code>的形式创建（类似java的全量构造方法和部分变量的构造方法）。</li>
<li>go的结构体推荐使用指针访问(<code>p := &amp;Person{1, &quot;&quot;, 1}</code>)，避免大结构体因为形参的<code>值传递</code>拷贝带来的性能损耗。</li>
<li>结构体之间进行<code>==</code>比较，go会按照成员变量的顺序依次比较。</li>
</ol>
</blockquote>
<h5 id="2241-匿名成员">2.2.4.1 匿名成员<a href="#2241-匿名成员" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 包含匿名成员的结构体赋值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">personNestedTest</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">p5</span> <span style="color:#a6e22e">PersonNested</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p5</span>.<span style="color:#a6e22e">no</span> = <span style="color:#ae81ff">1</span> <span style="color:#75715e">// 等同于 p5.address.no = 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">p5</span>.<span style="color:#a6e22e">street</span> = <span style="color:#e6db74">&#34;长安大街&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p5</span>.<span style="color:#a6e22e">name</span> = <span style="color:#e6db74">&#34;ming&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;p5: %#v\n&#34;</span>, <span style="color:#a6e22e">p5</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 不能通过 &amp;PersonNested{name: &#34;hong&#34;, no: 2, street: &#34;沈阳大街&#34;} 初始化字面量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">p6</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">PersonNested</span>{<span style="color:#e6db74">&#34;hong&#34;</span>, <span style="color:#a6e22e">address</span>{<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;沈阳大街&#34;</span>}}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;p6: %#v\n&#34;</span>, <span style="color:#a6e22e">p6</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p7</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">PersonNested</span>{ <span style="color:#75715e">// 初始化效果等同于p6
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;hong&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">address</span>: <span style="color:#a6e22e">address</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">no</span>:     <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">street</span>: <span style="color:#e6db74">&#34;沈阳大街&#34;</span>,
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;p6 == p7? %t\n&#34;</span>, <span style="color:#a6e22e">p6</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">p7</span>)     <span style="color:#75715e">// false 指针地址不同
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;*p6 == *p7? %t\n&#34;</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">p6</span> <span style="color:#f92672">==</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">p7</span>) <span style="color:#75715e">// true 成员字面量相同
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">PersonNested</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">name</span>    <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">address</span> <span style="color:#75715e">// go允许定义不带名称的结构体变量，只需要指定类型即可，这种结构体成为被称为匿名成员
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">address</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">no</span>     <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">street</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>定义不带名称的结构体变量，只需要指定类型即可，这种结构体成为被称为匿名成员。</li>
<li>匿名成员进行赋值时，可以省略通过<code>.匿名成员类型</code>的方式赋值。</li>
<li>匿名成员初始化字面量时<code>不支持通过key-value</code>的形式，需要按照嵌套的结构进行赋值。</li>
</ol>
</blockquote>
<h5 id="2242-二叉树排序">2.2.4.2 二叉树排序<a href="#2242-二叉树排序" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Sort 二叉树排序
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Sort</span>(<span style="color:#a6e22e">values</span> []<span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">root</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Tree</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">values</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">root</span> = <span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">root</span>, <span style="color:#a6e22e">v</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;root: %v&#34;</span>, <span style="color:#a6e22e">root</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">appendValues</span>(<span style="color:#a6e22e">values</span>[:<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">root</span>) <span style="color:#75715e">// values[:0]作用等同于清空values，但不改变len
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;values: %v&#34;</span>, <span style="color:#a6e22e">values</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">appendValues</span>(<span style="color:#a6e22e">values</span> []<span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Tree</span>) []<span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">t</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">values</span> = <span style="color:#a6e22e">appendValues</span>(<span style="color:#a6e22e">values</span>, <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">left</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">values</span> = append(<span style="color:#a6e22e">values</span>, <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">value</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">values</span> = <span style="color:#a6e22e">appendValues</span>(<span style="color:#a6e22e">values</span>, <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">right</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">values</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 递归添加节点
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Tree</span>, <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">int</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Tree</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">t</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> { <span style="color:#75715e">// 初始化根节点
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">t</span> = new(<span style="color:#a6e22e">Tree</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">value</span> = <span style="color:#a6e22e">value</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">t</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">value</span> &lt; <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">value</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">left</span> = <span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">left</span>, <span style="color:#a6e22e">value</span>)
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">right</span> = <span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">right</span>, <span style="color:#a6e22e">value</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">t</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="225-json">2.2.5 JSON<a href="#225-json" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">jsonTest</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">PersonNested</span>{<span style="color:#e6db74">&#34;harden&#34;</span>, <span style="color:#a6e22e">address</span>{<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;长安大街&#34;</span>}}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">j</span>, <span style="color:#a6e22e">e</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Marshal</span>(<span style="color:#a6e22e">p</span>) <span style="color:#75715e">// 将结构体转换为 JSON 字符串
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">e</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;JSON marshal error: %s&#34;</span>, <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">Error</span>())
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;JSON data: %s\n&#34;</span>, <span style="color:#a6e22e">j</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">j2</span>, <span style="color:#a6e22e">e</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">MarshalIndent</span>(<span style="color:#a6e22e">p</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34; &#34;</span>) <span style="color:#75715e">// 格式化输出json串 prefix表示每行输出的前缀欺负成，indent表示每个层级的缩进字符串
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">e</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;JSON marshal error: %s&#34;</span>, <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">Error</span>())
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;JSON data: %s\n&#34;</span>, <span style="color:#a6e22e">j2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">resp</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;https://xkcd.com/571/info.0.json&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">r</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">NewDecoder</span>(<span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">Body</span>).<span style="color:#a6e22e">Decode</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">r</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> { <span style="color:#75715e">// 使用json.NewDecoder的方式解析json
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;error: %s&#34;</span>, <span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">Status</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;resp: %#v&#34;</span>, <span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>json.Marshal将结构体转为[]byte，json.Unmarshal将[]byte转为结构体</li>
<li>还可以使用<code>json.NewDecoder().Decode()</code>流式解码器来实现json的解析</li>
</ol>
</blockquote>
<h4 id="226-文件与html">2.2.6 文件与html<a href="#226-文件与html" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">textHtmlTest</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// range需要搭配end使用，支持函数执行
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">temp</span> = <span style="color:#e6db74">`Convert: </span><span style="color:#75715e">{{</span><span style="color:#a6e22e">.Input</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">convert</span><span style="color:#75715e">}}</span><span style="color:#e6db74">, Users: </span><span style="color:#75715e">{{</span><span style="color:#66d9ef">range</span> <span style="color:#a6e22e">.Users</span><span style="color:#75715e">}}</span><span style="color:#e6db74">- </span><span style="color:#75715e">{{</span><span style="color:#a6e22e">.Name</span><span style="color:#75715e">}}</span><span style="color:#e6db74"> (</span><span style="color:#75715e">{{</span><span style="color:#a6e22e">.Age</span><span style="color:#75715e">}}</span><span style="color:#e6db74"> years old) </span><span style="color:#75715e">{{</span><span style="color:#66d9ef">end</span><span style="color:#75715e">}}</span><span style="color:#e6db74">`</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// template中使用的函数需要先添加进来
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;hello&#34;</span>).<span style="color:#a6e22e">Funcs</span>(<span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">FuncMap</span>{<span style="color:#e6db74">&#34;convert&#34;</span>: <span style="color:#a6e22e">convert</span>}).<span style="color:#a6e22e">Parse</span>(<span style="color:#a6e22e">temp</span>)                       
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;parse error: %s\n&#34;</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">data</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;Input&#34;</span>: <span style="color:#e6db74">&#34;input&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;Users&#34;</span>: []<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>			{<span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;Alice&#34;</span>, <span style="color:#e6db74">&#34;Age&#34;</span>: <span style="color:#ae81ff">25</span>},
</span></span><span style="display:flex;"><span>			{<span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;Bob&#34;</span>, <span style="color:#e6db74">&#34;Age&#34;</span>: <span style="color:#ae81ff">30</span>},
</span></span><span style="display:flex;"><span>			{<span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;Charlie&#34;</span>, <span style="color:#e6db74">&#34;Age&#34;</span>: <span style="color:#ae81ff">28</span>},
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#a6e22e">data</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;parse error: %s\n&#34;</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">convert</span>(<span style="color:#a6e22e">input</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">input</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;-output&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<h2 id="3-函数">3. 函数<a href="#3-函数" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="31-函数声明">3.1 函数声明<a href="#31-函数声明" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">func func_name(parameter-list) (result-list){}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">x0</span>(<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">c</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">z</span> <span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#75715e">// 等同于return x,y,z 称为裸返回（按照返回值顺序返回）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>函数的参数传递是按<code>值传递</code>的，函数接收到是实参的副本。</li>
<li>存在多个相同类型的参数时，可以使用简写 x,y int。</li>
<li>可以给返回值进行声明，声明为<code>局部变量</code>，并会根据类型<code>初始化为零值。</code></li>
<li>若已经给返回值进行变量声明，那么函数中可以直接使用return返回。</li>
<li>当两个函数拥有相同的形参列表和返回列表时，那么这两个函数的<code>类型或签名是相同的</code>。</li>
</ol>
</blockquote>
<h3 id="32-异常构建">3.2 异常构建<a href="#32-异常构建" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">waitForServer</span>(<span style="color:#e6db74">&#34;https://github1.com&#34;</span>, <span style="color:#ae81ff">10</span><span style="color:#f92672">*</span><span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span><span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;waitForServer: %s\n&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">url: 请求的url
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">timeout： 全部请求超时间隔
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">requestTimeout： 每次请求的间隔
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">waitForServer</span>(<span style="color:#a6e22e">url</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">timeout</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>, <span style="color:#a6e22e">requestTimeout</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">deadline</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">Add</span>(<span style="color:#a6e22e">timeout</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">client</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Client</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Timeout</span>: <span style="color:#a6e22e">requestTimeout</span>, <span style="color:#75715e">// http client设置超时时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">Before</span>(<span style="color:#a6e22e">deadline</span>); <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Head</span>(<span style="color:#a6e22e">url</span>) <span style="color:#75715e">// 只获取响应头信息，不获取响应体
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;server not responding (%s), retrying...\n&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#a6e22e">i</span>) <span style="color:#75715e">// 指数级增长
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//return fmt.Errorf(&#34;server %s failed to respond after %s\n&#34;, url, timeout) // 创建格式化错误信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;server %s failed to respond after %s\n&#34;</span>, <span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">timeout</span>) <span style="color:#75715e">// 创建格式化错误信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><blockquote>
<ol>
<li><code>error</code>是内置的接口类型，当其值为非空值，意味着失败，为控制意味着成功。</li>
<li>go语言中使用<code>普通的值</code>来不是异常来报告错误，使用fmt.Errorf()构建新的error错误值。</li>
</ol>
</blockquote>
<h3 id="33-匿名函数">3.3 匿名函数<a href="#33-匿名函数" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<blockquote>
<p>函数字面量就像函数声明，但在func关键字后面没有函数的名称，它是一个表达式，它的值被称为匿名函数。</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 匿名函数作为参数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Map</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">r</span> <span style="color:#66d9ef">rune</span>) <span style="color:#66d9ef">rune</span> {
</span></span><span style="display:flex;"><span>	    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    }, <span style="color:#e6db74">&#34;HAL-9000&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;map: %#v\n&#34;</span>, <span style="color:#a6e22e">s</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">a</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">anonymousFunc</span>() <span style="color:#75715e">// 获取匿名函数的引用，因为返回的是func() int类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">a</span>()) <span style="color:#75715e">// 此时匿名函数a中的局部变量x=1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">a</span>()) <span style="color:#75715e">// 此时匿名函数a中的局部变量x=2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">x</span> <span style="color:#66d9ef">int</span>) { <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;x: %d\n&#34;</span>, <span style="color:#a6e22e">x</span>) }(<span style="color:#ae81ff">1</span>) <span style="color:#75715e">// 构建匿名函数并调用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">匿名函数作为返回值类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">anonymousFunc</span>() <span style="color:#66d9ef">func</span>() <span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span> <span style="color:#66d9ef">int</span> <span style="color:#75715e">// 能够被内层的匿名函数访问和更新
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">func</span>() <span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">x</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="331-迭代变量捕获">3.3.1 迭代变量捕获<a href="#331-迭代变量捕获" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">演示go的循环迭代变量捕获问题
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test1</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">funcs</span> []<span style="color:#66d9ef">func</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">num</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">num</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">nums</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// num := num                     // 避免迭代变量捕获问题
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">funcs</span> = append(<span style="color:#a6e22e">funcs</span>, <span style="color:#66d9ef">func</span>() { <span style="color:#75715e">// 构建匿名函数的slice，for循环结束后num的值为4，num共用一个内存地址，每次都是更新值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;num: %d\n&#34;</span>, <span style="color:#a6e22e">num</span>) <span style="color:#75715e">// 匿名函数中记录的num不是值，是内存地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		})
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">f</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">funcs</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">f</span>() <span style="color:#75715e">// 执行匿名函数时，num的值随着迭代结束已经变为4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>迭代的变量num使用的<code>是同一个内存地址</code>，每次循环都是更新内存地址对应的值。</li>
<li>在第一个循环中生成的所有匿名函数都<code>共享相同的循环变量num（逃逸到堆中）</code>，且num记录的是<code>迭代变量的内存地址</code>，而不是值。</li>
<li>在匿名函数执行时，num中存储的值等于最后一次迭代的值，所以打印的都是相同的数字4。</li>
<li>只需使用<code>局部变量拷贝循环变量的值</code>，这样在匿名函数中局部变量num记录的就是<code>某一时刻循环变量的值</code>，而不是循环变量的地址。</li>
</ol>
</blockquote>
<h3 id="334-变长函数">3.3.4 变长函数<a href="#334-变长函数" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>变长函数在被调用的时候可以有<code>可变的参数个数</code>，其本质就是一个某种类型的slice。(java中的可变参数其实是个数组)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test</span>(<span style="color:#a6e22e">a</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type: %T&#34;</span>, <span style="color:#a6e22e">a</span>) <span style="color:#75715e">// []int
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">test</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">a</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">test</span>(<span style="color:#a6e22e">a</span><span style="color:#f92672">...</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>对于已经存在的一个slice，通过添加<code>...</code>实现对变长函数的调用。</p>
</blockquote>
<h3 id="335-延迟函数">3.3.5 延迟函数<a href="#335-延迟函数" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>defer用于延迟执行一个函数调用，该函数会在<code>当前函数返回之前</code>被调用执行，无论该函数是正常返回还是发生异常。存在多个defer语句时，调用的顺序是<code>后进先出</code>。常用于<code>关闭文件、资源释放、释放锁及跟踪函数执行</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test3</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">resp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;https://baidu.com&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;error: %s&#34;</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">Body</span>.<span style="color:#a6e22e">Close</span>() <span style="color:#75715e">// 关闭资源
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test4</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;step1&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;step2&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;step3&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// step1 -&gt; step3 -&gt; step2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test5</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">test6</span>(<span style="color:#e6db74">&#34;test5&#34;</span>)() <span style="color:#75715e">// 会获取函数但会等到return前再执行
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;test5 do something...&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test6</span>(<span style="color:#a6e22e">msg</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">now</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>() <span style="color:#75715e">// 会在一开始获取函数值时就计算
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;enter %s&#34;</span>, <span style="color:#a6e22e">msg</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;exit %s(%s)&#34;</span>, <span style="color:#a6e22e">msg</span>, <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Since</span>(<span style="color:#a6e22e">now</span>))<span style="color:#75715e">//time.Since(now)会在test5返回时才会计算
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>执行<code>defer test6(&quot;test5&quot;)()</code>时，会先获取函数值（即test6中返回的匿名函数）但不会立马执行，会等到test5()方法返回前再执行。</li>
<li>defer函数执行时，其函数中的变量（即time.Since(now)）才会被确定，并在函数返回前保持不变。</li>
</ol>
</blockquote>
<h3 id="336-宕机与恢复">3.3.6 宕机与恢复<a href="#336-宕机与恢复" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>当程序遇到无法处理的错误或异常情况时，可以使用 <code>panic</code> 函数引发 panic。Panic会导致程序立即停止执行，并开始执行调用栈的展开过程，在其展开过程中执行defer函数，最后程序终止。</p>
<p><code>recover()</code>是一个内建函数，能够处理panic异常，其只能在defer函数中使用，用于捕获和处理panic异常。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test7</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;defer print&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">:=</span> recover(); <span style="color:#a6e22e">r</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Recovered from panic:&#34;</span>, <span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>	panic(<span style="color:#e6db74">&#34;Something went wrong&#34;</span>)                <span style="color:#75715e">// 宕机并输出日志信息和栈转储信息到stdout
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;This line will not be printed&#34;</span>) <span style="color:#75715e">// 不会被执行
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// Recovered from panic: Something went wrong -&gt; defer print 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>在使用recover()函数时，Panic不会导致程序停止执行，会被recover()捕获和处理。</li>
<li>recover()只能在defer函数中执行，存在多个defer函数时仍然按照<code>后进先出</code>的原则调用。</li>
</ol>
</blockquote>
<hr>
<h2 id="4-方法">4. 方法<a href="#4-方法" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h4 id="41-定义">4.1 定义<a href="#41-定义" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>在go中没有类的概念，一般用struct来代替类的操作，但struct中只包含字段属性，所以go提供了一种特殊的函数，其通过<code>作用在某个接收者上面来实现与其关联</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// func (接收者 接收者类型) 方法名(参数列表) 返回值类型 {}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Person</span>{<span style="color:#e6db74">&#34;jack&#34;</span>, <span style="color:#ae81ff">18</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;person: %p, person name: %s\n&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">p</span>, <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">printPerson</span>()     <span style="color:#75715e">// 基于值复制的传参
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">p</span>).<span style="color:#a6e22e">_printPerson</span>() <span style="color:#75715e">// 基于指针的传参
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">_printPerson</span>()    <span style="color:#75715e">// 与(&amp;p)效果相同，因为编译器会做隐式的转换
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">p1</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p1</span>.<span style="color:#a6e22e">_printPerson</span>() <span style="color:#75715e">// 当指针类型作为接收者时，类型可以为nil，值类型不可以为nil
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#a6e22e">Person</span>) <span style="color:#a6e22e">printPerson</span>() { <span style="color:#75715e">// person作为接收者类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;person: %p, person name: %s\n&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">p</span>, <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 允许nil作为接收者
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Person</span>) <span style="color:#a6e22e">_printPerson</span>() { <span style="color:#75715e">// 指针作为接收者类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">p</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;person: %p&#34;</span>, <span style="color:#a6e22e">p</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	(<span style="color:#f92672">*</span><span style="color:#a6e22e">p</span>).<span style="color:#a6e22e">Name</span> = <span style="color:#e6db74">&#34;lucy&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;person: %p, person name: %v\n&#34;</span>, <span style="color:#a6e22e">p</span>, (<span style="color:#f92672">*</span><span style="color:#a6e22e">p</span>).<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Person</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Age</span>  <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>相比函数，方法与其的区别在于多了接收者，即<code>把方法绑定到这个接收者对应的类型上</code>。</li>
<li>接收者可以是任何类型，但不能是接口，因为接口是抽象定义，方法确实具体实现。</li>
<li>允许出现接收者类型不同，但是方法名相同的方法。</li>
<li>接收者类型是指针时使用的是<code>引用传递</code>，其他则是<code>值传递</code>，针对同一个结构体的方法的接收者类型需要统一。</li>
<li>只有当接收者类型为指针时，可以将<code>nil作为实参</code>传入。</li>
<li>当实参是T类型的变量而形参的接收者是*T类型时，<code>编译器会隐式的获取变量的地址</code>。</li>
</ol>
</blockquote>
<h4 id="42-结构体内嵌的类型">4.2 结构体内嵌的类型<a href="#42-结构体内嵌的类型" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Inner</span> <span style="color:#66d9ef">struct</span>{ <span style="color:#a6e22e">A</span>, <span style="color:#a6e22e">B</span> <span style="color:#66d9ef">int</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">i</span> <span style="color:#a6e22e">Inner</span>) <span style="color:#a6e22e">inner</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Inner: A: %d, B: %d\n&#34;</span>, <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">A</span>, <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">B</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">o</span> <span style="color:#a6e22e">Outer</span>) <span style="color:#a6e22e">outer</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Outer: C: %s\n&#34;</span>, <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">C</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Outer</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Inner</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">C</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test3</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">o</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Outer</span>{<span style="color:#a6e22e">Inner</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>}, <span style="color:#e6db74">&#34;3&#34;</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">outer</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">inner</span>() <span style="color:#75715e">// 作用等同于o.Inner.inner()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><blockquote>
<p>通过结构体的嵌套，可以无感的调用内嵌的结构体的方法。</p>
</blockquote>
<h4 id="42-方法变量和方法表达式">4.2 方法变量和方法表达式<a href="#42-方法变量和方法表达式" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Person</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Age</span>  <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Person</span>) <span style="color:#a6e22e">modifyPerson</span>() { <span style="color:#75715e">// 指针作为实参的接收者类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;person: %#v\n&#34;</span>, <span style="color:#a6e22e">p</span>) <span style="color:#75715e">// 打印接收者参数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test5</span>(<span style="color:#a6e22e">f</span> <span style="color:#66d9ef">func</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">Person</span>)) { <span style="color:#75715e">// 方法表达式作为形参需要指定类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Person</span>{<span style="color:#e6db74">&#34;lucky&#34;</span>, <span style="color:#ae81ff">18</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">f</span>(<span style="color:#a6e22e">p</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Person</span>{<span style="color:#e6db74">&#34;jack&#34;</span>, <span style="color:#ae81ff">20</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">person</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">modifyPerson</span> <span style="color:#75715e">// 获取方法变量，只能在方法所属的实例p上调用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">person</span>() <span style="color:#75715e">// 调用方法 效果等同于 p.modifyPerson() 不需要指定接收者
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">person2</span> <span style="color:#f92672">:=</span> (<span style="color:#f92672">*</span><span style="color:#a6e22e">Person</span>).<span style="color:#a6e22e">modifyPerson</span> <span style="color:#75715e">// 获取方法表达式
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">person2</span>(<span style="color:#a6e22e">p</span>) <span style="color:#75715e">// 调用方法表达式时需要传入接收者实参
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">test5</span>(<span style="color:#a6e22e">person2</span>) <span style="color:#75715e">// 将方法表达式作为函数参数传递
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>方法变量：接<code>将方法赋值给一个变量</code>，不需要指定接收者，只能在方法所属类型的实例上调用，不能在其他类型的实例上调用。</li>
<li>方法表达式：方法表达式的语法是<code>T.methodName</code>，需要<code>显式指定接收者类型</code>作为第一个参数。可以作为普通函数一样传递。</li>
</ol>
</blockquote>
<h4 id="43-封装">4.3 封装<a href="#43-封装" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>如果变量或者方法不是通过对象访问到的，这称作<code>封装的变量或者方法（又称数据隐藏）</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 在另一个包中调用Logger的方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test6</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">l</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Logger</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">l</span>.<span style="color:#a6e22e">SetFlags</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;flags: %d&#34;</span>, <span style="color:#a6e22e">l</span>.<span style="color:#a6e22e">Flags</span>())
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Logger 定义实体，但字段是当前包私有，无法导出的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Logger</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flags</span>  <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">prefix</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Flags 等同于java中字段的getFlags方法，go默认去掉get，且可导出，所以方法名大写
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">logger</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Logger</span>) <span style="color:#a6e22e">Flags</span>() <span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">flags</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">logger</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Logger</span>) <span style="color:#a6e22e">SetFlags</span>(<span style="color:#a6e22e">flag</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">flags</span> = <span style="color:#a6e22e">flag</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>go中的封装效果等同于Java中的类字段属性设为私有，但是对外提供getter和setter用来修改字段属性。</li>
<li>go中的getter方法是默认去掉get的，比如getAge在go中就是Age，注意需要大写（因为需要对其他包导出）。</li>
</ol>
</blockquote>
<hr>
<h2 id="5-接口">5. 接口<a href="#5-接口" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>接口类型是对其他类型行为的概括和抽象。相比java的显示声明，go的独特之处在于它是<code>隐式实现</code>，对于一个具体的类型，无须声明它实现了哪些接口，只需要提供接口所必须的方法即可。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// interface{}效果等同于java中的Object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test1</span>(<span style="color:#a6e22e">args</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">interface</span>{}) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">args</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// any等同于interface{}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test2</span>(<span style="color:#a6e22e">args</span> <span style="color:#f92672">...</span><span style="color:#a6e22e">any</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">args</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>1.go中提供了一种接口类型，即<code>interface{}</code>，等价于java的Object。1.18版本后可以使用any替换，效果是等价的。</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Object</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">equals</span>(<span style="color:#a6e22e">source</span> <span style="color:#a6e22e">any</span>, <span style="color:#a6e22e">target</span> <span style="color:#a6e22e">any</span>) <span style="color:#66d9ef">bool</span> <span style="color:#75715e">// 此处不需要定义接收者类型，与给struct定义方法不同
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Say</span>                                 <span style="color:#75715e">// 接口嵌套接口
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Say</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">doSay</span>(<span style="color:#a6e22e">something</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">word</span> <span style="color:#66d9ef">string</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Phone</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Call</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Iphone</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Android</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">i</span> <span style="color:#a6e22e">Iphone</span>) <span style="color:#a6e22e">Call</span>() { <span style="color:#75715e">// 方法名、参数与返回值都必须相同
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;i&#39;m iphone!&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">a</span> <span style="color:#a6e22e">Android</span>) <span style="color:#a6e22e">Call</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;i&#39;m android!&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test3</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">phone</span> <span style="color:#a6e22e">Phone</span> <span style="color:#75715e">// 声明接口类型的变量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">phone</span> = new(<span style="color:#a6e22e">Iphone</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">phone</span>.<span style="color:#a6e22e">Call</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">phone</span> = new(<span style="color:#a6e22e">Android</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">phone</span>.<span style="color:#a6e22e">Call</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>接口的动态值：接口的类型信息 &amp; 接口值的具体值或底层对象的副本。</li>
<li>go的接口是隐式实现，一个类型只需要实现接口所定义的<code>所有方法</code>，无需显示声明。</li>
<li>接口是值类型，可以作为<code>函数的参数和返回值</code>，也可以<code>赋值给其他接口变量</code>。接口类型的零值是<code>nil</code>。</li>
<li>接口变量在运行时存放的是<code>实际的对象和值</code>，通过类型断言可以将接口变量转换为具体类型，并访问其属性和方法。</li>
</ol>
</blockquote>
<h3 id="51-接口断言">5.1 接口断言<a href="#51-接口断言" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>类型断言是一个作用在接口值上的操作，即<code>x.(T)</code>其中x是一个接口类型的表达式，T是一个类型（称为断言类型）。即<code>x的动态类型是否是T</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test5</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">p</span> <span style="color:#a6e22e">Phone</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p</span> = <span style="color:#a6e22e">Iphone</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.(<span style="color:#a6e22e">Iphone</span>) <span style="color:#75715e">// 接口断言：如果p的动态类型是Iphone，那么会返回p的动态值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">getIphone</span>()   <span style="color:#75715e">// 调用Iphone类型独有的方法（非实现的接口方法）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">:=</span> recover(); <span style="color:#a6e22e">r</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;s0 print error: %s\n&#34;</span>, <span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s0</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.(<span style="color:#a6e22e">Say</span>) <span style="color:#75715e">// 会产生panic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">s0</span>.<span style="color:#a6e22e">doSay</span>(<span style="color:#e6db74">&#34;hello&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">s</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.(<span style="color:#a6e22e">Say</span>); <span style="color:#a6e22e">ok</span> { <span style="color:#75715e">// ok返回bool值，表示p的类型是否是Say
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%#v\n&#34;</span>, <span style="color:#a6e22e">s</span>)
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;panic: interface conversion&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<h2 id="6-goroutine和channel">6. goroutine和channel<a href="#6-goroutine和channel" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<blockquote>
<ol>
<li>goroutine是Go语言中的轻量级线程，可以并发地执行函数或方法。</li>
<li>channel是goroutine之间进行通信和数据交换的管道。</li>
<li>goroutine与channel用于实现<code>并发和协程间的通信</code>。</li>
</ol>
</blockquote>
<h3 id="61-goroutine">6.1 goroutine<a href="#61-goroutine" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>goroutine是一种<code>轻量级的并发执行单元</code>，可与其他goroutine并行运行，相比线程，goroutine创建和切换的开销很小。通过<code>go</code>关键字来创建。使用<code>go</code>关键字启动一个函数或方法的执行时，会在一个单独的goroutine中运行该函数，与主goroutine并发执行。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test1</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">concurrent</span>(<span style="color:#66d9ef">false</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 通过关键字go创建goroutine
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">concurrent</span>(<span style="color:#66d9ef">true</span>) 
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">concurrent</span>(<span style="color:#a6e22e">sleep</span> <span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">sleep</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;123\n&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>与java类似，一个程序启动的时候会有一个主goroutine，主goroutine结束时，会导致其他的goroutine也结束。</p>
</blockquote>
<h3 id="62-channel">6.2 channel<a href="#62-channel" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>channel(通道)是一种用于在<code>goroutine</code>之间进行通信和同步的机制。通过发送操作发送数据到通道，从通道接收数据，发送和接收操作都是原子的，保证了数据的完整性和一致性。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">一个goroutine生产数据，主goroutine读取数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test7</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ch1</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">int</span>) <span style="color:#75715e">// 创建一个类型为`chan int`的无缓存通道
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; ; <span style="color:#a6e22e">x</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">ch1</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">x</span> <span style="color:#75715e">// 发送数据到通道
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span> {
</span></span><span style="display:flex;"><span>				close(<span style="color:#a6e22e">ch1</span>) <span style="color:#75715e">// 关闭通道
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/*for {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		fmt.Println(&#34;waiting&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		x := &lt;-ch1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		fmt.Println(x)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	}*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/*for {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		if x, ok := &lt;-ch1; ok {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			fmt.Println(x)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		} else {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			fmt.Printf(&#34;channel close, %d\n&#34;, x)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			time.Sleep(time.Second)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			//break
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	}*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/*for {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		if x, ok := &lt;-ch1; ok {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			fmt.Println(x)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		} else {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			fmt.Printf(&#34;channel close, %d\n&#34;, x) // 演示从关闭的通道中获取数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			time.Sleep(time.Second)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	}*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">ch1</span> { <span style="color:#75715e">// range可以循环读取通道所发送的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<table>
<thead>
<tr>
<th>语法</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>make(chan int)</td>
<td>创建<code>无缓存通道</code></td>
</tr>
<tr>
<td>make(chan int,3)</td>
<td>创建<code>缓存容量为3</code>的通道</td>
</tr>
<tr>
<td>len(make(chan int, 3))</td>
<td>获取通道内此时的元素个数（0）</td>
</tr>
<tr>
<td>cap(make(chan int, 3))</td>
<td>获取通道的缓冲区容量大小（3）</td>
</tr>
<tr>
<td>ch1 &lt;- x</td>
<td>发送数据到通道</td>
</tr>
<tr>
<td><code>x := &lt;- ch1</code></td>
<td>从通道读取数据并复制给x</td>
</tr>
<tr>
<td>&lt;- ch1</td>
<td>从通道读取数据但是丢弃</td>
</tr>
<tr>
<td>x,ok := &lt;- ch1</td>
<td>x是从通道读取的数据，ok表示通道是否关闭（false表示关闭）</td>
</tr>
<tr>
<td>for x := range ch1</td>
<td>用于循环读取通道所发送的值（阻塞等待）</td>
</tr>
<tr>
<td>close(ch1)</td>
<td>用于关闭通道</td>
</tr>
</tbody>
</table>
<ol>
<li><code>无缓存通道</code>上的发送操作会阻塞到另一个goroutine在对应的通道上<code>执行完接收操作</code>。同理接收方也会阻塞到另一个goroutine在对应的通道上发送一个值。</li>
<li><code>有缓存通道</code>上的发送操作会在<code>队列的尾部</code>插入一个元素，接收操作会从<code>队列的头部</code>移除一个元素。若通道满了，发送方会阻塞直到有另一个goroutine读取数据，同理接收方会阻塞到另一个goroutine发送数据。</li>
<li><code>close(ch)</code> 设置标志值表示已经发送完毕，向关闭后的通道发送数据会导致panic，从关闭后的通道获取数据会获取<code>类型的零值，且不会阻塞</code>。</li>
<li>关闭通道不是必须的，只有在通知接收方goroutine的所有数据都发送完毕是才需要关闭通道，垃圾回收器可以根据<code>通道是否可以访问来决定是否回收</code>。</li>
<li>若一个goroutine一直从<code>通道</code>中读取数据，但已经没有goroutine往<code>同一个通道中</code>发送数据，且<code>此通道没有关闭</code>，那么会出现<code>all goroutines are asleep - deadlock!</code>死锁的panic。</li>
<li>goroutine泄漏：对于无缓存通道，若有多个goroutine向通道发送数据，但是只接收了其中一个goroutine的数据，其他发送方发送的数据没有goroutine来接收。<code>泄露的goroutine不会自动回收</code>。</li>
</ol>
</blockquote>
<h4 id="621-单向通道类型">6.2.1 单向通道类型<a href="#621-单向通道类型" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// &lt;-chan int表示可以从通道中获取数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">onlyReceive</span>(<span style="color:#a6e22e">ch</span> <span style="color:#f92672">&lt;-</span><span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// chan&lt;- int表示可以向通道中发送数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">onlySend</span>(<span style="color:#a6e22e">ch</span> <span style="color:#66d9ef">chan</span><span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test6</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ch1</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">int</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ch2</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">int</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">in</span> <span style="color:#66d9ef">chan</span><span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">x</span> &lt; <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">x</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">in</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		close(<span style="color:#a6e22e">in</span>)
</span></span><span style="display:flex;"><span>	}(<span style="color:#a6e22e">ch1</span>) <span style="color:#75715e">// 隐式的将chan int转为了chan&lt;- int类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// 注意out和in对应的类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">out</span> <span style="color:#66d9ef">chan</span><span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">in</span> <span style="color:#f92672">&lt;-</span><span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">in</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">out</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		close(<span style="color:#a6e22e">out</span>)
</span></span><span style="display:flex;"><span>	}(<span style="color:#a6e22e">ch2</span>, <span style="color:#a6e22e">ch1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">in</span> <span style="color:#f92672">&lt;-</span><span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">in</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}(<span style="color:#a6e22e">ch2</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li><code>&lt;-chan int</code>表示只能从通道接收数据。<code>chan&lt;- int</code>表示只能发送数据到通道。</li>
<li><code>onlySend(make(chan int))</code>程序会隐式的将<code>chan int</code>转为<code>&lt;-chan int</code>或<code>chan&lt;- int</code>。</li>
</ol>
</blockquote>
<h3 id="63-waitgroup">6.3 WaitGroup<a href="#63-waitgroup" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p><code>sync.WaitGroup</code>是go中的一种同步机制，用于等待一组goroutine的完成（使用方法与逻辑与java中的countDownLatch类似）。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">var wg sync.WaitGroup
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">ch1 := make(chan int)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">wg.Add(1) // Add()在函数外
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">go func(){
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  defer wg.Done() // Done()在函数中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  // do something 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">go func() {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  wg.Wait()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  close(ch1)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">for x:= range ch1 {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  fmt.Println(x)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test10</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">now</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">total</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">wg</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span> <span style="color:#75715e">// 定义WaitGroup对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">ch1</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">int</span>)<span style="color:#75715e">// 定义channel
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">x</span> &lt; <span style="color:#ae81ff">100</span>; <span style="color:#a6e22e">x</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">1</span>) <span style="color:#75715e">// 必须在goroutine外!
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">x</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>() <span style="color:#75715e">// 任务完成后通过defer调用Done（将计时器减1）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>) <span style="color:#75715e">// 模拟任务执行耗时
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#a6e22e">ch1</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>		}(<span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Wait</span>() <span style="color:#75715e">// 当计时器为0时wait方法会返回
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		close(<span style="color:#a6e22e">ch1</span>)
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">ch1</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">total</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;time: %s, total: %d&#34;</span>, <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Since</span>(<span style="color:#a6e22e">now</span>), <span style="color:#a6e22e">total</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>WaitGroup对象的<code>Add(delta int)</code>方法用来给计数器增加值（<code>注意位置一定要在goroutine之前</code>），当任务完成时需要调用<code>Done()</code>来给计数器减1，一般配合defer延迟函数使用，<code>Wait()</code>会阻塞到计时器变为0。</li>
<li>与Java中的countDownLatch使用与概念相似，即等待所有goroutine任务完成后再继续执行任务。</li>
</ol>
</blockquote>
<h3 id="64-select多路复用">6.4 select多路复用<a href="#64-select多路复用" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p><code>select</code>语句用在多个通道中进行选择，可以等待多个通道中的消息到达，并执行相应的操作。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">select {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">case &lt;- ch1:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">case x := &lt;- ch2:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	// use x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">case ch3 &lt;- y:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">default:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test14</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">start</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//tick := time.Tick(time.Second) // 获取定时器的只读通道
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">ticker</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">NewTicker</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">abort</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">struct</span>{})
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdin</span>.<span style="color:#a6e22e">Read</span>(make([]<span style="color:#66d9ef">byte</span>, <span style="color:#ae81ff">1</span>)) <span style="color:#75715e">// 读取单个字节
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">abort</span> <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">struct</span>{}{}
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">countdown</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">5</span>; <span style="color:#a6e22e">countdown</span> &gt; <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">countdown</span><span style="color:#f92672">--</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">countdown</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">select</span> { <span style="color:#75715e">// 等待下面通道任意一个完成，若出现多个通道同时满足，那么select默认会随机选择一个
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">case</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">ticker</span>.<span style="color:#a6e22e">C</span>: <span style="color:#75715e">// 监听通道但是不做任何处理
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">case</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">abort</span>: <span style="color:#75715e">// 监听控制台输入的字节
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Launch abort!&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ticker</span>.<span style="color:#a6e22e">Stop</span>() <span style="color:#75715e">// 手动关闭通道防止泄漏
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Rocket launch: %s&#34;</span>, <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Since</span>(<span style="color:#a6e22e">start</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 利用有缓存通道和select实现 打印偶数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test13</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ch</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">1</span>) <span style="color:#75715e">// 设置缓存为1的有缓存通道
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">select</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">ch</span>: <span style="color:#75715e">// 偶数会从通道读取
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;x: %d\n&#34;</span>, <span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#a6e22e">ch</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">i</span>: <span style="color:#75715e">// 奇数循环会发送到通道
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>
<p><code>time.Tick(time.Second)</code>此方法用于创建定时器每秒触发一次操作，返回值为定时器的只读通道。</p>
</li>
<li>
<p>select配合time.After()可以实现超时等待功能，time.After()方法会在设定的时间后返回<code>&lt;- chan</code></p>
</li>
<li>
<p>若多个通道同时到达，select会随机选择一个，若没有任何通道准备就绪，且存在default分支，那么会执行default分支，否则select会阻塞到至少有一个通道准备就绪。</p>
</li>
<li>
<p>time.Tick()与time.NewTicker()都用于创建一个定时器，每隔一段时间触发一次操作。区别主要在于返回值类型，前者返回<code>&lt;- chan time.Time</code>只读通道，后者返回<code>*time.Ticker</code>一个定时器对象。定时器如果不<code>显式的停止</code>，那么对应的goroutine仍会一直执行（导致泄漏）,所以<code>Tick()</code>仅适用于<code>整个生命周期都需要时</code>才使用，否则建议使用<code>NewTicker()</code>，并显示的调用<code>Stop()</code>来阻止泄漏。</p>
</li>
</ol>
</blockquote>
<h4 id="641-并发目录遍历">6.4.1 并发目录遍历<a href="#641-并发目录遍历" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test15</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">roots</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Args</span>() <span style="color:#75715e">// ./main.exe C:/ D:/ E:/
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">roots</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">roots</span> = []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;.&#34;</span>}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fileSizes</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">int64</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">wg</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">root</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">roots</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">root</span> <span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">walkDir</span>(<span style="color:#a6e22e">root</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">wg</span>, <span style="color:#a6e22e">fileSizes</span>)
</span></span><span style="display:flex;"><span>		}(<span style="color:#a6e22e">root</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Wait</span>()
</span></span><span style="display:flex;"><span>		close(<span style="color:#a6e22e">fileSizes</span>)
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">nfiles</span>, <span style="color:#a6e22e">nbytes</span> <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">select</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">done</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;正在中断命令...&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">for</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">fileSizes</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#75715e">// do nothing 用来保证正在执行的goroutine执行完毕
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;所有goroutine执行完毕...&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#a6e22e">size</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">fileSizes</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">ok</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%d files %.1f MB\n&#34;</span>, <span style="color:#a6e22e">nfiles</span>, float64(<span style="color:#a6e22e">nbytes</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">1e6</span>) <span style="color:#75715e">// 1e6 = 1000000 1e9 = 1000000000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>				<span style="color:#a6e22e">nfiles</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">nbytes</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">size</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">递归查询目录，并计算文件大小传输到通道
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">walkDir</span>(<span style="color:#a6e22e">dir</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">wg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>, <span style="color:#a6e22e">fileSizes</span> <span style="color:#66d9ef">chan</span><span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">int64</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">cancelled</span>() { <span style="color:#75715e">// 查看终端通道有没有发送信号
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">entry</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">recurve</span>(<span style="color:#a6e22e">dir</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">entry</span>.<span style="color:#a6e22e">IsDir</span>() {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">subDir</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">filepath</span>.<span style="color:#a6e22e">Join</span>(<span style="color:#a6e22e">dir</span>, <span style="color:#a6e22e">entry</span>.<span style="color:#a6e22e">Name</span>())
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">walkDir</span>(<span style="color:#a6e22e">subDir</span>, <span style="color:#a6e22e">wg</span>, <span style="color:#a6e22e">fileSizes</span>) <span style="color:#75715e">// 递归获取
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">info</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">entry</span>.<span style="color:#a6e22e">Info</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stderr</span>, <span style="color:#e6db74">&#34;du1: %v\n&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>			} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">fileSizes</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">info</span>.<span style="color:#a6e22e">Size</span>()
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 全局通道，上线20，用于处理goroutine数量问题
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ch1</span> = make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">struct</span>{}, <span style="color:#ae81ff">20</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">读取指定目录下的文件并返回
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">recurve</span>(<span style="color:#a6e22e">dir</span> <span style="color:#66d9ef">string</span>) []<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">DirEntry</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">ch1</span> <span style="color:#75715e">// 释放凭证
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	}()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ch1</span> <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">struct</span>{}{} <span style="color:#75715e">// 获取凭证
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">entries</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">ReadDir</span>(<span style="color:#a6e22e">dir</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stderr</span>, <span style="color:#e6db74">&#34;du1: %v\n&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">entries</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">done</span> = make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">struct</span>{}) <span style="color:#75715e">// 搭配select实现goroutine的中断
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">判断任务有没有结束
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">cancelled</span>() <span style="color:#66d9ef">bool</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">select</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">case</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">done</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">default</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>使用<code>sync.WaitGroup</code>实现<code>goroutine</code>并发执行任务，并利用<code>有缓存通道</code>实现对<code>goroutine</code>数量的控制。</li>
<li>启动单独的goroutine监听用户的输入，并使用<code>select</code>实现对通道的监听实现实施中断goroutine。</li>
</ol>
</blockquote>
<hr>
<h2 id="7-并发和共享变量">7. 并发和共享变量<a href="#7-并发和共享变量" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<blockquote>
<p>并发：每个goroutine中的步骤是顺序执行的，但是多个goroutine不能保证先后执行顺序。</p>
<p>竞态：在多个goroutine按某些交错的顺序执行时程序无法给出正确的结果。</p>
<p>数据竞态：两个goroutine并发读写<code>同一个变量</code>且至少一个是写入。</p>
<p>互斥：允许多个goroutine访问同一个变量，但<code>同一时间只有一个goroutine可以访问</code>。</p>
</blockquote>
<h3 id="71-syncmutex">7.1 sync.Mutex<a href="#71-syncmutex" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>在多个goroutine获取通过sync.Mutex互斥锁获取共享变量时，没有获取到锁的goroutine会阻塞到已获取锁的goroutine释放锁，在一个goroutine中的加锁与释放锁的中间区域成为<code>临界区</code>，临界区域内可自由读取和修改共享变量。（<code>go的互斥锁不支持重入</code>）。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mute</span>    <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Mutex</span> <span style="color:#75715e">// 声明互斥锁
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">balance</span> <span style="color:#66d9ef">int</span> <span style="color:#75715e">// 共享变量需要紧接着Mutex声明之后
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test2</span>(){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">mute</span>.<span style="color:#a6e22e">Lock</span>() <span style="color:#75715e">// 尝试获取锁，若无法获取会阻塞到锁被其他goroutine释放
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">mute</span>.<span style="color:#a6e22e">Unlock</span>() <span style="color:#75715e">// 配合defer使用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#75715e">// 临界区域开始，临界区域内可自由读取和修改共享变量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">balance</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">200</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;当前余额: %d\n&#34;</span>, <span style="color:#a6e22e">balance</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// 临界区域结束
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mute</span>.<span style="color:#a6e22e">Lock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">balance</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">300</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;当前余额: %d\n&#34;</span>, <span style="color:#a6e22e">balance</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mute</span>.<span style="color:#a6e22e">Unlock</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="72-syncrwmutex">7.2 sync.RWMutex<a href="#72-syncrwmutex" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>多读单写锁：允许<code>只读操作并发</code>执行，但写操作需要获得<code>完全独享</code>的访问权限。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">m</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span> <span style="color:#75715e">// 读写锁
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">b</span> <span style="color:#66d9ef">int</span> <span style="color:#75715e">// 共享变量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">模拟读多写少的场景
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test4</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">100</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">balance3</span>()
</span></span><span style="display:flex;"><span>		}()
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">deposit3</span>(<span style="color:#a6e22e">i</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">balance3</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">RUnlock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">RLock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;balance: %d\n&#34;</span>, <span style="color:#a6e22e">b</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">deposit3</span>(<span style="color:#a6e22e">num</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">Lock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">Unlock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">balance</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">num</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;deposit: %d\n&#34;</span>, <span style="color:#a6e22e">num</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>读写锁只适用于获取读锁并且锁竞争比较激烈的场景，竞争不激烈时比普通的互斥锁慢。</p>
</blockquote>
<h3 id="73-内存同步">7.3 内存同步<a href="#73-内存同步" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>在单个goroutine中，执行顺序是<code>串行一致</code>的</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span>,<span style="color:#a6e22e">y</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>(){
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">x</span> = <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;y: %d\n&#34;</span>, <span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>}()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>(){
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">y</span> = <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;x: %d\n&#34;</span>, <span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>}()
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 有概率出现如下结果
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// x:0 y:0 ?
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// y:0 x:0 ? 
</span></span></span></code></pre></div><blockquote>
<ol>
<li>在单个goroutine中，语句的执行顺序是<code>串行一致</code>的。缺少同步操作的前提下，多个goroutine之间的执行顺序无法保证。</li>
<li><code>内存可见性</code>：多个处理器中，每个处理器都有自己的内存的本地缓存，在必要时才会将数据刷回内存。会导致一个goroutine的写入操作对另一个goroutine是不可见的。</li>
<li><code>编译器和CPU重排序</code>：编译器和处理器可能会对代码进行重新排序，以优化执行效率。因为上文中赋值的操作和print对应不同的变量，编译器可能会交换两个语句的执行顺序。</li>
</ol>
</blockquote>
<h3 id="74-synconce">7.4 sync.Once<a href="#74-synconce" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">once</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Once</span> <span style="color:#75715e">// 包含bool和Mutex
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">p</span>    <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Person</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test6</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">3</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">initPerson</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;person: %#v\n&#34;</span>, <span style="color:#a6e22e">p</span>)
</span></span><span style="display:flex;"><span>		}()
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">initPerson</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">once</span>.<span style="color:#a6e22e">Do</span>(<span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;init&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">p</span> = <span style="color:#a6e22e">Person</span>{<span style="color:#e6db74">&#34;jack&#34;</span>}
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>sync.Once中的Do方法每次调用时都会<code>锁定互斥量并检查里面的bool值</code>，为false就执行传入的函数，为true就不执行，对所有goroutine可见。实现<code>禁止重排序 + 互斥锁</code>的作用（类似java中dcl + volatile的效果）。</p>
</blockquote>
<h3 id="75-goroutine与线程">7.5 goroutine与线程<a href="#75-goroutine与线程" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<h4 id="751-栈">7.5.1 栈<a href="#751-栈" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<blockquote>
<p>每个操作系统都有一个固定大小的栈内存，主要用于保存函数调用期间那些<code>正在执行或临时暂停</code>的函数中的<code>局部变量</code>。</p>
</blockquote>
<p>goroutine在生命周期开始的时栈大小为<code>2KB</code>，但是它的大小不是固定的，是可以按需增大和缩小，最大可达<code>1GB</code>。</p>
<h4 id="752-调度">7.5.2 调度<a href="#752-调度" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<blockquote>
<p>CPU通过调用<code>调度器</code>的内核函数，这个函数会暂停当前正在运行的线程，将它寄存器的信息保存到内存，查看线程列表并决定接下来运行哪一个线程，再从内存恢复线程的注册表信息，最后执行选中的线程。</p>
</blockquote>
<p>go运行时包含一个自己的调度器，这个调度器使用一个<code>m:n</code>调度技术（<code>复用/调度m个goroutine到n个OS线程</code>），与内核调度器工作类似，但是go调度器只需要关心单个go程序的goroutine调度问题。</p>
<p>go调度器不是由硬件时钟来定期触发的，而是由特定的go语言结构来触发的，当一个goroutine调用<code>time.Sleep()或被通道阻塞或对互斥量操作时</code>，调度器就会将这个goroutine设置为休眠模式，并运行其他goroutine直到前一个可重新唤醒为止，相比内核调度器调度一个线程的成本要低得多。</p>
<blockquote>
<ol>
<li>go程序的<code>主线程</code>负责执行goroutine的调度工作，调度器会决定将新的goroutine放到哪个线程（processor）去执行。</li>
<li>调度器会将goroutine添加到<code>每个线程的本地队列</code>中。当有线程空闲时，它会从本地队列中获取goroutine并执行它。</li>
<li>如果线程的本地队列为空，processor会从<code>全局队列</code>中获取goroutine，全局队列存储所有未分配的goroutine。</li>
<li>调度器会根据<code>抢占调度、工作窃取</code>等方式，在某个goroutine执行时间过长或发生阻塞时中断该goroutine的执行，也可以在某个processor队列为空时，从其他processor的队列中窃取任务执行，实现负载均衡。</li>
</ol>
</blockquote>
<h4 id="753-gomaxprocs">7.5.3 GOMAXPROCS<a href="#753-gomaxprocs" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<blockquote>
<p>GOMAXPROCS设置需要多少个OS的线程来同时执行Go代码。默认是<code>cpu核心数量</code>。</p>
<p>正在休眠或者被通道通信阻塞的goroutine不占用线程。</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test9</span>() {
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">max</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">GOMAXPROCS</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#75715e">// 输入&lt;=0的值就是返回上次一次设置的参数，默认和CPU核数相同
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;GOMAXPROCS: %d\n&#34;</span>, <span style="color:#a6e22e">max</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">GOMAXPROCS</span>(<span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;GOMAXPROCS: %d\n&#34;</span>, <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">GOMAXPROCS</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test10</span>() {
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// GOMAXPROCS=1和!=1时输出的不同体现goroutine的调度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">GOMAXPROCS</span>(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">go</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Print</span>(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Print</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="754-goroutine标识">7.5.4 goroutine标识<a href="#754-goroutine标识" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>goroutine和java中的线程不同，后者会有一个独特的标识（例如线程id），go不引入唯一标识的原因：主要是为了保持简洁和易用性，避免额外的开销。其次go推荐使用通道和同步安全的传递数据，也就无须关注goroutine的标识符。</p>
<hr>
<h2 id="8-反射">8. 反射<a href="#8-反射" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<blockquote>
<p>反射：在编译时不知道类型的情况下，可更新变量，在运行时查看值，调用方法以及直接对他们的布局进行操作。</p>
</blockquote>
<h3 id="81-type">8.1 Type<a href="#81-type" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<h4 id="811-获取变量的类型">8.1.1 获取变量的类型<a href="#811-获取变量的类型" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">testReflect</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type1</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">TypeOf</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">TypeOf</span>(<span style="color:#e6db74">&#34;hello world&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type3</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">TypeOf</span>(<span style="color:#a6e22e">Person</span>{})                        <span style="color:#75715e">// 非指针类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">type4</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">TypeOf</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Person</span>{})                       <span style="color:#75715e">// 指针类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type of `%d` is %s\n&#34;</span>, <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">type1</span>)             <span style="color:#75715e">// int
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type of `%s` is %s\n&#34;</span>, <span style="color:#e6db74">&#34;hello world&#34;</span>, <span style="color:#a6e22e">type2</span>) <span style="color:#75715e">// string
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type of `%s` is %s\n&#34;</span>, <span style="color:#e6db74">&#34;Person{}&#34;</span>, <span style="color:#a6e22e">type3</span>)    <span style="color:#75715e">// Person
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type of `%s` is %s\n&#34;</span>, <span style="color:#e6db74">&#34;&amp;Person{}&#34;</span>, <span style="color:#a6e22e">type4</span>)   <span style="color:#75715e">// *Person
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;获取指针指向的底层值类型 -&gt; type4.Elem().equals(type3): %#v\n&#34;</span>, <span style="color:#a6e22e">type4</span>.<span style="color:#a6e22e">Elem</span>() <span style="color:#f92672">==</span> <span style="color:#a6e22e">type3</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>reflect.TypeOf() 获取变量的类型</li>
<li>Elem(): 用于获取反射值的元素类型，<code>用于指针的类型时，会返回指针指向的底层值的类型</code>；用于非引用类型，会导致panic。</li>
</ol>
</blockquote>
<h4 id="812-获取结构体成员变量">8.1.2 获取结构体成员变量<a href="#812-获取结构体成员变量" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Person</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Name</span>    <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Age</span>     <span style="color:#66d9ef">int</span>    <span style="color:#e6db74">`json:&#34;age&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Address</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;addr&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#a6e22e">Person</span>) <span style="color:#a6e22e">GetName</span>() <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">Name</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Person</span>) <span style="color:#a6e22e">GetName2</span>(<span style="color:#a6e22e">in</span> <span style="color:#a6e22e">Person</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">in</span>.<span style="color:#a6e22e">Name</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">testReflect</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">TypeOf</span>(<span style="color:#a6e22e">Person</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jack&#34;</span>, <span style="color:#a6e22e">Age</span>: <span style="color:#ae81ff">48</span>, <span style="color:#a6e22e">Address</span>: <span style="color:#e6db74">&#34;地球村&#34;</span>}) <span style="color:#75715e">// 不能用指针
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">numField</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">NumField</span>() <span style="color:#75715e">// 获取变量数量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">numField</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">field</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">Field</span>(<span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;字段名称: %s, 字段内存偏移量: %d, 是否为匿名成员: %t, 数据类型: %v, 包外是否可见: %t, 字段tag: %s\n&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">field</span>.<span style="color:#a6e22e">Name</span>, <span style="color:#a6e22e">field</span>.<span style="color:#a6e22e">Offset</span>, <span style="color:#a6e22e">field</span>.<span style="color:#a6e22e">Anonymous</span>, <span style="color:#a6e22e">field</span>.<span style="color:#a6e22e">Type</span>, <span style="color:#a6e22e">field</span>.<span style="color:#a6e22e">IsExported</span>(), <span style="color:#a6e22e">field</span>.<span style="color:#a6e22e">Tag</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;json&#34;</span>))
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 通过字段名获取字段
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">FieldByName</span>(<span style="color:#e6db74">&#34;Name&#34;</span>); <span style="color:#a6e22e">ok</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Name is exported: %t\n&#34;</span>, <span style="color:#a6e22e">name</span>.<span style="color:#a6e22e">IsExported</span>())
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="813-获取结构体的成员方法">8.1.3 获取结构体的成员方法<a href="#813-获取结构体的成员方法" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">testReflect</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">TypeOf</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Person</span>{})
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">p2</span>.<span style="color:#a6e22e">NumMethod</span>(); <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">method2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p2</span>.<span style="color:#a6e22e">Method</span>(<span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;方法名: %s, 方法类型： %s, 包外是否可见: %t\n&#34;</span>, <span style="color:#a6e22e">method2</span>.<span style="color:#a6e22e">Name</span>, <span style="color:#a6e22e">method2</span>.<span style="color:#a6e22e">Type</span>, <span style="color:#a6e22e">method2</span>.<span style="color:#a6e22e">IsExported</span>())
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<ol>
<li>reflect.TypeOf()传入指针类型，那么返回了<code>指针指向的类型的所有方法（包括值接收者方法和指针接收者方法）</code>；如果传入值类型那么只会包含该类型的值接收者方法（设计如此）。</li>
<li>方法名必须是exported，否则反射无法获取到。</li>
</ol>
</blockquote>
<h4 id="814-获取函数信息">8.1.4 获取函数信息<a href="#814-获取函数信息" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">GetName3</span>(<span style="color:#a6e22e">in</span> <span style="color:#a6e22e">Person</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">in</span>.<span style="color:#a6e22e">Name</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">testReflect</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">typeFunc</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">TypeOf</span>(<span style="color:#a6e22e">GetName3</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">in</span>, <span style="color:#a6e22e">out</span> []<span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">typeFunc</span>.<span style="color:#a6e22e">NumIn</span>(); <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">in</span> = append(<span style="color:#a6e22e">in</span>, <span style="color:#a6e22e">typeFunc</span>.<span style="color:#a6e22e">In</span>(<span style="color:#a6e22e">i</span>).<span style="color:#a6e22e">String</span>())
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">typeFunc</span>.<span style="color:#a6e22e">NumOut</span>(); <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">out</span> = append(<span style="color:#a6e22e">out</span>, <span style="color:#a6e22e">typeFunc</span>.<span style="color:#a6e22e">Out</span>(<span style="color:#a6e22e">i</span>).<span style="color:#a6e22e">String</span>())
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;函数名称: %s, 函数入参: %s, 函数出参: %s\n&#34;</span>, <span style="color:#a6e22e">typeFunc</span>.<span style="color:#a6e22e">Name</span>(), <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Join</span>(<span style="color:#a6e22e">in</span>, <span style="color:#e6db74">&#34;,&#34;</span>), <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Join</span>(<span style="color:#a6e22e">out</span>, <span style="color:#e6db74">&#34;,&#34;</span>))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="815-判断是否实现接口">8.1.5 判断是否实现接口<a href="#815-判断是否实现接口" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">People</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">GetName</span>() <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#a6e22e">Person</span>) <span style="color:#a6e22e">GetName</span>() <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">Name</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">testReflect</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">typePeople</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">TypeOf</span>((<span style="color:#f92672">*</span><span style="color:#a6e22e">People</span>)(<span style="color:#66d9ef">nil</span>)).<span style="color:#a6e22e">Elem</span>() <span style="color:#75715e">// people是接口无法创建，需要通过nil强制转换
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">p1</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">TypeOf</span>(<span style="color:#a6e22e">Person</span>{})
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;People是否是接口: %t, Person是否实现接口People： %t\n&#34;</span>, <span style="color:#a6e22e">typePeople</span>.<span style="color:#a6e22e">Kind</span>() <span style="color:#f92672">==</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">Interface</span>, <span style="color:#a6e22e">p1</span>.<span style="color:#a6e22e">Implements</span>(<span style="color:#a6e22e">typePeople</span>))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="82-value">8.2 Value<a href="#82-value" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<h4 id="821-基本操作">8.2.1 基本操作<a href="#821-基本操作" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;-------------------------&gt; reflect.ValueOf() &lt;-------------------------&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">value</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">Type</span>()                                                                                          <span style="color:#75715e">// value转type
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;value: %#v, type: %s, kind: %s, cast value: %#v&#34;</span>, <span style="color:#a6e22e">value</span>, <span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Kind</span>(), <span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">Interface</span>().(<span style="color:#66d9ef">int</span>)) <span style="color:#75715e">// 强制转换数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">person</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Person</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;aio&#34;</span>, <span style="color:#a6e22e">Address</span>: <span style="color:#e6db74">&#34;china&#34;</span>, <span style="color:#a6e22e">Age</span>: <span style="color:#ae81ff">18</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">pv</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#a6e22e">person</span>)       <span style="color:#75715e">// 指针value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">pv2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">pv</span>.<span style="color:#a6e22e">Elem</span>()                    <span style="color:#75715e">// 指针转为非指针value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">pv2</span>.<span style="color:#a6e22e">Addr</span>()                          <span style="color:#75715e">// 非指针转为指针value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">p3</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">pv</span>.<span style="color:#a6e22e">Interface</span>().(<span style="color:#f92672">*</span><span style="color:#a6e22e">Person</span>).<span style="color:#a6e22e">Name</span> <span style="color:#75715e">// 获取初始值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">p3</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">p4</span> <span style="color:#66d9ef">interface</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#a6e22e">p4</span>) <span style="color:#75715e">// 没有指向具体的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">p5</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Person</span> = <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">v1</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#a6e22e">p5</span>) <span style="color:#75715e">// 获取nil值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;v invaild? %t, v1 is nil? %t\n&#34;</span>, <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Kind</span>() <span style="color:#f92672">==</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">Invalid</span>, <span style="color:#a6e22e">v1</span>.<span style="color:#a6e22e">IsNil</span>())
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="822-修改变量">8.2.2 修改变量<a href="#822-修改变量" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">p6</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Person</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Name</span>:    <span style="color:#e6db74">&#34;jack&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Age</span>:     <span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Address</span>: <span style="color:#e6db74">&#34;china&#34;</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">v6</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#a6e22e">p6</span>)                         <span style="color:#75715e">// 必须传递指针才能修改原来的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">v6</span>.<span style="color:#a6e22e">Elem</span>().<span style="color:#a6e22e">FieldByName</span>(<span style="color:#e6db74">&#34;&#34;</span>).<span style="color:#a6e22e">CanSet</span>(); <span style="color:#a6e22e">ok</span> { <span style="color:#75715e">// CanSet()用来判断成员是否导出，只有可以导出的成员变量才能被修改
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">v6</span>.<span style="color:#a6e22e">Elem</span>().<span style="color:#a6e22e">FieldByName</span>(<span style="color:#e6db74">&#34;Name&#34;</span>).<span style="color:#a6e22e">SetString</span>(<span style="color:#e6db74">&#34;lucy&#34;</span>) <span style="color:#75715e">// 必须将指针转为非指针后才能修改值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;new value: %#v\n&#34;</span>, <span style="color:#a6e22e">v6</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">v7</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(make([]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>)) <span style="color:#75715e">// 修改slice的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">v7</span>.<span style="color:#a6e22e">Len</span>() &gt; <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">v7</span>.<span style="color:#a6e22e">Index</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">SetInt</span>(<span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;v7 value: %#v\n&#34;</span>, <span style="color:#a6e22e">v7</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="823-调用函数">8.2.3 调用函数<a href="#823-调用函数" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;-------------------------&gt; reflect.ValueOf()调用函数 &lt;-------------------------\n&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">valueFunc</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#a6e22e">GetName3</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slice1</span> <span style="color:#f92672">:=</span> make([]<span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">Value</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slice1</span>[<span style="color:#ae81ff">0</span>] = <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#a6e22e">Person</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;zhangsan&#34;</span>, <span style="color:#a6e22e">Age</span>: <span style="color:#ae81ff">18</span>, <span style="color:#a6e22e">Address</span>: <span style="color:#e6db74">&#34;usa&#34;</span>})
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">resultValue</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">valueFunc</span>.<span style="color:#a6e22e">Call</span>(<span style="color:#a6e22e">slice1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;resultValue: %#v\n&#34;</span>, <span style="color:#a6e22e">resultValue</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">String</span>())
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="824-调用成员方法">8.2.4 调用成员方法<a href="#824-调用成员方法" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;-------------------------&gt; reflect.ValueOf()调用成员方法 &lt;-------------------------\n&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">v8</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Person</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Name</span>:    <span style="color:#e6db74">&#34;jack&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Age</span>:     <span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Address</span>: <span style="color:#e6db74">&#34;China&#34;</span>,
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">method</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">v8</span>.<span style="color:#a6e22e">MethodByName</span>(<span style="color:#e6db74">&#34;GetName&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">resultValue1</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">method</span>.<span style="color:#a6e22e">Call</span>([]<span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">Value</span>{})
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;resultValue: %#v\n&#34;</span>, <span style="color:#a6e22e">resultValue1</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">String</span>())
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
      </div></div>

  
  
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">其他文章</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="https://leejay.top/post/jvm_in_action/">
                <span class="button__icon">←</span>
                <span class="button__text">Java虚拟机概述</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="https://leejay.top/post/raspberrypi/">
                <span class="button__text">Raspberrypi搭建指南</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span><a rel="nofollow" href="https://beian.miit.gov.cn/" target="_blank">苏ICP备18050258号-1</a></span>
    
        
      </div>
  </div>
</footer>

<script src="https://leejay.top/assets/main.js"></script>
<script src="https://leejay.top/assets/prism.js"></script>






  
</div>

</body>
</html>
