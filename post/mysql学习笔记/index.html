<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Mysql学习笔记 :: Keep Improving</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="MySQL中的字符集和比较规则 字符集 SHOW CHARSET LIKE &amp;#39;utf8_%&amp;#39;;    字符集 编码长度     ASCII（128个字符） 1字节   ISO 8859-1（256个字符，又叫latin1） 1字节   GB2312（收录6763个汉字，兼容ASCII） 字符在ASCII中采用1字节，否则2字节   GBK（对GB2312进行扩充，兼容GB2312） 与GB2312相同   Unicode（兼容ASCII字符集，采用变长编码方式） UTF-8:：1-4个字节，UTF-16：2或4字节，UTF-32：4字节     MySQL中的utf8和utf8mb4字符集区别在于前者是1-3字符（阉割），后者是1-4字符。
 比较规则 SHOW COLLATION LIKE &amp;#39;utf8_%&amp;#39;;    后缀 英文 不区分重音     _ai accent insensitive 不区分重音   _as accent sensitive 区分重音   _ci case insensitive 不区分大小写   _cs case sensitive 区分大小写   _bin binary 以二进制方式比较     MySQL中utf8默认的比较规则就是utf8_general_ci。" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://leejay.top/post/mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" />




<link rel="stylesheet" href="https://leejay.top/assets/style.css">






<link rel="apple-touch-icon" href="https://leejay.top/img/favicon.png">

  <link rel="shortcut icon" href="https://leejay.top/img/favicon.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Mysql学习笔记">
<meta property="og:description" content="基于掘金小册《Mysql是怎样运行》的读书笔记。" />
<meta property="og:url" content="https://leejay.top/post/mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" />
<meta property="og:site_name" content="Keep Improving" />

  
    <meta property="og:image" content="https://leejay.top/img/favicon.png">
  

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

  <meta property="article:section" content="Mysql" />


  <meta property="article:published_time" content="2021-07-23 09:51:37 &#43;0800 &#43;0800" />










<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Code">

</head>
<body class="orange">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="https://leejay.top">
  <div class="logo">
    无边落木萧萧下，不尽长江滚滚来
  </div>
</a>

    </div>
    
  </div>
  
</header>


  <div class="content">
    
<div class="post">
  
  
    









<div class="toc" id="toc_id">

    <div class="page-header"><strong>- CATALOG -</strong></div>

    <div id="page-scrollspy" class="toc-nav">

        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#mysql%e4%b8%ad%e7%9a%84%e5%ad%97%e7%ac%a6%e9%9b%86%e5%92%8c%e6%af%94%e8%be%83%e8%a7%84%e5%88%99">
                    MySQL中的字符集和比较规则
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%ad%97%e7%ac%a6%e9%9b%86">
                    字符集
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e6%af%94%e8%be%83%e8%a7%84%e5%88%99">
                    比较规则
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%ad%97%e7%ac%a6%e9%9b%86%e4%b8%8e%e6%af%94%e8%be%83%e8%a7%84%e5%88%99%e7%9a%84%e7%ba%a7%e5%88%ab">
                    字符集与比较规则的级别
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#mysql%e4%b8%ad%e5%ad%97%e7%ac%a6%e9%9b%86%e7%9a%84%e8%bd%ac%e6%8d%a2">
                    MySQL中字符集的转换
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#mysql%e7%b4%a2%e5%bc%95">
                    MySQL索引
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e6%a6%82%e5%bf%b5">
                    概念
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#b%e6%a0%91">
                    B&#43;树
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e8%81%9a%e7%b0%87%e7%b4%a2%e5%bc%95">
                    聚簇索引
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e4%ba%8c%e7%ba%a7%e7%b4%a2%e5%bc%95">
                    二级索引
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e8%81%94%e5%90%88%e7%b4%a2%e5%bc%95">
                    联合索引
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9">
                    注意事项
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e7%b4%a2%e5%bc%95%e7%9a%84%e6%9f%a5%e8%af%a2">
                    索引的查询
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e7%b4%a2%e5%bc%95%e9%80%82%e7%94%a8%e6%9d%a1%e4%bb%b6">
                    索引适用条件
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%85%a8%e5%80%bc%e5%8c%b9%e9%85%8d">
                    全值匹配
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e6%9c%80%e5%b7%a6%e5%8c%b9%e9%85%8d">
                    最左匹配
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%89%8d%e7%bc%80%e5%8c%b9%e9%85%8d">
                    前缀匹配
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e8%8c%83%e5%9b%b4%e5%8c%b9%e9%85%8d">
                    范围匹配
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e7%b2%be%e7%a1%ae%e5%8c%b9%e9%85%8d%e6%9f%90%e4%b8%80%e5%88%97%e4%b8%8e%e8%8c%83%e5%9b%b4%e5%8c%b9%e9%85%8d%e5%8f%a6%e4%b8%80%e5%88%97">
                    精确匹配某一列与范围匹配另一列
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e6%8e%92%e5%ba%8f">
                    排序
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%88%86%e7%bb%84">
                    分组
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8%e7%b4%a2%e5%bc%95">
                    如何使用索引
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#mysql%e7%9a%84%e6%95%b0%e6%8d%ae%e7%9b%ae%e5%bd%95">
                    MySQL的数据目录
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e6%95%b0%e6%8d%ae%e7%9b%ae%e5%bd%95%e7%9a%84%e7%bb%84%e6%88%90">
                    数据目录的组成
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#mysql%e7%b3%bb%e7%bb%9f%e6%95%b0%e6%8d%ae%e5%ba%93">
                    MySQL系统数据库
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#mysql%e7%9a%84%e5%8d%95%e8%a1%a8%e8%ae%bf%e9%97%ae%e6%96%b9%e6%b3%95">
                    MySQL的单表访问方法
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%8d%95%e8%a1%a8%e8%ae%bf%e9%97%ae%e6%96%b9%e6%b3%95">
                    单表访问方法
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%8d%95%e8%a1%a8%e8%ae%bf%e9%97%ae%e7%9a%84%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9">
                    单表访问的注意事项
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%8d%95%e4%b8%aa%e4%ba%8c%e7%ba%a7%e7%b4%a2%e5%bc%95">
                    单个二级索引
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e7%b4%a2%e5%bc%95%e5%90%88%e5%b9%b6">
                    索引合并
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#mysql%e5%a4%9a%e8%a1%a8%e6%9f%a5%e8%af%a2">
                    Mysql多表查询
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e8%bf%9e%e6%8e%a5%e7%9a%84%e8%bf%87%e7%a8%8b">
                    连接的过程
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e8%bf%9e%e6%8e%a5%e7%9a%84%e7%b1%bb%e5%9e%8b">
                    连接的类型
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e8%bf%9e%e6%8e%a5%e7%9a%84%e5%8e%9f%e7%90%86">
                    连接的原理
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%be%aa%e7%8e%af%e5%b5%8c%e5%a5%97%e8%bf%9e%e6%8e%a5">
                    循环嵌套连接
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%9f%ba%e4%ba%8e%e5%9d%97%e7%9a%84%e8%bf%9e%e6%8e%a5">
                    基于块的连接
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#mysql%e5%9f%ba%e4%ba%8e%e6%88%90%e6%9c%ac%e7%9a%84%e4%bc%98%e5%8c%96">
                    Mysql基于成本的优化
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e6%88%90%e6%9c%ac%e7%9a%84%e5%ae%9a%e4%b9%89">
                    成本的定义
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%8d%95%e8%a1%a8%e6%9f%a5%e8%af%a2%e7%9a%84%e6%88%90%e6%9c%ac">
                    单表查询的成本
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%9f%ba%e4%ba%8e%e6%88%90%e6%9c%ac%e7%9a%84%e4%bc%98%e5%8c%96%e6%ad%a5%e9%aa%a4">
                    基于成本的优化步骤
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%9f%ba%e4%ba%8e%e7%b4%a2%e5%bc%95%e7%bb%9f%e8%ae%a1%e6%95%b0%e6%8d%ae%e7%9a%84%e6%88%90%e6%9c%ac%e8%ae%a1%e7%ae%97">
                    基于索引统计数据的成本计算
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%a4%9a%e8%a1%a8%e8%bf%9e%e6%8e%a5%e7%9a%84%e6%88%90%e6%9c%ac">
                    多表连接的成本
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#mysql%e5%9f%ba%e4%ba%8e%e8%a7%84%e5%88%99%e7%9a%84%e4%bc%98%e5%8c%96">
                    Mysql基于规则的优化
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e6%9d%a1%e4%bb%b6%e5%8c%96%e7%ae%80">
                    条件化简
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%a4%96%e8%bf%9e%e6%8e%a5%e6%b6%88%e9%99%a4">
                    外连接消除
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#%e5%ad%90%e6%9f%a5%e8%af%a2%e4%bc%98%e5%8c%96">
                    子查询优化
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#explain">
                    Explain
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#explain%e5%90%8d%e8%af%8d%e8%a7%a3%e9%87%8a">
                    Explain名词解释
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#id">
                    id
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#select_type">
                    select_type
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#type">
                    type
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#possible_keys%e5%92%8ckey">
                    possible_keys和key
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#key_len">
                    key_len
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#ref">
                    ref
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#rows">
                    rows
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#filtered">
                    filtered
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#extra">
                    Extra
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#json%e6%a0%bc%e5%bc%8f%e6%9f%a5%e7%9c%8b%e6%88%90%e6%9c%ac">
                    Json格式查看成本
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        
        
        
        
        
        
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
        <ul class="nav">
            
            
            <li class="nav-item">
                <a class="nav-link" href="#extended-explain">
                    Extended EXPLAIN
                </a>
            </li>
            
            
        </ul>
        
        </ul>
        
        </ul>
        
        </ul>
        
        
        
        

    </div>

</div>



  
  <h1 class="post-title">
    <a href="https://leejay.top/post/mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Mysql学习笔记</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2021-07-23 
      </span>
    
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://leejay.top/tags/mysql/">Mysql</a>&nbsp;
    
  </span>
  

  

  

  <div class="post-content"><div>
        <h2 id="mysql中的字符集和比较规则">MySQL中的字符集和比较规则<a href="#mysql中的字符集和比较规则" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="字符集">字符集<a href="#字符集" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">CHARSET</span> <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;utf8_%&#39;</span>;
</code></pre></div><table>
<thead>
<tr>
<th>字符集</th>
<th>编码长度</th>
</tr>
</thead>
<tbody>
<tr>
<td>ASCII（128个字符）</td>
<td>1字节</td>
</tr>
<tr>
<td>ISO 8859-1（256个字符，又叫latin1）</td>
<td>1字节</td>
</tr>
<tr>
<td>GB2312（收录6763个汉字，兼容ASCII）</td>
<td>字符在ASCII中采用1字节，否则2字节</td>
</tr>
<tr>
<td>GBK（对GB2312进行扩充，兼容GB2312）</td>
<td>与GB2312相同</td>
</tr>
<tr>
<td>Unicode（兼容<code>ASCII</code>字符集，采用变长编码方式）</td>
<td>UTF-8:：1-4个字节，UTF-16：2或4字节，UTF-32：4字节</td>
</tr>
</tbody>
</table>
<blockquote>
<p>MySQL中的<code>utf8</code>和<code>utf8mb4</code>字符集区别在于前者是1-3字符（阉割），后者是1-4字符。</p>
</blockquote>
<h3 id="比较规则">比较规则<a href="#比较规则" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SHOW</span> COLLATION <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;utf8_%&#39;</span>;
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:center">后缀</th>
<th style="text-align:center">英文</th>
<th style="text-align:center">不区分重音</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>_ai</code></td>
<td style="text-align:center"><code>accent insensitive</code></td>
<td style="text-align:center">不区分重音</td>
</tr>
<tr>
<td style="text-align:center"><code>_as</code></td>
<td style="text-align:center"><code>accent sensitive</code></td>
<td style="text-align:center">区分重音</td>
</tr>
<tr>
<td style="text-align:center"><code>_ci</code></td>
<td style="text-align:center"><code>case insensitive</code></td>
<td style="text-align:center">不区分大小写</td>
</tr>
<tr>
<td style="text-align:center"><code>_cs</code></td>
<td style="text-align:center"><code>case sensitive</code></td>
<td style="text-align:center">区分大小写</td>
</tr>
<tr>
<td style="text-align:center"><code>_bin</code></td>
<td style="text-align:center"><code>binary</code></td>
<td style="text-align:center">以二进制方式比较</td>
</tr>
</tbody>
</table>
<blockquote>
<p>MySQL中utf8默认的比较规则就是<code>utf8_general_ci</code>。</p>
</blockquote>
<h3 id="字符集与比较规则的级别">字符集与比较规则的级别<a href="#字符集与比较规则的级别" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># [服务器级别]
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SHOW</span> VARIABLES <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;character_set_server&#39;</span>;
<span style="color:#66d9ef">SHOW</span> VARIABLES <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;collation_server&#39;</span>;
<span style="color:#75715e"># [创建或修改数据库比较规则]
</span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span>[<span style="color:#66d9ef">ALTER</span>] <span style="color:#66d9ef">DATABASE</span> [database_name] <span style="color:#66d9ef">CHARACTER</span> <span style="color:#66d9ef">SET</span> utf8 <span style="color:#66d9ef">COLLATE</span> utf8_general_ci;
<span style="color:#75715e"># [数据库级别]
</span><span style="color:#75715e"></span><span style="color:#66d9ef">USE</span> [database_name];
<span style="color:#66d9ef">SHOW</span> VARIABLES <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;character_set_database&#39;</span>;
<span style="color:#66d9ef">SHOW</span> VARIABLES <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;collation_database&#39;</span>;
<span style="color:#75715e"># [表级别] 如果表不设置字符集和比较规则，默认继承数据库的配置
</span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span>[<span style="color:#66d9ef">ALTER</span>] <span style="color:#66d9ef">TABLE</span> <span style="color:#a6e22e">unicode</span>(name <span style="color:#66d9ef">VARCHAR</span>(<span style="color:#ae81ff">10</span>)) <span style="color:#66d9ef">CHARACTER</span> <span style="color:#66d9ef">SET</span> utf8 <span style="color:#66d9ef">COLLATE</span> utf8_general_ci;
<span style="color:#75715e"># [表级别] 查看表的字符集和编码规则
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">TABLE</span> STATUS <span style="color:#66d9ef">FROM</span> unicode;

<span style="color:#75715e"># [创建列的字符集和比较规则] 不设置默认读取表的配置
</span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#a6e22e">line</span>(
	name <span style="color:#66d9ef">VARCHAR</span>(<span style="color:#ae81ff">10</span>) <span style="color:#66d9ef">CHARACTER</span> <span style="color:#66d9ef">SET</span> utf8 <span style="color:#66d9ef">COLLATE</span> utf8_general_ci,
    age <span style="color:#66d9ef">INT</span>(<span style="color:#ae81ff">16</span>)
)
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> [table_name] MODIFY [<span style="color:#66d9ef">column</span>] <span style="color:#66d9ef">VARCHAR</span> <span style="color:#66d9ef">CHARACTER</span> <span style="color:#66d9ef">SET</span> latin1 <span style="color:#66d9ef">COLLATE</span> latin1_general_cs;
</code></pre></div><blockquote>
<p>无论是只修改字符集或比较规则，未设置的一方都会自动的改为与修改一方对应的配置。</p>
</blockquote>
<h3 id="mysql中字符集的转换">MySQL中字符集的转换<a href="#mysql中字符集的转换" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p><img src="https://image.leejay.top/FrSGcCPcK8QLB6_kDsuBDygM8shm" alt=""></p>
<blockquote>
<p>可以使用<code>SET NAMES utf8;</code>一起设置如上三个参数配置。</p>
</blockquote>
<hr>
<h2 id="mysql索引">MySQL索引<a href="#mysql索引" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="概念">概念<a href="#概念" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<h4 id="b树">B+树<a href="#b树" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>B+树最上层的是根节点，还包含存放目录记录的数据页（目录页）非叶子节点和存放用户记录的数据页（用户记录页）叶子节点。</p>
<p><img src="https://image.leejay.top/Fk4MgNHjS271O1t7aTzGFQ8mwf6A" alt=""></p>
<blockquote>
<p>目录页和用户记录页的区别在于前者中的目录数据的<code>record_type = 1</code>，后者的用户记录数据的<code>record_type  = 0</code>。目录页中映射的索引列的值都是对应用户记录页中索引列的最小值。</p>
</blockquote>
<h4 id="聚簇索引">聚簇索引<a href="#聚簇索引" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>根据<code>主键值的大小(从小到大)</code>进行目录页（双向链表）和记录页（单向链表）的排序，B+树的叶子节点存储的是<code>完整的用户数据（包括隐藏列）。</code>InnoDB存储引擎会自动的为我们创建聚簇索引。</p>
<h4 id="二级索引">二级索引<a href="#二级索引" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>根据<code>指定列的大小（从小到大）</code>进行目录页（双向链表）和记录页（单向链表）的排序， B+树的叶子节点存储的是``指定列的值 + 主键值<code>，相比聚簇索引，二级索引第一次查询得到主键值后，会进行第二次</code>回表查询`操作。</p>
<blockquote>
<p>二级索引在目录页中存放的记录是<code>指定列 + 主键值 + 目录页码（保证唯一性）</code>，这样能够在指定列出现相同值时定位到目录页（叶子节点）。</p>
<p>回表还是全表扫描，这个是由回表的代价决定的，如果第一次查询二级索引（顺序IO）有90%的数据需要回表查询(随机IO)，那么不如直接进行全表扫描（这个是由<code>查询优化器</code>决定的）。</p>
<p>所以更推荐<code>覆盖索引</code>，即查询的列表中只包含索引列。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 这样就不需要回表查询了，因为查询的字段在二级索引的叶子节点中都存在
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> name, birthday, phone_number <span style="color:#66d9ef">FROM</span> person_info <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> name, birthday, phone_number;
</code></pre></div></blockquote>
<h4 id="联合索引">联合索引<a href="#联合索引" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>本质上也是一个二级索引，现根据A列的大小进行排序，在A列的值相等的情况下根据B列的值进行排序。非叶子节点（目录页）由<code>A列 + B列 + 主键 + 页码</code>组成，同时叶子节点的用户记录由<code>A列 + B列 + 主键列</code>组成。</p>
<h4 id="注意事项">注意事项<a href="#注意事项" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<ul>
<li>每当表创建一个B+树时，都会为这个索引创建一个根节点页面，随着表中插入数据，会先把数据插入根节点中，随着数据量增多，会复制数据到新的页中，并升级为目录页。此过程中根节点地址是不会变的，变的只是角色。</li>
<li>一个页面至少存储两条数据。</li>
</ul>
<h4 id="索引的查询">索引的查询<a href="#索引的查询" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 创建表时添加索引
</span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#a6e22e">demo</span>(
  id <span style="color:#66d9ef">INT</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">AUTO_INCREMENT</span>,
  name <span style="color:#66d9ef">VARCHAR</span>(<span style="color:#ae81ff">10</span>),
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>(id),
  <span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">INDEX</span> <span style="color:#a6e22e">idx_name</span>(name) <span style="color:#75715e"># 创建唯一索引
</span><span style="color:#75715e"></span>)
<span style="color:#75715e"># 修改表添加索引
</span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> demo <span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">INDEX</span> idx_name;
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> demo <span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">FULLTEXT</span> <span style="color:#66d9ef">INDEX</span> <span style="color:#a6e22e">f_name_idx</span>(name); 
</code></pre></div><hr>
<h3 id="索引适用条件">索引适用条件<a href="#索引适用条件" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<h4 id="全值匹配">全值匹配<a href="#全值匹配" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>搜索条件中的列和索引列一致的话，这种情况就称为全值匹配。即使我们不按照联合索引创建的列的顺序查询，也是会走联合索引的（查询优化器）。</p>
<h4 id="最左匹配">最左匹配<a href="#最左匹配" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>在全值匹配的基础上，查询可以不用包含全部的列，只需要包含一个或多个最左边的列就可以（最左匹配原则）。我们按照<code>a-b-c</code>的顺序创建了联合索引，那么<code>a、a-b、a-b-c、a-c（a生效）</code>查询方式都是可以走联合索引的。但<code>b-c</code>是不生效的。</p>
<blockquote>
<p>最左匹配原则遇到<code>范围查询</code>就会停止匹配。</p>
</blockquote>
<h4 id="前缀匹配">前缀匹配<a href="#前缀匹配" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>查询的字符串列的前缀都是排好序的，那么只匹配它的前缀也是可以快速定位记录。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> person_info <span style="color:#66d9ef">WHERE</span> name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;As%&#39;</span>; <span style="color:#960050;background-color:#1e0010">√</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> person_info <span style="color:#66d9ef">WHERE</span> name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%As%&#39;</span>; <span style="color:#960050;background-color:#1e0010">×</span>
</code></pre></div><blockquote>
<p>针对一些无法使用前缀匹配的字段，比如<code>xxx.com</code>的搜索，我们可以反转字符串然后基于<code>com%</code>进行前缀匹配。</p>
</blockquote>
<h4 id="范围匹配">范围匹配<a href="#范围匹配" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> person_info <span style="color:#66d9ef">WHERE</span> name <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;Asa&#39;</span> <span style="color:#66d9ef">AND</span> name <span style="color:#f92672">&lt;</span> <span style="color:#e6db74">&#39;Barlow&#39;</span>;
</code></pre></div><blockquote>
<p>基于联合索引（此处只用到了<code>name</code>）找到第一个大于<code>Asa</code>的数据返回主键，回表查询返回给客户端。然后沿着上一步记录所在的链表继续查找，下一条二级索引记录，并判断是否符合小于<code>Barlow</code>，符合就回表查询并返回数据，重复步骤直到条件不符合。</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> person_info <span style="color:#66d9ef">WHERE</span> name <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;Asa&#39;</span> <span style="color:#66d9ef">AND</span> name <span style="color:#f92672">&lt;</span> <span style="color:#e6db74">&#39;Barlow&#39;</span> <span style="color:#66d9ef">AND</span> birthday <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;1980-01-01&#39;</span>;
</code></pre></div><blockquote>
<p>基于上步的范围匹配流程得到的结果集，进行<code>birthday &gt; '1980-01-01'</code>再匹配（但不会走联合索引）。</p>
</blockquote>
<h4 id="精确匹配某一列与范围匹配另一列">精确匹配某一列与范围匹配另一列<a href="#精确匹配某一列与范围匹配另一列" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> person_info <span style="color:#66d9ef">WHERE</span> name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Ashburn&#39;</span> <span style="color:#66d9ef">AND</span> birthday <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;1980-01-01&#39;</span> <span style="color:#66d9ef">AND</span> birthday <span style="color:#f92672">&lt;</span> <span style="color:#e6db74">&#39;2000-12-31&#39;</span> <span style="color:#66d9ef">AND</span> phone_number <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;15100000000&#39;</span>; <span style="color:#960050;background-color:#1e0010">×</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> person_info <span style="color:#66d9ef">WHERE</span> name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Ashburn&#39;</span> <span style="color:#66d9ef">AND</span> birthday <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;1980-01-01&#39;</span> <span style="color:#66d9ef">AND</span> phone_number <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;15100000000&#39;</span>; <span style="color:#960050;background-color:#1e0010">√</span>
</code></pre></div><blockquote>
<p><code>name</code>等值匹配可以走联合索引，当<code>name相同时</code>都是按照<code>birthday</code>从小到大的进行排序，所以可以进行<code>birthday</code>的范围匹配，但<code>birthday</code>的范围匹配就无法保证<code>phone_number</code>从小到大排序，所以<code>phone_number</code>只能遍历结果进行筛选，无法走联合索引。</p>
</blockquote>
<h4 id="排序">排序<a href="#排序" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> person_info <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> name, birthday, phone_number <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">10</span>; <span style="color:#960050;background-color:#1e0010">√</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> person_info <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> name <span style="color:#66d9ef">asc</span>, birthday <span style="color:#66d9ef">desc</span>, phone_number <span style="color:#66d9ef">asc</span>; <span style="color:#960050;background-color:#1e0010">×</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> person_info <span style="color:#66d9ef">WHERE</span> name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;A&#39;</span> <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> birthday, phone_number <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">10</span>; <span style="color:#960050;background-color:#1e0010">√</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> person_info <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> name, country <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">10</span>; <span style="color:#960050;background-color:#1e0010">×</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> person_info <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#a6e22e">UPPER</span>(name) <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">10</span>; <span style="color:#960050;background-color:#1e0010">×</span>
</code></pre></div><blockquote>
<p>按照联合索引的顺序进行排序（默认联合索引的B+树就按照这个顺序创建）。</p>
<ol>
<li>如果联合索引中的每个列的查询顺序不一致，那么不能使用索引进行排序。</li>
<li>如果排序中列包含非同一个索引的列，那么不能使用索引进行排序。</li>
<li>排序列使用了复杂的表达式，如<code>UPPER()、REPLACE()</code>等。</li>
</ol>
</blockquote>
<h4 id="分组">分组<a href="#分组" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> name, birthday, phone_number, <span style="color:#a6e22e">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">FROM</span> person_info <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> name, birthday, phone_number; <span style="color:#960050;background-color:#1e0010">√</span>
</code></pre></div><blockquote>
<p><code>group by</code>按照联合索引的顺序，索引也是生效的。</p>
</blockquote>
<h3 id="如何使用索引">如何使用索引<a href="#如何使用索引" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<ul>
<li>
<p>只为用于搜索、排序、分组的列创建索引。</p>
</li>
<li>
<p>为基数大（这一列中不重复的数据，基数越大不重复的越多）的列创建索引。</p>
</li>
<li>
<p>索引列的类型尽量的小（减少磁盘占用和提升读写IO）。</p>
</li>
<li>
<p>索引字符串值的前缀，针对列的值特别长的情况（但是基于<code>此列的排序会走文件排序</code>：在内存或磁盘中排序）。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 添加字符串前缀索引，只索引前10个字符的编码
</span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> person_info <span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">INDEX</span> <span style="color:#a6e22e">idx_name</span>(<span style="color:#a6e22e">name</span>(<span style="color:#ae81ff">10</span>));
</code></pre></div><blockquote>
<p>通过前缀索引然后定位到相应前缀所在的位置，然后回表匹配完成的字符串。</p>
</blockquote>
</li>
<li>
<p>索引列在比较表达式中单独出现（age &gt; 2 √  age * 2 &gt; 10  ×）。</p>
</li>
<li>
<p>主键最好自增，避免因为主键值忽大忽小带来的页分裂问题（性能损失）。</p>
</li>
<li>
<p>避免创建冗余和重复索引。</p>
</li>
<li>
<p>尽量使用索引覆盖（查询索引中的字段）进行查询，避免由回表查询变为全文搜索。</p>
</li>
</ul>
<hr>
<h2 id="mysql的数据目录">MySQL的数据目录<a href="#mysql的数据目录" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="数据目录的组成">数据目录的组成<a href="#数据目录的组成" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 查看mysql的数据目录（不是安装目录，安装目录包含bin文件夹）
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SHOW</span> VARIABLES <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;datadir&#39;</span>;
</code></pre></div><blockquote>
<p>MySQL的数据目录下存在与<code>创建的数据库同名</code>的文件夹，文件夹内会存在<code>表名.frm</code>和<code>表名.ibd</code>两种类型的文件。</p>
<p>其中<code>表名.frm</code>是表结构的描述文件，<code>表名.ibd</code>存放的是表的数据（MySQL5.6.6以前的版本中所有的表记录都存放到名为ibdata1的文件中（系统表空间），之后的版本中每个表都对应着一个<code>表名.ibd</code>的文件（独立表空间）。</p>
<p>除此之外，数据目录下还存在MySQL服务进程文件、日志文件、SSL和RSA密钥文件等。</p>
</blockquote>
<h2 id="mysql系统数据库">MySQL系统数据库<a href="#mysql系统数据库" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<ul>
<li>
<p><code>mysql</code></p>
<p>它存储了MySQL的用户账户和权限信息，一些存储过程、事件的定义信息，一些运行过程中产生的日志信息，一些帮助信息以及时区信息等。</p>
</li>
<li>
<p><code>information_schema</code></p>
<p>这个数据库保存着MySQL服务器维护的所有其他数据库的信息，比如有哪些表、哪些视图、哪些触发器、哪些列、哪些索引。这些信息并不是真实的用户数据，而是一些描述性信息，有时候也称之为元数据。</p>
</li>
<li>
<p><code>performance_schema</code>：</p>
<p>这个数据库里主要保存MySQL服务器运行过程中的一些状态信息，算是对MySQL服务器的一个性能监控。包括统计最近执行了哪些语句，在执行过程的每个阶段都花费了多长时间，内存的使用情况等等信息。</p>
</li>
<li>
<p><code>sys</code></p>
<p>这个数据库主要是通过视图的形式把<code>information_schema</code>和<code>performance_schema</code>结合起来，让程序员可以更方便的了解MySQL服务器的一些性能信息。</p>
</li>
</ul>
<hr>
<h2 id="mysql的单表访问方法">MySQL的单表访问方法<a href="#mysql的单表访问方法" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>MySQL执行查询语句的方式称为<code>访问方法</code>。对于单表来说，MySQL的单表查询方式被分为<code>全表扫描查询</code>和<code>索引查询</code>。</p>
<h3 id="单表访问方法">单表访问方法<a href="#单表访问方法" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p><img src="https://image.leejay.top/FqwMONwuoy55A6NFM1ghvcBD090-" alt=""></p>
<h3 id="单表访问的注意事项">单表访问的注意事项<a href="#单表访问的注意事项" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<h4 id="单个二级索引">单个二级索引<a href="#单个二级索引" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><code>一般情况</code>下只能利用<code>单个二级索引</code>执行查询。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> single_table <span style="color:#66d9ef">WHERE</span> key1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;abc&#39;</span> <span style="color:#66d9ef">AND</span> key2 <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1000</span>;
</code></pre></div><blockquote>
<p>MySQL查询优化器会判断使用哪个二级索引查询扫描的行数更少，选择较少的那个二级索引查询主键，回表查询后将得到的结果再根据其他的条件进行过滤。</p>
</blockquote>
<h4 id="索引合并">索引合并<a href="#索引合并" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>一般情况下执行一个查询时最多只会用到单个二级索引，但使用到多个索引来完成一次查询的执行方法称之为：<code>index merge（索引合并）</code>。</p>
<ul>
<li>Intersection合并</li>
</ul>
<p>某个查询可以使用多个二级索引，将二级索引查询的结果取<code>交集</code>，再回表查询。必须符合如下情况才可能会使用到Intersection合并：</p>
<ol>
<li>二级索引列都是等值匹配的情况，对于联合索引来说，在联合索引中的<code>每个列都必须等值匹配</code>，不能出现只匹配部分列的情况。</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> single_table <span style="color:#66d9ef">WHERE</span> key1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#66d9ef">AND</span> key3 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;b&#39;</span>;
</code></pre></div><ol start="2">
<li>主键列可以是范围匹配。因为二级索引的列相同时会按照主键的顺序进行排序，有序的主键有助于提升取交集速度。</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 可能会用到聚簇索引和二级索引合并，因为key1作为二级索引叶子节点中是包含主键的，可以直接二级索引查询后再
</span><span style="color:#75715e"># 进行主键匹配，然后回表。这里主键的搜索条件只是从别的二级索引得到的结果集中过滤记录。是不是等值不重要
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> single_table <span style="color:#66d9ef">WHERE</span> id <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">100</span> <span style="color:#66d9ef">AND</span> key1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>; 
</code></pre></div><blockquote>
<p>按照有序的主键回表取记录有个专有名词叫：Rowid Ordered Retrieval，简称ROR。</p>
</blockquote>
<p>上述的条件一二是发生Intersection合并的必要条件，但不是充分条件，也就是说即使情况一、情况二成立，也不一定发生<code>Intersection</code>索引合并，这得看优化器的心情。优化器只有在单独根据搜索条件从某个二级索引中获取的记录数太多，导致回表开销太大，而通过<code>Intersection</code>索引合并后需要回表的记录数大大减少时才会使用<code>Intersection</code>索引合并。</p>
<p>如果多个列不需要单独使用的话还是<code>推荐使用联合索引替代索引合并</code>，少读一颗B+树的同时也不同合并结果。</p>
<ul>
<li>Union合并</li>
</ul>
<p>某个查询可以使用多个二级索引，将二级索引查询的结果取<code>并集</code>，再回表查询。必须符合如下情况才可能会使用到Union合并：</p>
<ol>
<li>二级索引列都是等值匹配的情况，对于联合索引来说，在联合索引中的<code>每个列都必须等值匹配</code>，不能出现只匹配部分列的情况。</li>
<li>主键列可以是范围匹配</li>
<li>使用<code>Intersection</code>索引合并的搜索条件</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> single_table <span style="color:#66d9ef">WHERE</span> key_part1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#66d9ef">AND</span> key_part2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;b&#39;</span> <span style="color:#66d9ef">AND</span> key_part3 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;c&#39;</span> <span style="color:#66d9ef">OR</span> (key1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#66d9ef">AND</span> key3 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;b&#39;</span>);
</code></pre></div><blockquote>
<ol>
<li>先按照<code>key1 = 'a' AND key3 = 'b'</code>使用<code>Intersection索引合并</code>的方式得到一个主键集合。</li>
<li>再通过ref的访问方法获取<code>key_part1 = 'a' AND key_part2 = 'b' AND key_part3 = 'c'</code>的主键集合。</li>
<li>采用<code>Union</code>索引合并的方式把上述两个主键集合取并集，然后进行回表操作返回数据。</li>
</ol>
</blockquote>
<ul>
<li>Sort-Union合并</li>
</ul>
<p>按照二级索引记录的主键值进行排序，之后按照<code>Union</code>索引合并方式执行的方式称之为<code>Sort-Union</code>索引合并。比单纯的<code>Union</code>索引合并多了一步对二级索引记录的主键值排序的过程。</p>
<blockquote>
<p>Intersection合并适合的是从二级索引中获取的记录数太多，导致回表开销太大而出现的，如果存在Sort-Intersection合并，那么对大量数据进行排序是非常耗时的，所以不存在Sort-Intersection合并。</p>
</blockquote>
<hr>
<h2 id="mysql多表查询">Mysql多表查询<a href="#mysql多表查询" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="连接的过程">连接的过程<a href="#连接的过程" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<ol>
<li>首选确定第一个需要查询的表，这个表被称为<code>驱动表</code>（基于单表查询代价最小的表）。根据条件过滤驱动表数据。驱动表只会被查询一次。</li>
<li>根据驱动表查询的每一条记录依次去<code>被驱动表</code>中寻找匹配的记录。驱动表有多少条符合条件的数据，被驱动表就会被访问几次。</li>
</ol>
<h3 id="连接的类型">连接的类型<a href="#连接的类型" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p><img src="https://image.leejay.top/Fi6x8i1-tA_70KPt3y3JTYAVBwJ8" alt=""></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 内连接
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> A.<span style="color:#f92672">*</span>, B.<span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> A,B <span style="color:#66d9ef">WHERE</span> A.id <span style="color:#f92672">=</span> B.id;
<span style="color:#75715e"># 左外连接
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> A.<span style="color:#f92672">*</span>, B.<span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> A <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> B <span style="color:#66d9ef">ON</span> A.id <span style="color:#f92672">=</span> B.id <span style="color:#66d9ef">WHERE</span> A.age <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10</span>;
<span style="color:#75715e"># 右外连接
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> A.<span style="color:#f92672">*</span>, B.<span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> A <span style="color:#66d9ef">RIGHT</span> <span style="color:#66d9ef">JOIN</span> B <span style="color:#66d9ef">ON</span> A.id <span style="color:#f92672">=</span> B.id <span style="color:#66d9ef">WHERE</span> A.age <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10</span>;
</code></pre></div><blockquote>
<p>如果是超过两张表的连接，那么先连接两张表，再将两张表的结果作为新的驱动表执行连接操作。</p>
</blockquote>
<h3 id="连接的原理">连接的原理<a href="#连接的原理" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<h4 id="循环嵌套连接">循环嵌套连接<a href="#循环嵌套连接" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>驱动表只访问一次，但被驱动表却可能被多次访问，访问次数取决于<code>对驱动表执行单表查询后的结果集中的记录条数</code>的连接执行方式称之为<code>嵌套循环连接</code>（<code>Nested-Loop Join</code>）</p>
<ul>
<li>步骤1：选取驱动表，使用与驱动表相关的过滤条件，选取代价最低的单表访问方法来执行对驱动表的单表查询。</li>
<li>步骤2：对上一步骤中查询驱动表得到的结果集中每一条记录，都分别到被驱动表中查找匹配的记录。</li>
</ul>
<blockquote>
<p>我们可以通过给被驱动表添加<code>索引</code>来实现快速连接，因为被驱动表可能会访问多次。</p>
</blockquote>
<h4 id="基于块的连接">基于块的连接<a href="#基于块的连接" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>循环嵌套连接中，每次匹配都是<code>驱动表</code>拿出一条记录，然后从<code>被驱动表中取出记录加载到内存中</code>，然后被驱动表的记录和这一条驱动表记录进行比对，然后从内存中清除被驱动表记录。再拿出驱动表的另一条记录，再将被驱动表的记录加载到内存中进行比对，所以有多少条驱动表记录，那么被驱动表就会被加载到内存中多少次。</p>
<p>块连接是基于<code>join buffer</code>的嵌套连接算法。</p>
<blockquote>
<p><code>join buffer</code>是在执行连接查询前申请的<code>一块固定大小的内存</code>，先把若干条驱动表结果集中的记录装在这个<code>join buffer</code>中，然后开始扫描被驱动表，每一条被驱动表的记录一次性和<code>join buffer</code>中的多条驱动表记录做匹配。</p>
</blockquote>
<p>假设A表和B表进行基于块的连接查询，那么A表会根据A的条件进行单表查询（不包含关联条件），将结果放入<code>join buffer</code>，再执行B表的条件查询（不包含关联条件），将结果放入<code>join buffer</code>中，在内存中进行匹配，执行一批后再进行下一批，如此往复。</p>
<p><code>join buffer</code>通过参数<code>join_buffer_size</code>设置，默认<code>262144字节（256k）</code>。需要注意的是<code>驱动表的记录并不是所有列</code>都会被放到<code>join buffer</code>中，只有<code>查询列表中的列和过滤条件中的列</code>才会被放到<code>join buffer</code>中，所以连接查询中我们不要用<code>*</code>作为查询列，这样可以将更多的表记录放到<code>join buffer</code>中。</p>
<hr>
<h2 id="mysql基于成本的优化">Mysql基于成本的优化<a href="#mysql基于成本的优化" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="成本的定义">成本的定义<a href="#成本的定义" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<ul>
<li>I/O成本：数据从磁盘加载到内存中,基于InnoDB存储引擎，页是交互的基本单位，成本常数为1.0。</li>
<li>CPU成本：读取以及检测记录是否满足对应的搜索条件，对结果集进行排序.成本常数为0.2。</li>
</ul>
<h3 id="单表查询的成本">单表查询的成本<a href="#单表查询的成本" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<h4 id="基于成本的优化步骤">基于成本的优化步骤<a href="#基于成本的优化步骤" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><img src="https://image.leejay.top/FjnYzl9paMRg3ikoAe8c1KitfQgO" alt=""></p>
<h4 id="基于索引统计数据的成本计算">基于索引统计数据的成本计算<a href="#基于索引统计数据的成本计算" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><img src="https://image.leejay.top/Fr9WBjq_vmiWXxIa7y5xoXqSEQay" alt=""></p>
<h3 id="多表连接的成本">多表连接的成本<a href="#多表连接的成本" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p><img src="https://image.leejay.top/FoM8ItkUI26AxAhNrgCF0GKj7bYh" alt=""></p>
<blockquote>
<p>多表连接的成本计算<code>依托于单表查询的成本计算</code>，且<code>多表连接的顺序不同导致不同的成本（n!种顺序，n&gt;1）</code>。</p>
</blockquote>
<hr>
<h2 id="mysql基于规则的优化">Mysql基于规则的优化<a href="#mysql基于规则的优化" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="条件化简">条件化简<a href="#条件化简" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p><img src="https://image.leejay.top/FrMLiZwyvlTu1ehOMCowMU7H5cOE" alt=""></p>
<h3 id="外连接消除">外连接消除<a href="#外连接消除" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>外连查询中的被驱动表的 IS NOT NULL等同于两表内联查询。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> S1.<span style="color:#f92672">*</span>, S2.<span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> S1 <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> S2 <span style="color:#66d9ef">ON</span> S1.id <span style="color:#f92672">=</span> S2.id <span style="color:#66d9ef">WHERE</span> S2 <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>;
<span style="color:#960050;background-color:#1e0010">转换为</span>
<span style="color:#66d9ef">SELECT</span> S1.<span style="color:#f92672">*</span>, S2.<span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> S1,S2 <span style="color:#66d9ef">WHERE</span> S1.id <span style="color:#f92672">=</span> S2.id
</code></pre></div><h3 id="子查询优化">子查询优化<a href="#子查询优化" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p><img src="https://image.leejay.top/Fqla9zqISkoC9etH3NDWb0KAZMdP" alt=""></p>
<hr>
<h2 id="explain">Explain<a href="#explain" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>一条查询语句在经过MySQL查询优化器<code>基于成本和规则的优化</code>后会生成<code>执行计划</code>。执行计划可以展示具体的执行查询方式。而<code>EXPLAIN</code>可以帮助我们查询具体查询的执行计划。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 不限于SELECT,DELETE,UPDATE,REPLACE都可以
</span><span style="color:#75715e"></span><span style="color:#66d9ef">EXPLAIN</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> T1 <span style="color:#66d9ef">WHERE</span> id <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</code></pre></div><h3 id="explain名词解释">Explain名词解释<a href="#explain名词解释" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<h4 id="id">id<a href="#id" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>在一个查询语句中每个<code>SELECT</code>关键字都对应一个唯一的<code>id</code>。</p>
<ol>
<li>即使存在多个SELECT也可能被优化成一个。</li>
<li>关联查询Explain排在前面的记录就是驱动表，后面的是被驱动表。</li>
<li>id为null的时候说明创建了临时表用于存放数据。</li>
</ol>
<h4 id="select_type">select_type<a href="#select_type" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<table>
<thead>
<tr>
<th style="text-align:left">类型</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>SIMPLE</strong></td>
<td style="text-align:left">查询语句中不包含<code>UNION</code>或者子查询的查询</td>
</tr>
<tr>
<td style="text-align:left"><strong>PRIMARY</strong></td>
<td style="text-align:left">对于包含<code>UNION</code>、<code>UNION ALL</code>或者子查询的大查询来说，它是由几个小查询组成的，其中最左边的那个查询的<code>select_type</code>值就是<code>PRIMARY</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>UNION</strong></td>
<td style="text-align:left">对于包含<code>UNION</code>、<code>UNION ALL</code>或者子查询的大查询来说，它是由几个小查询组成的，除了最左边的查询，其余的查询<code>select_type</code>值就是<code>UNION</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>UNION RESULT</strong></td>
<td style="text-align:left">MySQL<code>选择使用临时表来完成</code>UNION<code>查询的去重工作，针对该临时表的查询的</code>select_type<code>就是</code>UNION RESULT</td>
</tr>
<tr>
<td style="text-align:left"><strong>SUBQUERY</strong></td>
<td style="text-align:left">如果包含子查询的查询语句不能够转为对应的<code>semi-join</code>的形式，并且该子查询是不相关子查询，并且查询优化器决定采用将该子查询物化的方案来执行该子查询时，该子查询的第一个<code>SELECT</code>关键字代表的那个查询的<code>select_type</code>就是<code>SUBQUERY</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>DEPENDENT SUBQUERY</strong></td>
<td style="text-align:left">如果包含子查询的查询语句不能够转为对应的<code>semi-join</code>的形式，并且该子查询是相关子查询，则该子查询的第一个<code>SELECT</code>关键字代表的那个查询的<code>select_type</code>就是<code>DEPENDENT SUBQUERY</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>DEPENDENT UNION</strong></td>
<td style="text-align:left">在包含<code>UNION</code>或者<code>UNION ALL</code>的大查询中，如果各个小查询都依赖于外层查询的话，那除了最左边的那个小查询之外，其余的小查询的<code>select_type</code>的值就是<code>DEPENDENT UNION</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>DERIVED</strong></td>
<td style="text-align:left">对于采用物化的方式执行的包含派生表的查询，该派生表对应的子查询的<code>select_type</code>就是<code>DERIVED</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>MATERIALIZED</strong></td>
<td style="text-align:left">当查询优化器在执行包含子查询的语句时，选择将子查询物化之后与外层查询进行连接查询时，该子查询对应的<code>select_type</code>属性就是<code>MATERIALIZED</code></td>
</tr>
</tbody>
</table>
<h4 id="type">type<a href="#type" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>对应着单表的访问方式，<a href="###单表访问方法">上文的单表访问方法</a>中介绍了一部分，但仍包含部分没有介绍。</p>
<table>
<thead>
<tr>
<th style="text-align:center">访问方法</th>
<th style="text-align:center">释义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>system</strong></td>
<td style="text-align:center">当表中只有一条记录并且该表使用的存储引擎的统计数据是精确的（MyISAM）</td>
</tr>
<tr>
<td style="text-align:center"><strong>const</strong></td>
<td style="text-align:center">根据主键或者唯一二级索引列与常数进行等值匹配</td>
</tr>
<tr>
<td style="text-align:center"><strong>eq_ref</strong></td>
<td style="text-align:center">被驱动表是通过主键或者唯一二级索引列等值匹配（联合索引全部等值匹配）的方式进行访问</td>
</tr>
<tr>
<td style="text-align:center"><strong>ref</strong></td>
<td style="text-align:center">普通的二级索引列与常量进行等值匹配</td>
</tr>
<tr>
<td style="text-align:center"><strong>ref_or_null</strong></td>
<td style="text-align:center">当对普通二级索引进行等值匹配查询，且同时查询null值</td>
</tr>
<tr>
<td style="text-align:center"><strong>index_merge</strong></td>
<td style="text-align:center">使用<a href="####索引合并">索引合并</a>来执行查询，只有此类型可以使用多个索引</td>
</tr>
<tr>
<td style="text-align:center"><strong>range</strong></td>
<td style="text-align:center">聚簇索引或二级索引的范围查询</td>
</tr>
<tr>
<td style="text-align:center"><strong>index</strong></td>
<td style="text-align:center">当需要扫描全表的时候，查询的列正好包含在索引中（索引覆盖）</td>
</tr>
<tr>
<td style="text-align:center"><strong>ALL</strong></td>
<td style="text-align:center">全表扫描</td>
</tr>
<tr>
<td style="text-align:center"><strong>unique_subquery</strong></td>
<td style="text-align:center">类似于<code>eq_ref</code>，针对查询优化器将IN子查询转换为EXISTS，且子查询可使用主键进行等值匹配</td>
</tr>
<tr>
<td style="text-align:center"><strong>index_subquery</strong></td>
<td style="text-align:center">与<code>unique_subquery</code>类似，不过是子查询时使用的是普通索引</td>
</tr>
</tbody>
</table>
<h4 id="possible_keys和key">possible_keys和key<a href="#possible_keys和key" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><code>possible_keys</code>列表示在某个查询语句中，对某个表执行单表查询时可能用到的索引有哪些，<code>key</code>列表示实际用到的索引有哪些。</p>
<blockquote>
<ol>
<li>使用<code>index</code>访问方法来查询某个表时，<code>possible_keys</code>列是空的，而<code>key</code>列展示的是实际使用到的索引。</li>
<li><code>possible_keys</code>列中的值并不是越多越好，可能使用的索引越多，查询优化器计算查询成本会花费更长时间。</li>
</ol>
</blockquote>
<h4 id="key_len">key_len<a href="#key_len" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><code>key_len</code>列表示当优化器决定使用某个索引执行查询时，该索引记录的最大长度，它是由这三个部分构成的：</p>
<ul>
<li>对于使用固定长度类型的索引列来说，它实际占用的存储空间的最大长度就是该固定值</li>
<li>如果该索引列可以存储<code>NULL</code>值，则<code>key_len</code>比不可以存储<code>NULL</code>值时多1个字节。</li>
<li>对于变长字段来说，都会有2个字节的空间来存储该变长列的实际长度。</li>
</ul>
<blockquote>
<p>通过<code>key_len</code>我们可以区分某个使用联合索引的查询具体用了几个索引列。</p>
</blockquote>
<h4 id="ref">ref<a href="#ref" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>当使用索引列等值匹配的条件去执行查询时，<code>ref</code>列展示的就是与索引列作等值匹配的对象，可能是一个常数，一个列或者一个函数。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">WHERE</span> a.id <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>; <span style="color:#75715e"># const
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> TABLE_A A, TABLE_B B <span style="color:#66d9ef">WHERE</span> A.id <span style="color:#f92672">=</span> B.id; <span style="color:#75715e"># TABLE_B.id
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> TABLE_A A, TABLE_B B <span style="color:#66d9ef">WHERE</span> A.id <span style="color:#f92672">=</span> <span style="color:#a6e22e">UPPER</span>(B.id); <span style="color:#75715e"># func
</span></code></pre></div><h4 id="rows">rows<a href="#rows" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>如果查询优化器决定使用全表扫描的方式对某个表执行查询时，执行计划的<code>rows</code>列就代表预计需要扫描的行数，如果使用索引来执行查询时，执行计划的<code>rows</code>列就代表预计扫描的索引记录行数。</p>
<h4 id="filtered">filtered<a href="#filtered" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><code>MySQL</code>在计算驱动表扇出时采用的一个策略：</p>
<ul>
<li>如果使用的是全表扫描的方式执行的单表查询，那么计算驱动表扇出时需要估计出满足搜索条件的记录有多少条。</li>
<li>如果使用的是索引执行的单表扫描，那么计算驱动表扇出的时候需要估计出满足除使用到对应索引的搜索条件外的其他搜索条件的记录有多少条。</li>
</ul>
<blockquote>
<p>rows x filerted 的值在全表扫描下就是<code>满足搜索条件的记录数</code>，在索引执行的单表扫描下就是<code>满足使用到的索引条件外的其他索引条件的记录数</code>。</p>
<p>在多表关联查询中，多用于计算驱动表的扇出值。</p>
</blockquote>
<h4 id="extra">Extra<a href="#extra" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><code>Extra</code>列是用来说明一些额外信息的</p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>值</strong></th>
<th style="text-align:left"><strong>释义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>No tables used</strong></td>
<td style="text-align:left">查询语句的没有<code>FROM</code>子句时</td>
</tr>
<tr>
<td style="text-align:left"><strong>Impossible WHERE</strong></td>
<td style="text-align:left">查询语句的<code>WHERE</code>子句永远为<code>FALSE</code>时</td>
</tr>
<tr>
<td style="text-align:left"><strong>No matching min/max row</strong></td>
<td style="text-align:left">当查询列表处有<code>MIN</code>或者<code>MAX</code>聚集函数，但是并没有符合<code>WHERE</code>子句中的搜索条件的记录时</td>
</tr>
<tr>
<td style="text-align:left"><strong>Using index</strong></td>
<td style="text-align:left">查询列表以及搜索条件中只包含属于某个索引的列（索引覆盖）</td>
</tr>
<tr>
<td style="text-align:left"><strong>Using index condition</strong></td>
<td style="text-align:left">有些搜索条件中虽然出现了索引列，但却不能使用到索引</td>
</tr>
<tr>
<td style="text-align:left"><strong>Using where</strong></td>
<td style="text-align:left">1. 使用全表扫描来执行对某个表的查询，并且语句的<code>WHERE</code>子句中有针对该表的搜索条件2. 使用索引访问来执行对某个表的查询，并且该语句的<code>WHERE</code>子句中有除了该索引包含的列之外的其他搜索条件时</td>
</tr>
<tr>
<td style="text-align:left"><strong>Using join buffer</strong></td>
<td style="text-align:left">当被驱动表不能有效的利用索引加快访问速度，会基于<code>块连接</code>来加快连接速度</td>
</tr>
<tr>
<td style="text-align:left"><strong>Not exists</strong></td>
<td style="text-align:left">如果<code>WHERE</code>子句中包含要求被驱动表的某个列等于<code>NULL</code>值的搜索条件，而且那个列又是不允许存储<code>NULL</code>值</td>
</tr>
<tr>
<td style="text-align:left"><strong>Using intersect/union/sort_union</strong></td>
<td style="text-align:left">准备使用索引合并的方式执行查询（会标出使用索引合并的索引有哪些）</td>
</tr>
<tr>
<td style="text-align:left"><strong>Zero limit</strong></td>
<td style="text-align:left">使用limit 0 时会提示该信息</td>
</tr>
<tr>
<td style="text-align:left"><strong>Using filesort</strong></td>
<td style="text-align:left">使用<code>文件排序</code>对结果进行排序（数据少时内存排序 ，多时磁盘排序），当能够使用<code>索引排序</code>的时候就不会使用文件排序</td>
</tr>
<tr>
<td style="text-align:left"><strong>Using temporary</strong></td>
<td style="text-align:left">借助临时表来完成一些功能（去重、排序 等）</td>
</tr>
</tbody>
</table>
<h4 id="json格式查看成本">Json格式查看成本<a href="#json格式查看成本" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">EXPLAIN</span> FORMAT<span style="color:#f92672">=</span>JSON <span style="color:#66d9ef">SELECT</span> common_field <span style="color:#66d9ef">FROM</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> common_field;
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;query_block&#34;</span>: {
    <span style="color:#f92672">&#34;select_id&#34;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">查询id（一个select一个id）</span>
    <span style="color:#f92672">&#34;cost_info&#34;</span>: { <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">成本</span>
      <span style="color:#f92672">&#34;query_cost&#34;</span>: <span style="color:#e6db74">&#34;0.35&#34;</span>
    },
    <span style="color:#f92672">&#34;grouping_operation&#34;</span>: { <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">group</span> <span style="color:#960050;background-color:#1e0010">by操作</span>
      <span style="color:#f92672">&#34;using_temporary_table&#34;</span>: <span style="color:#66d9ef">true</span>, <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">是否使用了临时表</span>
      <span style="color:#f92672">&#34;using_filesort&#34;</span>: <span style="color:#66d9ef">false</span>, <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">是否使用了文件排序</span>
      <span style="color:#f92672">&#34;table&#34;</span>: {
        <span style="color:#f92672">&#34;table_name&#34;</span>: <span style="color:#e6db74">&#34;single_table&#34;</span>, <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">查询的表名</span>
        <span style="color:#f92672">&#34;access_type&#34;</span>: <span style="color:#e6db74">&#34;ALL&#34;</span>, <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">查询类型</span>
        <span style="color:#f92672">&#34;rows_examined_per_scan&#34;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">查询表一次大概查询多少数据</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#960050;background-color:#1e0010">rows</span>
        <span style="color:#f92672">&#34;rows_produced_per_join&#34;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">扇出的数据量</span>
        <span style="color:#f92672">&#34;filtered&#34;</span>: <span style="color:#e6db74">&#34;100.00&#34;</span>, <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">filtered</span>
        <span style="color:#f92672">&#34;cost_info&#34;</span>: { <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">成本</span>
          <span style="color:#f92672">&#34;read_cost&#34;</span>: <span style="color:#e6db74">&#34;0.25&#34;</span>, <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">IO成本</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#960050;background-color:#1e0010">rows*(1-filtered)成本</span>
          <span style="color:#f92672">&#34;eval_cost&#34;</span>: <span style="color:#e6db74">&#34;0.10&#34;</span>, <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">rows</span> <span style="color:#960050;background-color:#1e0010">×</span> <span style="color:#960050;background-color:#1e0010">filter的成本</span>
          <span style="color:#f92672">&#34;prefix_cost&#34;</span>: <span style="color:#e6db74">&#34;0.35&#34;</span>, <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">单独查询表的成本（read_cost+eval_cost）</span>
          <span style="color:#f92672">&#34;data_read_per_join&#34;</span>: <span style="color:#e6db74">&#34;1K&#34;</span> <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">此次查询中需要读取的数据量</span>
        },
        <span style="color:#f92672">&#34;used_columns&#34;</span>: [ <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">使用到的列</span> 
          <span style="color:#e6db74">&#34;id&#34;</span>,
          <span style="color:#e6db74">&#34;common_field&#34;</span>
        ]
      }
    }
  }
}
</code></pre></div><h4 id="extended-explain">Extended EXPLAIN<a href="#extended-explain" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SHOW</span> WARNINGS;
</code></pre></div><blockquote>
<p>在执行了EXPLAIN后执行该命令，会出现<code>Code</code>和<code>Message</code>，当<code>Code = 1003</code>时，<code>Message</code>展示的是优化器重写后的查询语句（不能直接作为查询语句）。</p>
</blockquote>
<hr>

      </div></div>

  
  
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">其他文章</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="https://leejay.top/post/gitcommand/">
                <span class="button__icon">←</span>
                <span class="button__text">Git Command</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="https://leejay.top/post/%E5%85%B3%E4%BA%8Eenableaspectjautoproxy%E6%B3%A8%E8%A7%A3%E5%BC%95%E5%87%BA%E7%9A%84%E8%8B%A5%E5%B9%B2%E9%97%AE%E9%A2%98/">
                <span class="button__text">关于EnableAspectJAutoProxy注解引出的若干问题</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>苏ICP备18050258号</span>
    
        
      </div>
  </div>
</footer>

<script src="https://leejay.top/assets/main.js"></script>
<script src="https://leejay.top/assets/prism.js"></script>







  
</div>

</body>
</html>
