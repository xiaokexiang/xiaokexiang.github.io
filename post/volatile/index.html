<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>volatile</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="ä½œç”¨ volatileä¿è¯äº†å†…å­˜çš„å¯è§æ€§ï¼Œå¯¹äºå…±äº«å˜é‡æ“ä½œä¼šç›´æ¥ä»å…±äº«å†…å­˜ä¸­è¯»å–ï¼Œä¿®æ”¹æ—¶ä¼šç›´æ¥å°†ç»“æœåˆ·å…¥å…±äº«å†…å­˜ï¼Œå…¶æ¬¡ç¦æ­¢äº†volatileä¿®é¥°çš„å˜é‡å’Œévolatileå˜é‡ä¹‹é—´çš„é‡æ’åºã€‚
åŸç† ä¸ºäº†ç¦æ­¢ç¼–è¯‘å™¨é‡æ’åºå’ŒCPUé‡æ’åºï¼Œåº•å±‚åŸç†æ˜¯é€šè¿‡å†…å­˜å±éšœæŒ‡ä»¤æ¥å®ç°çš„ã€‚
ç¼–è¯‘å™¨å†…å­˜å±éšœ åªæ˜¯ä¸ºäº†å‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œä½†ç¼–è¯‘å®Œæˆåï¼Œè¿™ç§å†…å­˜å±éšœå°±æ¶ˆå¤±äº†ï¼ŒCPUä¸ä¼šæ„ŸçŸ¥åˆ°ç¼–è¯‘å™¨ä¸­å†…å­˜å±éšœçš„å­˜åœ¨ã€‚
CPUå†…å­˜å±éšœ ç”±CPUæä¾›çš„æŒ‡ä»¤(ä¸åŒçš„CPUæ¶æ„ï¼Œæä¾›çš„æŒ‡ä»¤ä¸åŒ)ï¼Œå¯ä»¥ç”±å¼€å‘è€…æ˜¾ç¤ºè°ƒç”¨ï¼Œvolatileå°±æ˜¯é€šè¿‡CPUå†…å­˜å±éšœæŒ‡ä»¤æ¥å®ç°çš„ã€‚
å®ç°æµç¨‹ï¼š
 åœ¨volatileå†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ªStoreStoreå±éšœã€‚ä¿è¯volatileå†™æ“ä½œä¸ä¼šå’Œä¹‹å‰çš„å†™æ“ä½œé‡æ’åºã€‚ åœ¨volatileå†™æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ªStoreLoadå±éšœã€‚ä¿è¯volatileå†™æ“ä½œä¸ä¼šå’Œä¹‹åè¯»æ“ä½œé‡æ’åºã€‚ åœ¨volatileè¯»æ“ä½œåé¢æ’å…¥ä¸€ä¸ªLoadLoadå±éšœ &#43; LoadStoreå±éšœã€‚ä¿è¯volatileè¯»æ“ä½œä¸ä¼šå’Œä¹‹å‰çš„è¯»æ“ä½œã€å†™æ“ä½œé‡æ’åºã€‚  ä¸synchronizedå…³é”®å­—çš„å¼‚åŒ å¤šçº¿ç¨‹ä¼šäº§ç”Ÿä¸‰å¤§é—®é¢˜ï¼šåŸå­æ€§ã€æœ‰åºæ€§å’Œå¯è§æ€§ã€‚
synchronizedå’Œvolatileåœ¨å…±äº«å˜é‡çš„æ“ä½œä¸Šå…·æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰(ä»ä¸»å†…å­˜è¯»å–ï¼Œç«‹å³å†™å…¥ä¸»å†…å­˜)ï¼Œä¿è¯äº†å˜é‡çš„å¯è§æ€§ã€‚ä½†æ˜¯synchronizedç›¸æ¯”volatileè¿˜å…·æœ‰åŸå­æ€§(é˜»å¡å’Œæ’ä»–æ€§ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œè€Œvolatileæ˜¯éé˜»å¡çš„)ï¼Œæ‰€ä»¥volatileæ˜¯å¼±åŒ–ç‰ˆçš„synchronizedã€‚
class Test { // è¿™é‡Œçš„flagå°±å¯ä»¥ä¸ç”¨é”åŒæ­¥  private static volatile boolean flag = true; // æ¨¡æ‹ŸAtomicInteger  private static CasUnsafe UNSAFE = new CasUnsafe(0); // æŒ‰ç…§é¡ºåºæ‰“å°1-100çš„å¥‡å¶æ•°  public static void main(String[] args) { THREAD_POOL.execute(() -&amp;gt; { while (UNSAFE.getValue() &amp;lt; 100) { if (flag) { System.out.println(UNSAFE.incrementAndGet()); flag = false; } } }); THREAD_POOL.execute(() -&amp;gt; { while (UNSAFE."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<meta name="google-site-verification" content="e1ELBPEvOV5kwQNtzaLcNt-3iZy83eiNhSZkHhQPecs" />
<meta name="baidu-site-verification" content="aNoX6MUEHW" />
<link rel="canonical" href="https://www.leejay.top/post/volatile/" />

<script type="text/javascript"
        async
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
        >
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] },
    'HTML-CSS': {
        showMathMenu: false 
    }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
.MathJax {
  font-family: 'Fira Code'!important;
  font-weight: bold!important;
  line-height: 2!important;
}
</style>




<link rel="stylesheet" href="https://www.leejay.top/assets/style.css">




<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.leejay.top/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="https://www.leejay.top/img/favicon.png">



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="volatile"/>
<meta name="twitter:description" content="Javaä¸­volatileå…³é”®å­—çš„åŸç†ä¸ä½œç”¨ã€‚"/>



<meta property="og:title" content="volatile" />
<meta property="og:description" content="Javaä¸­volatileå…³é”®å­—çš„åŸç†ä¸ä½œç”¨ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.leejay.top/post/volatile/" />
<meta property="article:published_time" content="2020-06-08T11:13:38+08:00" />
<meta property="article:modified_time" content="2020-06-08T11:13:38+08:00" /><meta property="og:site_name" content="Aurora" />






  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="https://www.leejay.top" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="https://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg></span>
    <span class="logo__text">Aurora</span>
    <span class="logo__cursor"></span>
    <span class="logo__cursor2"></span>
  
</a>
    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/categories">Categories</a></li>
        
      
        
          <li><a href="/tags">Tags</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/categories">Categories</a></li>
      
    
      
        <li><a href="/tags">Tags</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="https://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title"><a href="https://www.leejay.top/post/volatile/">volatile</a></h1>
    <div class="post-meta">
      
        <span class="post-date">
          2020-06-08
        </span>

        
          
        
      

      
      
    </div>

    
      <span class="post-tags">
        
        ğŸ–<a href="https://www.leejay.top/tags/volatile/">volatile </a>&nbsp;
        
        ğŸ–<a href="https://www.leejay.top/tags/%E5%86%85%E5%AD%98%E5%8F%AF%E8%A7%81%E6%80%A7/">å†…å­˜å¯è§æ€§</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      
      <h3 id="ä½œç”¨">ä½œç”¨</h3>
<p>volatileä¿è¯äº†å†…å­˜çš„å¯è§æ€§ï¼Œå¯¹äºå…±äº«å˜é‡æ“ä½œä¼šç›´æ¥ä»å…±äº«å†…å­˜ä¸­è¯»å–ï¼Œä¿®æ”¹æ—¶ä¼šç›´æ¥å°†ç»“æœåˆ·å…¥å…±äº«å†…å­˜ï¼Œå…¶æ¬¡<code>ç¦æ­¢äº†volatileä¿®é¥°çš„å˜é‡å’Œévolatileå˜é‡ä¹‹é—´çš„é‡æ’åº</code>ã€‚</p>
<h3 id="åŸç†">åŸç†</h3>
<p>ä¸ºäº†ç¦æ­¢ç¼–è¯‘å™¨é‡æ’åºå’ŒCPUé‡æ’åºï¼Œåº•å±‚åŸç†æ˜¯é€šè¿‡<code>å†…å­˜å±éšœ</code>æŒ‡ä»¤æ¥å®ç°çš„ã€‚</p>
<h5 id="ç¼–è¯‘å™¨å†…å­˜å±éšœ">ç¼–è¯‘å™¨å†…å­˜å±éšœ</h5>
<p>åªæ˜¯ä¸ºäº†å‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œä½†ç¼–è¯‘å®Œæˆåï¼Œè¿™ç§å†…å­˜å±éšœå°±æ¶ˆå¤±äº†ï¼ŒCPUä¸ä¼šæ„ŸçŸ¥åˆ°ç¼–è¯‘å™¨ä¸­å†…å­˜å±éšœçš„å­˜åœ¨ã€‚</p>
<h5 id="cpuå†…å­˜å±éšœ">CPUå†…å­˜å±éšœ</h5>
<p>ç”±CPUæä¾›çš„æŒ‡ä»¤(ä¸åŒçš„CPUæ¶æ„ï¼Œæä¾›çš„æŒ‡ä»¤ä¸åŒ)ï¼Œå¯ä»¥ç”±å¼€å‘è€…æ˜¾ç¤ºè°ƒç”¨ï¼Œvolatileå°±æ˜¯é€šè¿‡CPUå†…å­˜å±éšœæŒ‡ä»¤æ¥å®ç°çš„ã€‚</p>
<p>å®ç°æµç¨‹ï¼š</p>
<ul>
<li>åœ¨volatileå†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ª<code>StoreStoreå±éšœ</code>ã€‚ä¿è¯volatileå†™æ“ä½œä¸ä¼šå’Œä¹‹å‰çš„å†™æ“ä½œé‡æ’åºã€‚</li>
<li>åœ¨volatileå†™æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª<code>StoreLoadå±éšœ</code>ã€‚ä¿è¯<code>volatileå†™æ“ä½œä¸ä¼šå’Œä¹‹åè¯»æ“ä½œ</code>é‡æ’åºã€‚</li>
<li>åœ¨volatileè¯»æ“ä½œåé¢æ’å…¥ä¸€ä¸ª<code>LoadLoad</code>å±éšœ + <code>LoadStore</code>å±éšœã€‚ä¿è¯<code>volatileè¯»æ“ä½œä¸ä¼šå’Œä¹‹å‰çš„è¯»æ“ä½œã€å†™æ“ä½œ</code>é‡æ’åºã€‚</li>
</ul>
<h3 id="ä¸synchronizedå…³é”®å­—çš„å¼‚åŒ">ä¸synchronizedå…³é”®å­—çš„å¼‚åŒ</h3>
<p>å¤šçº¿ç¨‹ä¼šäº§ç”Ÿä¸‰å¤§é—®é¢˜ï¼šåŸå­æ€§ã€æœ‰åºæ€§å’Œå¯è§æ€§ã€‚</p>
<p>synchronizedå’Œvolatileåœ¨å…±äº«å˜é‡çš„æ“ä½œä¸Šå…·æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰(<code>ä»ä¸»å†…å­˜è¯»å–ï¼Œç«‹å³å†™å…¥ä¸»å†…å­˜</code>)ï¼Œä¿è¯äº†å˜é‡çš„å¯è§æ€§ã€‚ä½†æ˜¯synchronizedç›¸æ¯”volatileè¿˜å…·æœ‰<code>åŸå­æ€§(é˜»å¡å’Œæ’ä»–æ€§ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œè€Œvolatileæ˜¯éé˜»å¡çš„)</code>ï¼Œæ‰€ä»¥<code>volatileæ˜¯å¼±åŒ–ç‰ˆçš„synchronized</code>ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Test</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// è¿™é‡Œçš„flagå°±å¯ä»¥ä¸ç”¨é”åŒæ­¥
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">volatile</span> <span style="color:#66d9ef">boolean</span> flag <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">// æ¨¡æ‹ŸAtomicInteger
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> CasUnsafe UNSAFE <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CasUnsafe<span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>
    
    <span style="color:#75715e">// æŒ‰ç…§é¡ºåºæ‰“å°1-100çš„å¥‡å¶æ•°
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        THREAD_POOL<span style="color:#f92672">.</span><span style="color:#a6e22e">execute</span><span style="color:#f92672">(()</span> <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>UNSAFE<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">()</span> <span style="color:#f92672">&lt;</span> 100<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>flag<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>UNSAFE<span style="color:#f92672">.</span><span style="color:#a6e22e">incrementAndGet</span><span style="color:#f92672">());</span>
                    flag <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">});</span>
        THREAD_POOL<span style="color:#f92672">.</span><span style="color:#a6e22e">execute</span><span style="color:#f92672">(()</span> <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>UNSAFE<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">()</span> <span style="color:#f92672">&lt;</span> 100<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>flag<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>UNSAFE<span style="color:#f92672">.</span><span style="color:#a6e22e">incrementAndGet</span><span style="color:#f92672">());</span>
                    flag <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">});</span>
        THREAD_POOL<span style="color:#f92672">.</span><span style="color:#a6e22e">shutdown</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<p>Qï¼šä»€ä¹ˆæ—¶å€™ç”¨volatileè€Œå¯ä»¥ä¸ç”¨synchronizedï¼Ÿ</p>
<p>Aï¼šå¦‚æœ<code>å†™å…¥å˜é‡å€¼ä¸ä¾èµ–å˜é‡å½“å‰å€¼(count++å°±æ˜¯ä¾èµ–å½“å‰å€¼ï¼Œå…ˆå»å†…å­˜è¯»å–å€¼ï¼Œç„¶åå°†å½“å‰å€¼+1ï¼Œå°†è®¡ç®—åçš„å€¼èµ‹ç»™countã€‚æ¯”å¦‚)</code>ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨volatileã€‚</p>
</blockquote>
<h3 id="dcldouble-check-lock">DCL(Double Check Lock)</h3>
<p><code>åŒé‡æ£€æŸ¥åŠ é”é—®é¢˜ç®€ç§°DCL</code>ï¼Œç”¨äºæ‡’æ±‰å¼å•ä¾‹çš„ä¸€ç§å†™æ³•ï¼Œé—®é¢˜å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DoubleCheckSingleton</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * ä¸ºä»€ä¹ˆè¿™ä¸ªåœ°æ–¹è¦ä½¿ç”¨volatileä¿®é¥°?
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£JVMæ˜¯å­˜åœ¨`ç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’`åŠŸèƒ½çš„(ç¼–è¯‘å™¨åœ¨ä¸æ”¹å˜å•çº¿ç¨‹è¯­ä¹‰æƒ…å†µä¸‹ï¼Œé‡æ–°å®‰      * æ’ä»£ç çš„æ‰§è¡Œé¡ºåºã€‚ä½†æ˜¯ä¸ä¿è¯å¤šçº¿ç¨‹æƒ…å†µ)
</span><span style="color:#75715e">     * æ‰§è¡Œå¦‚ä¸‹ä»£ç 
</span><span style="color:#75715e">     * singleton = new DoubleCheckSingleton();
</span><span style="color:#75715e">     * åœ¨JVMæ˜¯åˆ†æˆä¸‰æ­¥çš„ï¼š
</span><span style="color:#75715e">     * 1. å¼€è¾Ÿç©ºé—´åˆ†é…å†…å­˜
</span><span style="color:#75715e">     * 2. åˆå§‹åŒ–å¯¹è±¡
</span><span style="color:#75715e">     * 3. å°†singletonå¼•ç”¨æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * åœ¨ä¸ä½¿ç”¨volatileæ—¶ï¼Œå¯èƒ½è¢«JVMä¼˜åŒ–æˆ
</span><span style="color:#75715e">     * 1. å¼€è¾Ÿç©ºé—´åˆ†é…å†…å­˜
</span><span style="color:#75715e">     * 3. å°†singletonå¼•ç”¨æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€
</span><span style="color:#75715e">     * 2. åˆå§‹åŒ–å¯¹è±¡
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * é‚£ä¹ˆå½“çº¿ç¨‹Aæ‰§è¡Œ1&amp;3æ­¥çš„æ—¶å€™ï¼Œçº¿ç¨‹Bè·å–äº†CPUæ‰§è¡Œæƒï¼Œå»éªŒè¯`null == singleton`ï¼Œ
</span><span style="color:#75715e">     * å‘ç°ä¸ä¸ºnullï¼Œç›´æ¥è¿”å›ä¸€ä¸ªæœªåˆå§‹åŒ–å®Œæˆçš„singletonï¼Œå¯¼è‡´ç¨‹åºå‡ºé”™ã€‚
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * volatileç¦æ­¢è¢«ä¿®é¥°å˜é‡çš„ ç¼–è¯‘å™¨é‡æ’åº å’Œ å¤„ç†å™¨é‡æ’åº(å†…å­˜å±éšœ) ï¼ˆJDK1.5åï¼‰
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">volatile</span> DoubleCheckSingleton singleton<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">DoubleCheckSingleton</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> DoubleCheckSingleton <span style="color:#a6e22e">getInstance</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// ä¸æ˜¯ä»»ä½•çº¿ç¨‹è¿›æ¥éƒ½å°è¯•å»è·å–é”ï¼Œè€Œæ˜¯å…ˆåˆ¤æ–­singletonæ˜¯å¦ä¸ºnullï¼Œä¼˜åŒ–æ€§èƒ½
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">null</span> <span style="color:#f92672">==</span> singleton<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// å°è¯•å»è·å–é”ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span>DoubleCheckSingleton<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#75715e">// è·å–é”ååˆ¤æ–­singletonæ˜¯å¦ä¸ºnull
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">null</span> <span style="color:#f92672">==</span> singleton<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    singleton <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DoubleCheckSingleton<span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> singleton<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div>
    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">å…¶ä»–æ–‡ç« </span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://www.leejay.top/post/cas/">
                  <span class="button__icon">â†</span>
                  <span class="button__text">CAS</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://www.leejay.top/post/mesa%E6%A8%A1%E5%9E%8B/">
                  <span class="button__text">MESAæ¨¡å‹</span>
                  <span class="button__icon">â†’</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">è‹ICPå¤‡18050258å·-1</div>
    
  </div>
</footer>

<script src="https://www.leejay.top/assets/main.js"></script>
<script src="https://www.leejay.top/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
